import{s as Qe,E as it,F as at,G as ct,H as ut,w as de,e as Pe,i as A,d as h,I as Vt,x as gt,y as kn,p as be,f as E,g as I,h as y,L as ot,Y as It,u as se,v as ht,T as At,C as ye,V as Ct,o as ll,l as we,a as Q,m as ke,c as Y,j as f,r as v,n as De,R as Je,P as ft,K as vt,t as Ve,z as pe,A as _e,W as He,k as Bt,S as kt,Q as fl,O as Bn,M as Nn}from"./scheduler.8ceb707f.js";import{S as Ye,i as Xe,a as O,t as U,g as ze,c as Re,h as yn,j as En,k as Nt,f as Ae,b as ie,d as ae,m as ce,e as ue}from"./index.07e72a31.js";import{g as Ln}from"./globals.7f7f1b26.js";import{e as et}from"./each.0e379b97.js";import{a as ve}from"./Toaster.svelte_svelte_type_style_lang.a1b53f72.js";import{M as On,m as Hn}from"./Messages.ded4aafc.js";import"./dayjs.min.5e6a5a69.js";import{g as xt}from"./navigation.78a01be5.js";import{p as An}from"./stores.6ebf1f72.js";import{p as Un,q as Pn,h as Ut,c as Tt,g as dt,k as Lt,r as zn,u as nl,m as In,a as Ot,S as dl,x as hl,y as Ht,W as Sn,j as yt,l as Rn,s as jn,v as qn,i as Dt,O as Fn}from"./index.c43be487.js";import{f as Dn,r as $t,i as ml,h as sl,j as Wn,v as gl,p as pl,s as Zn,a as _l,k as Gn}from"./index.218e9685.js";import{i as Jn}from"./index.dfe7484c.js";import{u as Qn,o as vl,c as Yn,b as Mt,k as el,j as Xn,y as Kn}from"./index.5be2fceb.js";import{f as xn}from"./index.7514c8b5.js";import{i as $n,j as es,k as ts,l as ls}from"./index.eb11fd8a.js";import{T as ns,S as ss,U as rs,q as os}from"./UserMenu.e4689451.js";import{r as is,s as as,t as cs}from"./index.bd5201f1.js";import{f as bl}from"./index.87fe8e34.js";import{A as us}from"./AddFilesPlaceholder.685275a7.js";import"./sha256.65a6c54a.js";import{T as pt}from"./Tooltip.8ec69d41.js";import{f as Mn,h as fs}from"./updater.e153cbf1.js";import{D as rl,M as Et}from"./Dropdown.226b3ff4.js";import{s as ds,g as hs,u as ms,a as gs,M as ol}from"./menu-trigger.0f0338f1.js";import{f as Pt}from"./index.e8e699b3.js";import{S as Cn}from"./Switch.55ed00d7.js";import{t as il,s as ps}from"./index.2758212d.js";import{S as _s}from"./Selector.c0d0e4b9.js";import{d as vs}from"./index.e51049e7.js";import{g as St}from"./spread.8a54911c.js";import{f as bs}from"./FileSaver.min.898eb36f.js";import{b as ws}from"./index.8e999216.js";import"./singletons.86823efe.js";import{M as ks}from"./MenuLines.01456c47.js";import"./index.c4ca6160.js";const ys=s=>({subIds:s&1}),wl=s=>({subIds:s[0]});function Es(s){let e;const t=s[6].default,l=it(t,s,s[5],wl);return{c(){l&&l.c()},l(n){l&&l.l(n)},m(n,o){l&&l.m(n,o),e=!0},p(n,[o]){l&&l.p&&(!e||o&33)&&at(l,t,n,n[5],e?ut(t,n[5],o,ys):ct(n[5]),wl)},i(n){e||(O(l,n),e=!0)},o(n){U(l,n),e=!1},d(n){l&&l.d(n)}}}function Is(s,e,t){let l,{$$slots:n={},$$scope:o}=e,{disabled:r=void 0}=e,{open:i=void 0}=e,{onOpenChange:a=void 0}=e;const{updateOption:u,ids:c,states:{subOpen:d}}=ds({disabled:r,onOpenChange:({next:p})=>(i!==p&&(a==null||a(p),t(2,i=p)),p)}),m=vs([c.menu,c.trigger],([p,S])=>({menu:p,trigger:S}));return de(s,m,p=>t(0,l=p)),s.$$set=p=>{"disabled"in p&&t(3,r=p.disabled),"open"in p&&t(2,i=p.open),"onOpenChange"in p&&t(4,a=p.onOpenChange),"$$scope"in p&&t(5,o=p.$$scope)},s.$$.update=()=>{s.$$.dirty&4&&i!==void 0&&d.set(i),s.$$.dirty&8&&u("disabled",r)},[l,m,i,r,a,o,n]}class Ss extends Ye{constructor(e){super(),Xe(this,e,Is,Es,Qe,{disabled:3,open:2,onOpenChange:4})}}const Ds=s=>({builder:s[0]&256}),kl=s=>({builder:s[8]}),Ms=s=>({builder:s[0]&256}),yl=s=>({builder:s[8]}),Cs=s=>({builder:s[0]&256}),El=s=>({builder:s[8]}),Ts=s=>({builder:s[0]&256}),Il=s=>({builder:s[8]}),Vs=s=>({builder:s[0]&256}),Sl=s=>({builder:s[8]}),Bs=s=>({builder:s[0]&256}),Dl=s=>({builder:s[8]});function Ns(s){let e,t,l,n;const o=s[28].default,r=it(o,s,s[27],kl);let i=[s[8],s[13]],a={};for(let u=0;u<i.length;u+=1)a=gt(a,i[u]);return{c(){e=E("div"),r&&r.c(),this.h()},l(u){e=I(u,"DIV",{});var c=y(e);r&&r.l(c),c.forEach(h),this.h()},h(){ot(e,a)},m(u,c){A(u,e,c),r&&r.m(e,null),s[33](e),t=!0,l||(n=[It(s[8].action(e)),se(e,"m-focusout",s[12]),se(e,"m-keydown",s[12]),se(e,"m-pointermove",s[12])],l=!0)},p(u,c){r&&r.p&&(!t||c[0]&134217984)&&at(r,o,u,u[27],t?ut(o,u[27],c,Ds):ct(u[27]),kl),ot(e,a=St(i,[c[0]&256&&u[8],c[0]&8192&&u[13]]))},i(u){t||(O(r,u),t=!0)},o(u){U(r,u),t=!1},d(u){u&&h(e),r&&r.d(u),s[33](null),l=!1,ht(n)}}}function Ls(s){let e,t,l,n,o;const r=s[28].default,i=it(r,s,s[27],yl);let a=[s[8],s[13]],u={};for(let c=0;c<a.length;c+=1)u=gt(u,a[c]);return{c(){e=E("div"),i&&i.c(),this.h()},l(c){e=I(c,"DIV",{});var d=y(e);i&&i.l(d),d.forEach(h),this.h()},h(){ot(e,u)},m(c,d){A(c,e,d),i&&i.m(e,null),s[32](e),l=!0,n||(o=[It(s[8].action(e)),se(e,"m-focusout",s[12]),se(e,"m-keydown",s[12]),se(e,"m-pointermove",s[12])],n=!0)},p(c,d){s=c,i&&i.p&&(!l||d[0]&134217984)&&at(i,r,s,s[27],l?ut(r,s[27],d,Ms):ct(s[27]),yl),ot(e,u=St(a,[d[0]&256&&s[8],d[0]&8192&&s[13]]))},i(c){l||(O(i,c),t&&t.end(1),l=!0)},o(c){U(i,c),c&&(t=yn(e,s[5],s[6])),l=!1},d(c){c&&h(e),i&&i.d(c),s[32](null),c&&t&&t.end(),n=!1,ht(o)}}}function Os(s){let e,t,l,n,o;const r=s[28].default,i=it(r,s,s[27],El);let a=[s[8],s[13]],u={};for(let c=0;c<a.length;c+=1)u=gt(u,a[c]);return{c(){e=E("div"),i&&i.c(),this.h()},l(c){e=I(c,"DIV",{});var d=y(e);i&&i.l(d),d.forEach(h),this.h()},h(){ot(e,u)},m(c,d){A(c,e,d),i&&i.m(e,null),s[31](e),l=!0,n||(o=[It(s[8].action(e)),se(e,"m-focusout",s[12]),se(e,"m-keydown",s[12]),se(e,"m-pointermove",s[12])],n=!0)},p(c,d){s=c,i&&i.p&&(!l||d[0]&134217984)&&at(i,r,s,s[27],l?ut(r,s[27],d,Cs):ct(s[27]),El),ot(e,u=St(a,[d[0]&256&&s[8],d[0]&8192&&s[13]]))},i(c){l||(O(i,c),c&&(t||At(()=>{t=En(e,s[3],s[4]),t.start()})),l=!0)},o(c){U(i,c),l=!1},d(c){c&&h(e),i&&i.d(c),s[31](null),n=!1,ht(o)}}}function Hs(s){let e,t,l,n,o,r;const i=s[28].default,a=it(i,s,s[27],Il);let u=[s[8],s[13]],c={};for(let d=0;d<u.length;d+=1)c=gt(c,u[d]);return{c(){e=E("div"),a&&a.c(),this.h()},l(d){e=I(d,"DIV",{});var m=y(e);a&&a.l(m),m.forEach(h),this.h()},h(){ot(e,c)},m(d,m){A(d,e,m),a&&a.m(e,null),s[30](e),n=!0,o||(r=[It(s[8].action(e)),se(e,"m-focusout",s[12]),se(e,"m-keydown",s[12]),se(e,"m-pointermove",s[12])],o=!0)},p(d,m){s=d,a&&a.p&&(!n||m[0]&134217984)&&at(a,i,s,s[27],n?ut(i,s[27],m,Ts):ct(s[27]),Il),ot(e,c=St(u,[m[0]&256&&s[8],m[0]&8192&&s[13]]))},i(d){n||(O(a,d),d&&At(()=>{n&&(l&&l.end(1),t=En(e,s[3],s[4]),t.start())}),n=!0)},o(d){U(a,d),t&&t.invalidate(),d&&(l=yn(e,s[5],s[6])),n=!1},d(d){d&&h(e),a&&a.d(d),s[30](null),d&&l&&l.end(),o=!1,ht(r)}}}function As(s){let e,t,l,n,o;const r=s[28].default,i=it(r,s,s[27],Sl);let a=[s[8],s[13]],u={};for(let c=0;c<a.length;c+=1)u=gt(u,a[c]);return{c(){e=E("div"),i&&i.c(),this.h()},l(c){e=I(c,"DIV",{});var d=y(e);i&&i.l(d),d.forEach(h),this.h()},h(){ot(e,u)},m(c,d){A(c,e,d),i&&i.m(e,null),s[29](e),l=!0,n||(o=[It(s[8].action(e)),se(e,"m-focusout",s[12]),se(e,"m-keydown",s[12]),se(e,"m-pointermove",s[12])],n=!0)},p(c,d){s=c,i&&i.p&&(!l||d[0]&134217984)&&at(i,r,s,s[27],l?ut(r,s[27],d,Vs):ct(s[27]),Sl),ot(e,u=St(a,[d[0]&256&&s[8],d[0]&8192&&s[13]]))},i(c){l||(O(i,c),c&&At(()=>{l&&(t||(t=Nt(e,s[1],s[2],!0)),t.run(1))}),l=!0)},o(c){U(i,c),c&&(t||(t=Nt(e,s[1],s[2],!1)),t.run(0)),l=!1},d(c){c&&h(e),i&&i.d(c),s[29](null),c&&t&&t.end(),n=!1,ht(o)}}}function Us(s){let e;const t=s[28].default,l=it(t,s,s[27],Dl);return{c(){l&&l.c()},l(n){l&&l.l(n)},m(n,o){l&&l.m(n,o),e=!0},p(n,o){l&&l.p&&(!e||o[0]&134217984)&&at(l,t,n,n[27],e?ut(t,n[27],o,Bs):ct(n[27]),Dl)},i(n){e||(O(l,n),e=!0)},o(n){U(l,n),e=!1},d(n){l&&l.d(n)}}}function Ps(s){let e,t,l,n;const o=[Us,As,Hs,Os,Ls,Ns],r=[];function i(a,u){return a[7]&&a[9]?0:a[1]&&a[9]?1:a[3]&&a[5]&&a[9]?2:a[3]&&a[9]?3:a[5]&&a[9]?4:a[9]?5:-1}return~(e=i(s))&&(t=r[e]=o[e](s)),{c(){t&&t.c(),l=Pe()},l(a){t&&t.l(a),l=Pe()},m(a,u){~e&&r[e].m(a,u),A(a,l,u),n=!0},p(a,u){let c=e;e=i(a),e===c?~e&&r[e].p(a,u):(t&&(ze(),U(r[c],1,1,()=>{r[c]=null}),Re()),~e?(t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),O(t,1),t.m(l.parentNode,l)):t=null)},i(a){n||(O(t),n=!0)},o(a){U(t),n=!1},d(a){a&&h(l),~e&&r[e].d(a)}}}function zs(s,e,t){let l;const n=["transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el"];let o=Vt(e,n),r,i,{$$slots:a={},$$scope:u}=e,{transition:c=void 0}=e,{transitionConfig:d=void 0}=e,{inTransition:m=void 0}=e,{inTransitionConfig:p=void 0}=e,{outTransition:S=void 0}=e,{outTransitionConfig:g=void 0}=e,{asChild:b=!1}=e,{id:_=void 0}=e,{side:w="right"}=e,{align:M="start"}=e,{sideOffset:D=0}=e,{alignOffset:N=0}=e,{collisionPadding:C=8}=e,{avoidCollisions:R=!0}=e,{collisionBoundary:T=void 0}=e,{sameWidth:P=!1}=e,{fitViewport:F=!1}=e,{strategy:H="absolute"}=e,{overlap:j=!1}=e,{el:re=void 0}=e;const{elements:{subMenu:x},states:{subOpen:V},ids:L,getAttrs:q}=hs();de(s,x,X=>t(26,r=X)),de(s,V,X=>t(9,i=X));const J=Mn(),W=q("sub-content");function te(X){be[X?"unshift":"push"](()=>{re=X,t(0,re)})}function Be(X){be[X?"unshift":"push"](()=>{re=X,t(0,re)})}function qe(X){be[X?"unshift":"push"](()=>{re=X,t(0,re)})}function $e(X){be[X?"unshift":"push"](()=>{re=X,t(0,re)})}function We(X){be[X?"unshift":"push"](()=>{re=X,t(0,re)})}return s.$$set=X=>{e=gt(gt({},e),kn(X)),t(13,o=Vt(e,n)),"transition"in X&&t(1,c=X.transition),"transitionConfig"in X&&t(2,d=X.transitionConfig),"inTransition"in X&&t(3,m=X.inTransition),"inTransitionConfig"in X&&t(4,p=X.inTransitionConfig),"outTransition"in X&&t(5,S=X.outTransition),"outTransitionConfig"in X&&t(6,g=X.outTransitionConfig),"asChild"in X&&t(7,b=X.asChild),"id"in X&&t(14,_=X.id),"side"in X&&t(15,w=X.side),"align"in X&&t(16,M=X.align),"sideOffset"in X&&t(17,D=X.sideOffset),"alignOffset"in X&&t(18,N=X.alignOffset),"collisionPadding"in X&&t(19,C=X.collisionPadding),"avoidCollisions"in X&&t(20,R=X.avoidCollisions),"collisionBoundary"in X&&t(21,T=X.collisionBoundary),"sameWidth"in X&&t(22,P=X.sameWidth),"fitViewport"in X&&t(23,F=X.fitViewport),"strategy"in X&&t(24,H=X.strategy),"overlap"in X&&t(25,j=X.overlap),"el"in X&&t(0,re=X.el),"$$scope"in X&&t(27,u=X.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&16384&&_&&L.menu.set(_),s.$$.dirty[0]&67108864&&t(8,l=r),s.$$.dirty[0]&256&&Object.assign(l,W),s.$$.dirty[0]&67076096&&ms({side:w,align:M,sideOffset:D,alignOffset:N,collisionPadding:C,avoidCollisions:R,collisionBoundary:T,sameWidth:P,fitViewport:F,strategy:H,overlap:j})},[re,c,d,m,p,S,g,b,l,i,x,V,J,o,_,w,M,D,N,C,R,T,P,F,H,j,r,u,a,te,Be,qe,$e,We]}class Rs extends Ye{constructor(e){super(),Xe(this,e,zs,Ps,Qe,{transition:1,transitionConfig:2,inTransition:3,inTransitionConfig:4,outTransition:5,outTransitionConfig:6,asChild:7,id:14,side:15,align:16,sideOffset:17,alignOffset:18,collisionPadding:19,avoidCollisions:20,collisionBoundary:21,sameWidth:22,fitViewport:23,strategy:24,overlap:25,el:0},null,[-1,-1])}}const js=s=>({builder:s&4}),Ml=s=>({builder:s[2]}),qs=s=>({builder:s&4}),Cl=s=>({builder:s[2]});function Fs(s){let e,t,l,n;const o=s[13].default,r=it(o,s,s[12],Ml);let i=[s[2],s[6]],a={};for(let u=0;u<i.length;u+=1)a=gt(a,i[u]);return{c(){e=E("div"),r&&r.c(),this.h()},l(u){e=I(u,"DIV",{});var c=y(e);r&&r.l(c),c.forEach(h),this.h()},h(){ot(e,a)},m(u,c){A(u,e,c),r&&r.m(e,null),s[14](e),t=!0,l||(n=[It(s[2].action(e)),se(e,"m-click",s[5]),se(e,"m-focusin",s[5]),se(e,"m-focusout",s[5]),se(e,"m-keydown",s[5]),se(e,"m-pointerleave",s[5]),se(e,"m-pointermove",s[5])],l=!0)},p(u,c){r&&r.p&&(!t||c&4100)&&at(r,o,u,u[12],t?ut(o,u[12],c,js):ct(u[12]),Ml),ot(e,a=St(i,[c&4&&u[2],c&64&&u[6]]))},i(u){t||(O(r,u),t=!0)},o(u){U(r,u),t=!1},d(u){u&&h(e),r&&r.d(u),s[14](null),l=!1,ht(n)}}}function Ws(s){let e;const t=s[13].default,l=it(t,s,s[12],Cl);return{c(){l&&l.c()},l(n){l&&l.l(n)},m(n,o){l&&l.m(n,o),e=!0},p(n,o){l&&l.p&&(!e||o&4100)&&at(l,t,n,n[12],e?ut(t,n[12],o,qs):ct(n[12]),Cl)},i(n){e||(O(l,n),e=!0)},o(n){U(l,n),e=!1},d(n){l&&l.d(n)}}}function Zs(s){let e,t,l,n;const o=[Ws,Fs],r=[];function i(a,u){return a[1]?0:1}return e=i(s),t=r[e]=o[e](s),{c(){t.c(),l=Pe()},l(a){t.l(a),l=Pe()},m(a,u){r[e].m(a,u),A(a,l,u),n=!0},p(a,[u]){let c=e;e=i(a),e===c?r[e].p(a,u):(ze(),U(r[c],1,1,()=>{r[c]=null}),Re(),t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),O(t,1),t.m(l.parentNode,l))},i(a){n||(O(t),n=!0)},o(a){U(t),n=!1},d(a){a&&h(l),r[e].d(a)}}}function Gs(s,e,t){let l,n;const o=["disabled","asChild","id","el"];let r=Vt(e,o),i,a,{$$slots:u={},$$scope:c}=e,{disabled:d=!1}=e,{asChild:m=!1}=e,{id:p=void 0}=e,{el:S=void 0}=e;const{elements:{subTrigger:g},ids:b,getAttrs:_,options:w}=gs();de(s,g,C=>t(11,a=C));const{disabled:M}=w;de(s,M,C=>t(10,i=C));const D=Mn();function N(C){be[C?"unshift":"push"](()=>{S=C,t(0,S)})}return s.$$set=C=>{e=gt(gt({},e),kn(C)),t(6,r=Vt(e,o)),"disabled"in C&&t(7,d=C.disabled),"asChild"in C&&t(1,m=C.asChild),"id"in C&&t(8,p=C.id),"el"in C&&t(0,S=C.el),"$$scope"in C&&t(12,c=C.$$scope)},s.$$.update=()=>{s.$$.dirty&256&&p&&b.trigger.set(p),s.$$.dirty&2048&&t(2,l=a),s.$$.dirty&1152&&t(9,n={..._("sub-trigger"),...fs(d||i)}),s.$$.dirty&516&&Object.assign(l,n)},[S,m,l,g,M,D,r,d,p,n,i,a,c,u,N]}class Js extends Ye{constructor(e){super(),Xe(this,e,Gs,Zs,Qe,{disabled:7,asChild:1,id:8,el:0})}}function Qs(s){let e,t,l,n,o,r,i;return a(),{feed:u,reset:a};function a(){e=!0,t="",l=0,n=-1,o=void 0,r=void 0,i=""}function u(d){t=t?t+d:d,e&&Ys(t)&&(t=t.slice(Tn.length)),e=!1;const m=t.length;let p=0,S=!1;for(;p<m;){S&&(t[p]===`
`&&++p,S=!1);let g=-1,b=n,_;for(let w=l;g<0&&w<m;++w)_=t[w],_===":"&&b<0?b=w-p:_==="\r"?(S=!0,g=w-p):_===`
`&&(g=w-p);if(g<0){l=m-p,n=b;break}else l=0,n=-1;c(t,p,b,g),p+=g+1}p===m?t="":p>0&&(t=t.slice(p))}function c(d,m,p,S){if(S===0){i.length>0&&(s({type:"event",id:o,event:r||void 0,data:i.slice(0,-1)}),i="",o=void 0),r=void 0;return}const g=p<0,b=d.slice(m,m+(g?S:p));let _=0;g?_=S:d[m+p+1]===" "?_=p+2:_=p+1;const w=m+_,M=S-_,D=d.slice(w,w+M).toString();if(b==="data")i+=D?"".concat(D,`
`):`
`;else if(b==="event")r=D;else if(b==="id"&&!D.includes("\0"))o=D;else if(b==="retry"){const N=parseInt(D,10);Number.isNaN(N)||s({type:"reconnect-interval",value:N})}}}const Tn=[239,187,191];function Ys(s){return Tn.every((e,t)=>s.charCodeAt(t)===e)}class Xs extends TransformStream{constructor(){let e;super({start(t){e=Qs(l=>{l.type==="event"&&t.enqueue(l)})},transform(t){e.feed(t)}})}}async function Ks(s,e){const t=s.pipeThrough(new TextDecoderStream).pipeThrough(new Xs).getReader();let l=xs(t);return e&&(l=$s(l)),l}async function*xs(s){var e,t,l;for(;;){const{value:n,done:o}=await s.read();if(o){yield{done:!0,value:""};break}if(!n)continue;const r=n.data;if(r.startsWith("[DONE]")){yield{done:!0,value:""};break}try{const i=JSON.parse(r);if(console.log(i),i.error){yield{done:!0,value:"",error:i.error};break}if(i.citations){yield{done:!1,value:"",citations:i.citations};continue}yield{done:!1,value:((l=(t=(e=i.choices)==null?void 0:e[0])==null?void 0:t.delta)==null?void 0:l.content)??"",usage:i.usage}}catch(i){console.error("Error extracting delta from SSE event:",i)}}}async function*$s(s){for await(const e of s){if(e.done){yield e;return}if(e.citations){yield e;continue}let t=e.value;if(t.length<5){yield{done:!1,value:t};continue}for(;t!="";){const l=Math.min(Math.floor(Math.random()*3)+1,t.length);yield{done:!1,value:t.slice(0,l)},(document==null?void 0:document.visibilityState)!=="hidden"&&await er(5),t=t.slice(l)}}}const er=s=>new Promise(e=>setTimeout(e,s));function Tl(s){let e,t=s[2]&&Vl(s);return{c(){t&&t.c(),e=Pe()},l(l){t&&t.l(l),e=Pe()},m(l,n){t&&t.m(l,n),A(l,e,n)},p(l,n){l[2]?t?(t.p(l,n),n&4&&O(t,1)):(t=Vl(l),t.c(),O(t,1),t.m(e.parentNode,e)):t&&(ze(),U(t,1,1,()=>{t=null}),Re())},d(l){l&&h(e),t&&t.d(l)}}}function Vl(s){let e,t,l,n,o=s[1].type+"",r,i,a,u,c,d=s[1].content+"",m,p,S,g,b,_,w=s[1].url&&Bl(),M=s[1].url&&Nl(),D=s[1].dismissible&&Ll(s);return{c(){e=E("div"),t=E("div"),l=E("div"),n=E("div"),r=we(o),a=Q(),w&&w.c(),u=Q(),c=E("div"),m=we(d),p=Q(),M&&M.c(),S=Q(),g=E("div"),D&&D.c(),this.h()},l(N){e=I(N,"DIV",{class:!0});var C=y(e);t=I(C,"DIV",{class:!0});var R=y(t);l=I(R,"DIV",{class:!0});var T=y(l);n=I(T,"DIV",{class:!0});var P=y(n);r=ke(P,o),P.forEach(h),a=Y(T),w&&w.l(T),T.forEach(h),u=Y(R),c=I(R,"DIV",{class:!0});var F=y(c);m=ke(F,d),F.forEach(h),R.forEach(h),p=Y(C),M&&M.l(C),S=Y(C),g=I(C,"DIV",{class:!0});var H=y(g);D&&D.l(H),H.forEach(h),C.forEach(h),this.h()},h(){f(n,"class",i="text-xs font-black "+(s[3][s[1].type]??s[3].info)+" w-fit px-2 rounded uppercase line-clamp-1 mr-0.5"),f(l,"class","flex justify-between self-start"),f(c,"class","flex-1 text-xs text-gray-700 dark:text-white"),f(t,"class","flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5"),f(g,"class","flex self-start"),f(e,"class","top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-50 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-30")},m(N,C){A(N,e,C),v(e,t),v(t,l),v(l,n),v(n,r),v(l,a),w&&w.m(l,null),v(t,u),v(t,c),v(c,m),v(e,p),M&&M.m(e,null),v(e,S),v(e,g),D&&D.m(g,null),_=!0},p(N,C){(!_||C&2)&&o!==(o=N[1].type+"")&&De(r,o),(!_||C&2&&i!==(i="text-xs font-black "+(N[3][N[1].type]??N[3].info)+" w-fit px-2 rounded uppercase line-clamp-1 mr-0.5"))&&f(n,"class",i),N[1].url?w||(w=Bl(),w.c(),w.m(l,null)):w&&(w.d(1),w=null),(!_||C&2)&&d!==(d=N[1].content+"")&&De(m,d),N[1].url?M||(M=Nl(),M.c(),M.m(e,S)):M&&(M.d(1),M=null),N[1].dismissible?D?D.p(N,C):(D=Ll(N),D.c(),D.m(g,null)):D&&(D.d(1),D=null)},i(N){_||(N&&At(()=>{_&&(b||(b=Nt(e,bl,{delay:100,duration:300},!0)),b.run(1))}),_=!0)},o(N){N&&(b||(b=Nt(e,bl,{delay:100,duration:300},!1)),b.run(0)),_=!1},d(N){N&&h(e),w&&w.d(),M&&M.d(),D&&D.d(),N&&b&&b.end()}}}function Bl(s){let e,t='<a class="text-gray-700 dark:text-white text-xs font-bold underline" href="/assets/files/whitepaper.pdf" target="_blank">Learn More</a> <div class="ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div>';return{c(){e=E("div"),e.innerHTML=t,this.h()},l(l){e=I(l,"DIV",{class:!0,"data-svelte-h":!0}),Je(e)!=="svelte-1ofrdjc"&&(e.innerHTML=t),this.h()},h(){f(e,"class","flex md:hidden group w-fit md:items-center")},m(l,n){A(l,e,n)},d(l){l&&h(e)}}}function Nl(s){let e,t='<a class="text-gray-700 dark:text-white text-xs font-bold underline" href="/" target="_blank">Learn More</a> <div class="ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div>';return{c(){e=E("div"),e.innerHTML=t,this.h()},l(l){e=I(l,"DIV",{class:!0,"data-svelte-h":!0}),Je(e)!=="svelte-15ujvd1"&&(e.innerHTML=t),this.h()},h(){f(e,"class","hidden md:flex group w-fit md:items-center")},m(l,n){A(l,e,n)},d(l){l&&h(e)}}}function Ll(s){let e,t="×",l,n;return{c(){e=E("button"),e.textContent=t,this.h()},l(o){e=I(o,"BUTTON",{class:!0,"data-svelte-h":!0}),Je(e)!=="svelte-17pf3tf"&&(e.textContent=t),this.h()},h(){f(e,"class","-mt-[3px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white h-1")},m(o,r){A(o,e,r),l||(n=se(e,"click",s[5]),l=!0)},p:ye,d(o){o&&h(e),l=!1,n()}}}function tr(s){let e,t=!s[0]&&Tl(s);return{c(){t&&t.c(),e=Pe()},l(l){t&&t.l(l),e=Pe()},m(l,n){t&&t.m(l,n),A(l,e,n)},p(l,[n]){l[0]?t&&(t.d(1),t=null):t?t.p(l,n):(t=Tl(l),t.c(),t.m(e.parentNode,e))},i:ye,o:ye,d(l){l&&h(e),t&&t.d(l)}}}function lr(s,e,t){const l=Ct();let{banner:n={id:"",type:"info",title:"",content:"",url:"",dismissable:!0,timestamp:Math.floor(Date.now()/1e3)}}=e,{dismissed:o=!1}=e,r=!1;const i={info:"bg-blue-500/20 text-blue-700 dark:text-blue-200 ",success:"bg-green-500/20 text-green-700 dark:text-green-200",warning:"bg-yellow-500/20 text-yellow-700 dark:text-yellow-200",error:"bg-red-500/20 text-red-700 dark:text-red-200"},a=c=>{t(0,o=!0),l("dismiss",c)};ll(()=>{t(2,r=!0)});const u=()=>{a(n.id)};return s.$$set=c=>{"banner"in c&&t(1,n=c.banner),"dismissed"in c&&t(0,o=c.dismissed)},[o,n,r,i,a,u]}class nr extends Ye{constructor(e){super(),Xe(this,e,lr,tr,Qe,{banner:1,dismissed:0})}}function Ol(s,e,t){const l=s.slice();return l[12]=e[t],l[14]=t,l}function Hl(s){let e,t,l,n='<div class="text-lg font-semibold mt-2">/</div>',o,r,i,a,u,c,d='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>',m,p,S=s[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"",g,b=et(s[1]),_=[];for(let w=0;w<b.length;w+=1)_[w]=Al(Ol(s,b,w));return{c(){e=E("div"),t=E("div"),l=E("div"),l.innerHTML=n,o=Q(),r=E("div"),i=E("div");for(let w=0;w<_.length;w+=1)_[w].c();a=Q(),u=E("div"),c=E("div"),c.innerHTML=d,m=Q(),p=E("div"),g=we(S),this.h()},l(w){e=I(w,"DIV",{class:!0});var M=y(e);t=I(M,"DIV",{class:!0});var D=y(t);l=I(D,"DIV",{class:!0,"data-svelte-h":!0}),Je(l)!=="svelte-1ynv172"&&(l.innerHTML=n),o=Y(D),r=I(D,"DIV",{class:!0});var N=y(r);i=I(N,"DIV",{class:!0});var C=y(i);for(let P=0;P<_.length;P+=1)_[P].l(C);C.forEach(h),a=Y(N),u=I(N,"DIV",{class:!0});var R=y(u);c=I(R,"DIV",{"data-svelte-h":!0}),Je(c)!=="svelte-cdi12d"&&(c.innerHTML=d),m=Y(R),p=I(R,"DIV",{class:!0});var T=y(p);g=ke(T,S),T.forEach(h),R.forEach(h),N.forEach(h),D.forEach(h),M.forEach(h),this.h()},h(){f(l,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),f(p,"class","line-clamp-1"),f(u,"class","px-2 pb-1 text-xs text-gray-600 bg-white rounded-br-xl flex items-center space-x-1"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),f(t,"class","flex w-full px-2"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(w,M){A(w,e,M),v(e,t),v(t,l),v(t,o),v(t,r),v(r,i);for(let D=0;D<_.length;D+=1)_[D]&&_[D].m(i,null);v(r,a),v(r,u),v(u,c),v(u,m),v(u,p),v(p,g)},p(w,M){if(M&19){b=et(w[1]);let D;for(D=0;D<b.length;D+=1){const N=Ol(w,b,D);_[D]?_[D].p(N,M):(_[D]=Al(N),_[D].c(),_[D].m(i,null))}for(;D<_.length;D+=1)_[D].d(1);_.length=b.length}M&4&&S!==(S=w[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"")&&De(g,S)},d(w){w&&h(e),vt(_,w)}}}function Al(s){let e,t,l=s[12].command+"",n,o,r,i=s[12].title+"",a,u,c,d,m;function p(){return s[10](s[12])}function S(){return s[11](s[14])}return{c(){e=E("button"),t=E("div"),n=we(l),o=Q(),r=E("div"),a=we(i),u=Q(),this.h()},l(g){e=I(g,"BUTTON",{class:!0,type:!0});var b=y(e);t=I(b,"DIV",{class:!0});var _=y(t);n=ke(_,l),_.forEach(h),o=Y(b),r=I(b,"DIV",{class:!0});var w=y(r);a=ke(w,i),w.forEach(h),u=Y(b),b.forEach(h),this.h()},h(){f(t,"class","font-medium text-black"),f(r,"class","text-xs text-gray-600"),f(e,"class",c="px-3 py-1.5 rounded-xl w-full text-left "+(s[14]===s[0]?" bg-gray-100 selected-command-option-button":"")),f(e,"type","button")},m(g,b){A(g,e,b),v(e,t),v(t,n),v(e,o),v(e,r),v(r,a),v(e,u),d||(m=[se(e,"click",p),se(e,"mousemove",S),se(e,"focus",rr)],d=!0)},p(g,b){s=g,b&2&&l!==(l=s[12].command+"")&&De(n,l),b&2&&i!==(i=s[12].title+"")&&De(a,i),b&1&&c!==(c="px-3 py-1.5 rounded-xl w-full text-left "+(s[14]===s[0]?" bg-gray-100 selected-command-option-button":""))&&f(e,"class",c)},d(g){g&&h(e),d=!1,ht(m)}}}function sr(s){let e,t=s[1].length>0&&Hl(s);return{c(){t&&t.c(),e=Pe()},l(l){t&&t.l(l),e=Pe()},m(l,n){t&&t.m(l,n),A(l,e,n)},p(l,[n]){l[1].length>0?t?t.p(l,n):(t=Hl(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ye,o:ye,d(l){l&&h(e),t&&t.d(l)}}}const rr=()=>{};function or(s,e,t){let l,n;de(s,Un,g=>t(9,n=g));const o=ft("i18n");de(s,o,g=>t(2,l=g));let{files:r}=e,{prompt:i=""}=e,a=0,u=[];const c=()=>{t(0,a=Math.max(0,a-1))},d=()=>{t(0,a=Math.min(a+1,u.length-1))},m=async g=>{let b=g.content;if(g.content.includes("{{CLIPBOARD}}")){const M=await navigator.clipboard.readText().catch(C=>(ve.error(l.t("Failed to read clipboard contents")),"{{CLIPBOARD}}"));console.log(M);const D=await navigator.clipboard.read();let N=null;for(const C of D)for(const R of C.types)if(R.startsWith("image/")){const T=await C.getType(R);N=URL.createObjectURL(T),console.log(`Image URL (${R}): ${N}`)}N&&t(6,r=[...r,{type:"image",url:N}]),b=g.content.replaceAll("{{CLIPBOARD}}",M)}t(5,i=b);const _=document.getElementById("chat-textarea");await Ve(),_.style.height="",_.style.height=Math.min(_.scrollHeight,200)+"px",_==null||_.focus(),await Ve();const w=Dn(i);if(w.length>0){const M=w.at(0);_.setSelectionRange(M==null?void 0:M.startIndex,M.endIndex+1)}},p=g=>{m(g)},S=g=>{t(0,a=g)};return s.$$set=g=>{"files"in g&&t(6,r=g.files),"prompt"in g&&t(5,i=g.prompt)},s.$$.update=()=>{s.$$.dirty&544&&t(1,u=n.filter(g=>g.command.includes(i)).sort((g,b)=>g.title.localeCompare(b.title))),s.$$.dirty&32&&i&&t(0,a=0)},[a,u,l,o,m,i,r,c,d,n,p,S]}class ir extends Ye{constructor(e){super(),Xe(this,e,or,sr,Qe,{files:6,prompt:5,selectUp:7,selectDown:8})}get selectUp(){return this.$$.ctx[7]}get selectDown(){return this.$$.ctx[8]}}function Ul(s,e,t){const l=s.slice();return l[19]=e[t],l[21]=t,l}function Pl(s){let e,t,l,n='<div class="text-lg font-semibold mt-2">#</div>',o,r,i,a,u,c,d=et(s[3]),m=[];for(let b=0;b<d.length;b+=1)m[b]=zl(Ul(s,d,b));function p(b,_){var w,M;if(_&1&&(u=null),_&1&&(c=null),u==null&&(u=!!b[0].split(" ").some(hr)),u)return fr;if(c==null&&(c=!!((M=(w=b[0].split(" "))==null?void 0:w.at(0))!=null&&M.substring(1).startsWith("http"))),c)return ur}let S=p(s,-1),g=S&&S(s);return{c(){e=E("div"),t=E("div"),l=E("div"),l.innerHTML=n,o=Q(),r=E("div"),i=E("div");for(let b=0;b<m.length;b+=1)m[b].c();a=Q(),g&&g.c(),this.h()},l(b){e=I(b,"DIV",{class:!0});var _=y(e);t=I(_,"DIV",{class:!0});var w=y(t);l=I(w,"DIV",{class:!0,"data-svelte-h":!0}),Je(l)!=="svelte-czbw16"&&(l.innerHTML=n),o=Y(w),r=I(w,"DIV",{class:!0});var M=y(r);i=I(M,"DIV",{class:!0});var D=y(i);for(let N=0;N<m.length;N+=1)m[N].l(D);a=Y(D),g&&g.l(D),D.forEach(h),M.forEach(h),w.forEach(h),_.forEach(h),this.h()},h(){f(l,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),f(t,"class","flex w-full px-2"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(b,_){A(b,e,_),v(e,t),v(t,l),v(t,o),v(t,r),v(r,i);for(let w=0;w<m.length;w+=1)m[w]&&m[w].m(i,null);v(i,a),g&&g.m(i,null)},p(b,_){if(_&46){d=et(b[3]);let w;for(w=0;w<d.length;w+=1){const M=Ul(b,d,w);m[w]?m[w].p(M,_):(m[w]=zl(M),m[w].c(),m[w].m(i,a))}for(;w<m.length;w+=1)m[w].d(1);m.length=d.length}S===(S=p(b,_))&&g?g.p(b,_):(g&&g.d(1),g=S&&S(b),g&&(g.c(),g.m(i,null)))},d(b){b&&h(e),vt(m,b),g&&g.d()}}}function ar(s){let e,t,l=s[19].name+"",n,o,r=s[19].filename+"",i,a,u,c,d=s[19].title+"",m;return{c(){e=E("div"),t=we("#"),n=we(l),o=we(" ("),i=we(r),a=we(")"),u=Q(),c=E("div"),m=we(d),this.h()},l(p){e=I(p,"DIV",{class:!0});var S=y(e);t=ke(S,"#"),n=ke(S,l),o=ke(S," ("),i=ke(S,r),a=ke(S,")"),S.forEach(h),u=Y(p),c=I(p,"DIV",{class:!0});var g=y(c);m=ke(g,d),g.forEach(h),this.h()},h(){f(e,"class","font-medium text-black line-clamp-1"),f(c,"class","text-xs text-gray-600 line-clamp-1")},m(p,S){A(p,e,S),v(e,t),v(e,n),v(e,o),v(e,i),v(e,a),A(p,u,S),A(p,c,S),v(c,m)},p(p,S){S&8&&l!==(l=p[19].name+"")&&De(n,l),S&8&&r!==(r=p[19].filename+"")&&De(i,r),S&8&&d!==(d=p[19].title+"")&&De(m,d)},d(p){p&&(h(e),h(u),h(c))}}}function cr(s){var a;let e,t=(((a=s[19])==null?void 0:a.title)??`#${s[19].name}`)+"",l,n,o,r=s[1].t("Collection")+"",i;return{c(){e=E("div"),l=we(t),n=Q(),o=E("div"),i=we(r),this.h()},l(u){e=I(u,"DIV",{class:!0});var c=y(e);l=ke(c,t),c.forEach(h),n=Y(u),o=I(u,"DIV",{class:!0});var d=y(o);i=ke(d,r),d.forEach(h),this.h()},h(){f(e,"class","font-medium text-black line-clamp-1"),f(o,"class","text-xs text-gray-600 line-clamp-1")},m(u,c){A(u,e,c),v(e,l),A(u,n,c),A(u,o,c),v(o,i)},p(u,c){var d;c&8&&t!==(t=(((d=u[19])==null?void 0:d.title)??`#${u[19].name}`)+"")&&De(l,t),c&2&&r!==(r=u[1].t("Collection")+"")&&De(i,r)},d(u){u&&(h(e),h(n),h(o))}}}function zl(s){let e,t,l,n;function o(c,d){return c[19].type==="collection"?cr:ar}let r=o(s),i=r(s);function a(){return s[14](s[19])}function u(){return s[15](s[21])}return{c(){e=E("button"),i.c(),this.h()},l(c){e=I(c,"BUTTON",{class:!0,type:!0});var d=y(e);i.l(d),d.forEach(h),this.h()},h(){f(e,"class",t="px-3 py-1.5 rounded-xl w-full text-left "+(s[21]===s[2]?" bg-gray-100 selected-command-option-button":"")),f(e,"type","button")},m(c,d){A(c,e,d),i.m(e,null),l||(n=[se(e,"click",a),se(e,"mousemove",u),se(e,"focus",mr)],l=!0)},p(c,d){s=c,r===(r=o(s))&&i?i.p(s,d):(i.d(1),i=r(s),i&&(i.c(),i.m(e,null))),d&4&&t!==(t="px-3 py-1.5 rounded-xl w-full text-left "+(s[21]===s[2]?" bg-gray-100 selected-command-option-button":""))&&f(e,"class",t)},d(c){c&&h(e),i.d(),l=!1,ht(n)}}}function ur(s){var d,m;let e,t,l=((m=(d=s[0].split(" "))==null?void 0:d.at(0))==null?void 0:m.substring(1))+"",n,o,r,i=s[1].t("Web")+"",a,u,c;return{c(){e=E("button"),t=E("div"),n=we(l),o=Q(),r=E("div"),a=we(i),this.h()},l(p){e=I(p,"BUTTON",{class:!0,type:!0});var S=y(e);t=I(S,"DIV",{class:!0});var g=y(t);n=ke(g,l),g.forEach(h),o=Y(S),r=I(S,"DIV",{class:!0});var b=y(r);a=ke(b,i),b.forEach(h),S.forEach(h),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(r,"class","text-xs text-gray-600 line-clamp-1"),f(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),f(e,"type","button")},m(p,S){A(p,e,S),v(e,t),v(t,n),v(e,o),v(e,r),v(r,a),u||(c=se(e,"click",s[17]),u=!0)},p(p,S){var g,b;S&1&&l!==(l=((b=(g=p[0].split(" "))==null?void 0:g.at(0))==null?void 0:b.substring(1))+"")&&De(n,l),S&2&&i!==(i=p[1].t("Web")+"")&&De(a,i)},d(p){p&&h(e),u=!1,c()}}}function fr(s){var d,m;let e,t,l=((m=(d=s[0].split(" "))==null?void 0:d.at(0))==null?void 0:m.substring(1))+"",n,o,r,i=s[1].t("Youtube")+"",a,u,c;return{c(){e=E("button"),t=E("div"),n=we(l),o=Q(),r=E("div"),a=we(i),this.h()},l(p){e=I(p,"BUTTON",{class:!0,type:!0});var S=y(e);t=I(S,"DIV",{class:!0});var g=y(t);n=ke(g,l),g.forEach(h),o=Y(S),r=I(S,"DIV",{class:!0});var b=y(r);a=ke(b,i),b.forEach(h),S.forEach(h),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(r,"class","text-xs text-gray-600 line-clamp-1"),f(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),f(e,"type","button")},m(p,S){A(p,e,S),v(e,t),v(t,n),v(e,o),v(e,r),v(r,a),u||(c=se(e,"click",s[16]),u=!0)},p(p,S){var g,b;S&1&&l!==(l=((b=(g=p[0].split(" "))==null?void 0:g.at(0))==null?void 0:b.substring(1))+"")&&De(n,l),S&2&&i!==(i=p[1].t("Youtube")+"")&&De(a,i)},d(p){p&&h(e),u=!1,c()}}}function dr(s){var n,o;let e=s[3].length>0||((o=(n=s[0].split(" "))==null?void 0:n.at(0))==null?void 0:o.substring(1).startsWith("http")),t,l=e&&Pl(s);return{c(){l&&l.c(),t=Pe()},l(r){l&&l.l(r),t=Pe()},m(r,i){l&&l.m(r,i),A(r,t,i)},p(r,[i]){var a,u;i&9&&(e=r[3].length>0||((u=(a=r[0].split(" "))==null?void 0:a.at(0))==null?void 0:u.substring(1).startsWith("http"))),e?l?l.p(r,i):(l=Pl(r),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:ye,o:ye,d(r){r&&h(t),l&&l.d(r)}}}const hr=s=>s.substring(1).startsWith("https://www.youtube.com")||s.substring(1).startsWith("https://youtu.be"),mr=()=>{};function gr(s,e,t){let l,n,o;de(s,Pn,C=>t(13,n=C));const r=ft("i18n");de(s,r,C=>t(1,o=C));let{prompt:i=""}=e;const a=Ct();let u=0,c=[],d=[],m=[];const p=()=>{t(2,u=Math.max(0,u-1))},S=()=>{t(2,u=Math.min(u+1,c.length-1))},g=async C=>{a("select",C),t(0,i=$t(i));const R=document.getElementById("chat-textarea");await Ve(),R==null||R.focus(),await Ve()},b=async C=>{a("url",C),t(0,i=$t(i));const R=document.getElementById("chat-textarea");await Ve(),R==null||R.focus(),await Ve()},_=async C=>{a("youtube",C),t(0,i=$t(i));const R=document.getElementById("chat-textarea");await Ve(),R==null||R.focus(),await Ve()},w=C=>{console.log(C),g(C)},M=C=>{t(2,u=C)},D=()=>{var R,T;const C=(T=(R=i.split(" "))==null?void 0:R.at(0))==null?void 0:T.substring(1);ml(C)?_(C):ve.error(o.t("Oops! Looks like the URL is invalid. Please double-check and try again."))},N=()=>{var R,T;const C=(T=(R=i.split(" "))==null?void 0:R.at(0))==null?void 0:T.substring(1);ml(C)?b(C):ve.error(o.t("Oops! Looks like the URL is invalid. Please double-check and try again."))};return s.$$set=C=>{"prompt"in C&&t(0,i=C.prompt)},s.$$.update=()=>{s.$$.dirty&8194&&t(11,m=[...n.length>0?[{name:"All Documents",type:"collection",title:o.t("All Documents"),collection_names:n.map(C=>C.collection_name)}]:[],...n.reduce((C,R,T,P)=>{var F;return[...new Set([...C,...(((F=R==null?void 0:R.content)==null?void 0:F.tags)??[]).map(H=>H.name)])]},[]).map(C=>({name:C,type:"collection",collection_names:n.filter(R=>{var T;return(((T=R==null?void 0:R.content)==null?void 0:T.tags)??[]).map(P=>P.name).includes(C)}).map(R=>R.collection_name)}))]),s.$$.dirty&2049&&t(12,l=m.filter(C=>{var R,T;return C.name.includes(((T=(R=i.split(" "))==null?void 0:R.at(0))==null?void 0:T.substring(1))??"")}).sort((C,R)=>C.name.localeCompare(R.name))),s.$$.dirty&8193&&t(10,d=n.filter(C=>{var R,T;return C.name.includes(((T=(R=i.split(" "))==null?void 0:R.at(0))==null?void 0:T.substring(1))??"")}).sort((C,R)=>C.title.localeCompare(R.title))),s.$$.dirty&5120&&t(3,c=[...l,...d]),s.$$.dirty&4097&&i&&(t(2,u=0),console.log(l))},[i,o,u,c,r,g,b,_,p,S,d,m,l,n,w,M,D,N]}class pr extends Ye{constructor(e){super(),Xe(this,e,gr,dr,Qe,{prompt:0,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function Rl(s,e,t){const l=s.slice();return l[16]=e[t],l[18]=t,l}function jl(s){let e,t=s[2].length>0&&ql(s);return{c(){t&&t.c(),e=Pe()},l(l){t&&t.l(l),e=Pe()},m(l,n){t&&t.m(l,n),A(l,e,n)},p(l,n){l[2].length>0?t?t.p(l,n):(t=ql(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){l&&h(e),t&&t.d(l)}}}function ql(s){let e,t,l,n='<div class="text-lg font-semibold mt-2">@</div>',o,r,i,a=et(s[2]),u=[];for(let c=0;c<a.length;c+=1)u[c]=Fl(Rl(s,a,c));return{c(){e=E("div"),t=E("div"),l=E("div"),l.innerHTML=n,o=Q(),r=E("div"),i=E("div");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){e=I(c,"DIV",{class:!0});var d=y(e);t=I(d,"DIV",{class:!0});var m=y(t);l=I(m,"DIV",{class:!0,"data-svelte-h":!0}),Je(l)!=="svelte-1ourwwn"&&(l.innerHTML=n),o=Y(m),r=I(m,"DIV",{class:!0});var p=y(r);i=I(p,"DIV",{class:!0});var S=y(i);for(let g=0;g<u.length;g+=1)u[g].l(S);S.forEach(h),p.forEach(h),m.forEach(h),d.forEach(h),this.h()},h(){f(l,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),f(t,"class","flex w-full px-2"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(c,d){A(c,e,d),v(e,t),v(t,l),v(t,o),v(t,r),v(r,i);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(i,null)},p(c,d){if(d&22){a=et(c[2]);let m;for(m=0;m<a.length;m+=1){const p=Rl(c,a,m);u[m]?u[m].p(p,d):(u[m]=Fl(p),u[m].c(),u[m].m(i,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=a.length}},d(c){c&&h(e),vt(u,c)}}}function Fl(s){let e,t,l=s[16].name+"",n,o,r,i,a;function u(){return s[11](s[16])}function c(){return s[12](s[18])}return{c(){e=E("button"),t=E("div"),n=we(l),o=Q(),this.h()},l(d){e=I(d,"BUTTON",{class:!0,type:!0});var m=y(e);t=I(m,"DIV",{class:!0});var p=y(t);n=ke(p,l),p.forEach(h),o=Y(m),m.forEach(h),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(e,"class",r="px-3 py-1.5 rounded-xl w-full text-left "+(s[18]===s[1]?" bg-gray-100 selected-command-option-button":"")),f(e,"type","button")},m(d,m){A(d,e,m),v(e,t),v(t,n),v(e,o),i||(a=[se(e,"click",u),se(e,"mousemove",c),se(e,"focus",vr)],i=!0)},p(d,m){s=d,m&4&&l!==(l=s[16].name+"")&&De(n,l),m&2&&r!==(r="px-3 py-1.5 rounded-xl w-full text-left "+(s[18]===s[1]?" bg-gray-100 selected-command-option-button":""))&&f(e,"class",r)},d(d){d&&h(e),i=!1,ht(a)}}}function _r(s){let e=s[0].charAt(0)==="@",t,l=e&&jl(s);return{c(){l&&l.c(),t=Pe()},l(n){l&&l.l(n),t=Pe()},m(n,o){l&&l.m(n,o),A(n,t,o)},p(n,[o]){o&1&&(e=n[0].charAt(0)==="@"),e?l?l.p(n,o):(l=jl(n),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:ye,o:ye,d(n){n&&h(t),l&&l.d(n)}}}const vr=()=>{};function br(s,e,t){let l;de(s,Ut,_=>t(10,l=_));const n=ft("i18n");de(s,n,_=>t(13,_));const o=Ct();let{prompt:r=""}=e,{user:i=null}=e,{chatInputPlaceholder:a=""}=e,{messages:u=[]}=e,c=0,d=[];const m=()=>{t(1,c=Math.max(0,c-1))},p=()=>{t(1,c=Math.min(c+1,d.length-1))},S=async _=>{t(0,r=""),o("select",_)},g=_=>{S(_)},b=_=>{t(1,c=_)};return s.$$set=_=>{"prompt"in _&&t(0,r=_.prompt),"user"in _&&t(5,i=_.user),"chatInputPlaceholder"in _&&t(6,a=_.chatInputPlaceholder),"messages"in _&&t(7,u=_.messages)},s.$$.update=()=>{s.$$.dirty&1025&&t(2,d=l.filter(_=>{var w,M;return _.name.includes(((M=(w=r.split(" "))==null?void 0:w.at(0))==null?void 0:M.substring(1))??"")}).sort((_,w)=>_.name.localeCompare(w.name))),s.$$.dirty&1&&r&&t(1,c=0)},[r,c,d,n,S,i,a,u,m,p,l,g,b]}class wr extends Ye{constructor(e){super(),Xe(this,e,br,_r,Qe,{prompt:0,user:5,chatInputPlaceholder:6,messages:7,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function kr(s){let e,t;return{c(){e=pe("svg"),t=pe("path"),this.h()},l(l){e=_e(l,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var n=y(e);t=_e(n,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),y(t).forEach(h),n.forEach(h),this.h()},h(){f(t,"stroke-linecap","round"),f(t,"stroke-linejoin","round"),f(t,"d","M6 18 18 6M6 6l12 12"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width",s[1]),f(e,"stroke","currentColor"),f(e,"class",s[0])},m(l,n){A(l,e,n),v(e,t)},p(l,[n]){n&2&&f(e,"stroke-width",l[1]),n&1&&f(e,"class",l[0])},i:ye,o:ye,d(l){l&&h(e)}}}function yr(s,e,t){let{className:l="size-3.5"}=e,{strokeWidth:n="2"}=e;return s.$$set=o=>{"className"in o&&t(0,l=o.className),"strokeWidth"in o&&t(1,n=o.strokeWidth)},[l,n]}class Er extends Ye{constructor(e){super(),Xe(this,e,yr,kr,Qe,{className:0,strokeWidth:1})}}function Ir(s){let e,t,l;return{c(){e=pe("svg"),t=pe("path"),l=pe("path"),this.h()},l(n){e=_e(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var o=y(e);t=_e(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),y(t).forEach(h),l=_e(o,"path",{d:!0}),y(l).forEach(h),o.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z"),f(t,"clip-rule","evenodd"),f(l,"d","M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",s[0])},m(n,o){A(n,e,o),v(e,t),v(e,l)},p(n,[o]){o&1&&f(e,"class",n[0])},i:ye,o:ye,d(n){n&&h(e)}}}function Sr(s,e,t){let{className:l="size-4"}=e;return s.$$set=n=>{"className"in n&&t(0,l=n.className)},[l]}class Dr extends Ye{constructor(e){super(),Xe(this,e,Sr,Ir,Qe,{className:0})}}function Mr(s){let e,t;return{c(){e=pe("svg"),t=pe("path"),this.h()},l(l){e=_e(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var n=y(e);t=_e(n,"path",{d:!0}),y(t).forEach(h),n.forEach(h),this.h()},h(){f(t,"d","M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",s[0])},m(l,n){A(l,e,n),v(e,t)},p(l,[n]){n&1&&f(e,"class",l[0])},i:ye,o:ye,d(l){l&&h(e)}}}function Cr(s,e,t){let{className:l="size-4"}=e;return s.$$set=n=>{"className"in n&&t(0,l=n.className)},[l]}class Tr extends Ye{constructor(e){super(),Xe(this,e,Cr,Mr,Qe,{className:0})}}function Vr(s){let e,t;return{c(){e=pe("svg"),t=pe("path"),this.h()},l(l){e=_e(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var n=y(e);t=_e(n,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),y(t).forEach(h),n.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M12 6.75a5.25 5.25 0 0 1 6.775-5.025.75.75 0 0 1 .313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 0 1 1.248.313 5.25 5.25 0 0 1-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 1 1 2.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0 1 12 6.75ZM4.117 19.125a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75h-.008a.75.75 0 0 1-.75-.75v-.008Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",s[0])},m(l,n){A(l,e,n),v(e,t)},p(l,[n]){n&1&&f(e,"class",l[0])},i:ye,o:ye,d(l){l&&h(e)}}}function Br(s,e,t){let{className:l="size-4"}=e;return s.$$set=n=>{"className"in n&&t(0,l=n.className)},[l]}class Nr extends Ye{constructor(e){super(),Xe(this,e,Br,Vr,Qe,{className:0})}}function Wl(s,e,t){const l=s.slice();return l[17]=e[t],l[18]=e,l[19]=t,l}function Lr(s){let e;const t=s[9].default,l=it(t,s,s[16],null);return{c(){l&&l.c()},l(n){l&&l.l(n)},m(n,o){l&&l.m(n,o),e=!0},p(n,o){l&&l.p&&(!e||o&65536)&&at(l,t,n,n[16],e?ut(t,n[16],o,null):ct(n[16]),null)},i(n){e||(O(l,n),e=!0)},o(n){U(l,n),e=!1},d(n){l&&l.d(n)}}}function Or(s){let e,t;return e=new pt({props:{content:s[7].t("More"),$$slots:{default:[Lr]},$$scope:{ctx:s}}}),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,n){const o={};n&128&&(o.content=l[7].t("More")),n&65536&&(o.$$scope={dirty:n,ctx:l}),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function Zl(s){let e,t,l,n,o=et(Object.keys(s[1])),r=[];for(let a=0;a<o.length;a+=1)r[a]=Gl(Wl(s,o,a));const i=a=>U(r[a],1,1,()=>{r[a]=null});return{c(){e=E("div");for(let a=0;a<r.length;a+=1)r[a].c();t=Q(),l=E("hr"),this.h()},l(a){e=I(a,"DIV",{class:!0});var u=y(e);for(let c=0;c<r.length;c+=1)r[c].l(u);u.forEach(h),t=Y(a),l=I(a,"HR",{class:!0}),this.h()},h(){f(e,"class","max-h-28 overflow-y-auto scrollbar-hidden"),f(l,"class","border-gray-100 dark:border-gray-800 my-1")},m(a,u){A(a,e,u);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);A(a,t,u),A(a,l,u),n=!0},p(a,u){if(u&3){o=et(Object.keys(a[1]));let c;for(c=0;c<o.length;c+=1){const d=Wl(a,o,c);r[c]?(r[c].p(d,u),O(r[c],1)):(r[c]=Gl(d),r[c].c(),O(r[c],1),r[c].m(e,null))}for(ze(),c=o.length;c<r.length;c+=1)i(c);Re()}},i(a){if(!n){for(let u=0;u<o.length;u+=1)O(r[u]);n=!0}},o(a){r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)U(r[u]);n=!1},d(a){a&&(h(e),h(t),h(l)),vt(r,a)}}}function Hr(s){let e,t=s[1][s[17]].name+"",l;return{c(){e=E("div"),l=we(t),this.h()},l(n){e=I(n,"DIV",{class:!0});var o=y(e);l=ke(o,t),o.forEach(h),this.h()},h(){f(e,"class","line-clamp-1")},m(n,o){A(n,e,o),v(e,l)},p(n,o){o&2&&t!==(t=n[1][n[17]].name+"")&&De(l,t)},d(n){n&&h(e)}}}function Gl(s){var S;let e,t,l,n,o,r,i,a,u,c;l=new Nr({}),o=new pt({props:{content:((S=s[1][s[17]])==null?void 0:S.description)??"",className:"flex-1",$$slots:{default:[Hr]},$$scope:{ctx:s}}});function d(g){s[10](g,s[17])}function m(...g){return s[11](s[17],...g)}let p={};return s[1][s[17]].enabled!==void 0&&(p.state=s[1][s[17]].enabled),i=new Cn({props:p}),be.push(()=>Ae(i,"state",d)),i.$on("change",m),{c(){e=E("div"),t=E("div"),ie(l.$$.fragment),n=Q(),ie(o.$$.fragment),r=Q(),ie(i.$$.fragment),u=Q(),this.h()},l(g){e=I(g,"DIV",{class:!0});var b=y(e);t=I(b,"DIV",{class:!0});var _=y(t);ae(l.$$.fragment,_),n=Y(_),ae(o.$$.fragment,_),_.forEach(h),r=Y(b),ae(i.$$.fragment,b),u=Y(b),b.forEach(h),this.h()},h(){f(t,"class","flex-1 flex items-center gap-2"),f(e,"class","flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl")},m(g,b){A(g,e,b),v(e,t),ce(l,t,null),v(t,n),ce(o,t,null),v(e,r),ce(i,e,null),v(e,u),c=!0},p(g,b){var M;s=g;const _={};b&2&&(_.content=((M=s[1][s[17]])==null?void 0:M.description)??""),b&65538&&(_.$$scope={dirty:b,ctx:s}),o.$set(_);const w={};!a&&b&2&&(a=!0,w.state=s[1][s[17]].enabled,He(()=>a=!1)),i.$set(w)},i(g){c||(O(l.$$.fragment,g),O(o.$$.fragment,g),O(i.$$.fragment,g),c=!0)},o(g){U(l.$$.fragment,g),U(o.$$.fragment,g),U(i.$$.fragment,g),c=!1},d(g){g&&h(e),ue(l),ue(o),ue(i)}}}function Jl(s){let e,t,l,n,o,r=s[7].t("Web Search")+"",i,a,u,c,d,m,p;l=new Tr({});function S(b){s[12](b)}let g={};return s[2]!==void 0&&(g.state=s[2]),u=new Cn({props:g}),be.push(()=>Ae(u,"state",S)),{c(){e=E("div"),t=E("div"),ie(l.$$.fragment),n=Q(),o=E("div"),i=we(r),a=Q(),ie(u.$$.fragment),d=Q(),m=E("hr"),this.h()},l(b){e=I(b,"DIV",{class:!0});var _=y(e);t=I(_,"DIV",{class:!0});var w=y(t);ae(l.$$.fragment,w),n=Y(w),o=I(w,"DIV",{class:!0});var M=y(o);i=ke(M,r),M.forEach(h),w.forEach(h),a=Y(_),ae(u.$$.fragment,_),_.forEach(h),d=Y(b),m=I(b,"HR",{class:!0}),this.h()},h(){f(o,"class","line-clamp-1"),f(t,"class","flex-1 flex items-center gap-2"),f(e,"class","flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl"),f(m,"class","border-gray-100 dark:border-gray-800 my-1")},m(b,_){A(b,e,_),v(e,t),ce(l,t,null),v(t,n),v(t,o),v(o,i),v(e,a),ce(u,e,null),A(b,d,_),A(b,m,_),p=!0},p(b,_){(!p||_&128)&&r!==(r=b[7].t("Web Search")+"")&&De(i,r);const w={};!c&&_&4&&(c=!0,w.state=b[2],He(()=>c=!1)),u.$set(w)},i(b){p||(O(l.$$.fragment,b),O(u.$$.fragment,b),p=!0)},o(b){U(l.$$.fragment,b),U(u.$$.fragment,b),p=!1},d(b){b&&(h(e),h(d),h(m)),ue(l),ue(u)}}}function Ar(s){let e,t,l,n=s[7].t("Upload Files")+"",o,r;return e=new Dr({}),{c(){ie(e.$$.fragment),t=Q(),l=E("div"),o=we(n),this.h()},l(i){ae(e.$$.fragment,i),t=Y(i),l=I(i,"DIV",{class:!0});var a=y(l);o=ke(a,n),a.forEach(h),this.h()},h(){f(l,"class","line-clamp-1")},m(i,a){ce(e,i,a),A(i,t,a),A(i,l,a),v(l,o),r=!0},p(i,a){(!r||a&128)&&n!==(n=i[7].t("Upload Files")+"")&&De(o,n)},i(i){r||(O(e.$$.fragment,i),r=!0)},o(i){U(e.$$.fragment,i),r=!1},d(i){i&&(h(t),h(l)),ue(e,i)}}}function Ur(s){var a,u;let e=Object.keys(s[1]).length>0,t,l,n,o,r=e&&Zl(s),i=((u=(a=s[6])==null?void 0:a.features)==null?void 0:u.enable_web_search)&&Jl(s);return n=new Et({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl",$$slots:{default:[Ar]},$$scope:{ctx:s}}}),n.$on("click",s[13]),{c(){r&&r.c(),t=Q(),i&&i.c(),l=Q(),ie(n.$$.fragment)},l(c){r&&r.l(c),t=Y(c),i&&i.l(c),l=Y(c),ae(n.$$.fragment,c)},m(c,d){r&&r.m(c,d),A(c,t,d),i&&i.m(c,d),A(c,l,d),ce(n,c,d),o=!0},p(c,d){var p,S;d&2&&(e=Object.keys(c[1]).length>0),e?r?(r.p(c,d),d&2&&O(r,1)):(r=Zl(c),r.c(),O(r,1),r.m(t.parentNode,t)):r&&(ze(),U(r,1,1,()=>{r=null}),Re()),(S=(p=c[6])==null?void 0:p.features)!=null&&S.enable_web_search?i?(i.p(c,d),d&64&&O(i,1)):(i=Jl(c),i.c(),O(i,1),i.m(l.parentNode,l)):i&&(ze(),U(i,1,1,()=>{i=null}),Re());const m={};d&65664&&(m.$$scope={dirty:d,ctx:c}),n.$set(m)},i(c){o||(O(r),O(i),O(n.$$.fragment,c),o=!0)},o(c){U(r),U(i),U(n.$$.fragment,c),o=!1},d(c){c&&(h(t),h(l)),r&&r.d(c),i&&i.d(c),ue(n,c)}}}function Pr(s){let e,t,l;return t=new ol({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow",sideOffset:15,alignOffset:-8,side:"top",align:"start",transition:Pt,$$slots:{default:[Ur]},$$scope:{ctx:s}}}),{c(){e=E("div"),ie(t.$$.fragment),this.h()},l(n){e=I(n,"DIV",{slot:!0});var o=y(e);ae(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(n,o){A(n,e,o),ce(t,e,null),l=!0},p(n,o){const r={};o&65743&&(r.$$scope={dirty:o,ctx:n}),t.$set(r)},i(n){l||(O(t.$$.fragment,n),l=!0)},o(n){U(t.$$.fragment,n),l=!1},d(n){n&&h(e),ue(t)}}}function zr(s){let e,t,l;function n(r){s[14](r)}let o={$$slots:{content:[Pr],default:[Or]},$$scope:{ctx:s}};return s[5]!==void 0&&(o.show=s[5]),e=new rl({props:o}),be.push(()=>Ae(e,"show",n)),e.$on("change",s[15]),{c(){ie(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,i){ce(e,r,i),l=!0},p(r,[i]){const a={};i&65743&&(a.$$scope={dirty:i,ctx:r}),!t&&i&32&&(t=!0,a.show=r[5],He(()=>t=!1)),e.$set(a)},i(r){l||(O(e.$$.fragment,r),l=!0)},o(r){U(e.$$.fragment,r),l=!1},d(r){ue(e,r)}}}function Rr(s,e,t){let l,n;de(s,Tt,D=>t(6,l=D));let{$$slots:o={},$$scope:r}=e;const i=ft("i18n");de(s,i,D=>t(7,n=D));let{uploadFilesHandler:a}=e,{selectedToolIds:u=[]}=e,{webSearchEnabled:c}=e,{tools:d={}}=e,{onClose:m}=e,p=!1;function S(D,N){s.$$.not_equal(d[N].enabled,D)&&(d[N].enabled=D,t(1,d),t(0,u))}const g=(D,N)=>{t(0,u=N.detail?[...u,D]:u.filter(C=>C!==D))};function b(D){c=D,t(2,c)}const _=()=>{a()};function w(D){p=D,t(5,p)}const M=D=>{D.detail===!1&&m()};return s.$$set=D=>{"uploadFilesHandler"in D&&t(3,a=D.uploadFilesHandler),"selectedToolIds"in D&&t(0,u=D.selectedToolIds),"webSearchEnabled"in D&&t(2,c=D.webSearchEnabled),"tools"in D&&t(1,d=D.tools),"onClose"in D&&t(4,m=D.onClose),"$$scope"in D&&t(16,r=D.$$scope)},s.$$.update=()=>{s.$$.dirty&3&&t(1,d=Object.fromEntries(Object.keys(d).map(D=>[D,{...d[D],enabled:u.includes(D)}])))},[u,d,c,a,m,p,l,n,i,o,S,g,b,_,w,M,r]}class jr extends Ye{constructor(e){super(),Xe(this,e,Rr,zr,Qe,{uploadFilesHandler:3,selectedToolIds:0,webSearchEnabled:2,tools:1,onClose:4})}}function qr(s){let e,t;return{c(){e=pe("svg"),t=pe("path"),this.h()},l(l){e=_e(l,"svg",{"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var n=y(e);t=_e(n,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),y(t).forEach(h),n.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z"),f(t,"clip-rule","evenodd"),f(e,"aria-hidden","true"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","currentColor"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width",s[1]),f(e,"stroke","currentColor"),f(e,"class",s[0])},m(l,n){A(l,e,n),v(e,t)},p(l,[n]){n&2&&f(e,"stroke-width",l[1]),n&1&&f(e,"class",l[0])},i:ye,o:ye,d(l){l&&h(e)}}}function Fr(s,e,t){let{className:l="w-4 h-4"}=e,{strokeWidth:n="0"}=e;return s.$$set=o=>{"className"in o&&t(0,l=o.className),"strokeWidth"in o&&t(1,n=o.strokeWidth)},[l,n]}class Wr extends Ye{constructor(e){super(),Xe(this,e,Fr,qr,Qe,{className:0,strokeWidth:1})}}function Ql(s,e,t){const l=s.slice();return l[29]=e[t],l}function Yl(s){let e,t;return{c(){e=E("div"),this.h()},l(l){e=I(l,"DIV",{class:!0,style:!0}),y(e).forEach(h),this.h()},h(){f(e,"class",t="w-[2px] "+(s[0]?" bg-gray-500 dark:bg-gray-400   ":"bg-indigo-500 dark:bg-indigo-400  ")+" inline-block h-full"),Bt(e,"height",Math.min(100,Math.max(14,s[29]*100))+"%")},m(l,n){A(l,e,n)},p(l,n){n[0]&1&&t!==(t="w-[2px] "+(l[0]?" bg-gray-500 dark:bg-gray-400   ":"bg-indigo-500 dark:bg-indigo-400  ")+" inline-block h-full")&&f(e,"class",t),n[0]&4&&Bt(e,"height",Math.min(100,Math.max(14,l[29]*100))+"%")},d(l){l&&h(e)}}}function Zr(s){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-4"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>',l,n;return{c(){e=E("button"),e.innerHTML=t,this.h()},l(o){e=I(o,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Je(e)!=="svelte-1qzkal"&&(e.innerHTML=t),this.h()},h(){f(e,"type","button"),f(e,"class","p-1.5 bg-indigo-500 text-white dark:bg-indigo-500 dark:text-blue-950 rounded-full")},m(o,r){A(o,e,r),l||(n=se(e,"click",s[10]),l=!0)},p:ye,d(o){o&&h(e),l=!1,n()}}}function Gr(s){let e,t=`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><style>.spinner_OSmW {
							transform-origin: center;
							animation: spinner_T6mA 0.75s step-end infinite;
						}
						@keyframes spinner_T6mA {
							8.3% {
								transform: rotate(30deg);
							}
							16.6% {
								transform: rotate(60deg);
							}
							25% {
								transform: rotate(90deg);
							}
							33.3% {
								transform: rotate(120deg);
							}
							41.6% {
								transform: rotate(150deg);
							}
							50% {
								transform: rotate(180deg);
							}
							58.3% {
								transform: rotate(210deg);
							}
							66.6% {
								transform: rotate(240deg);
							}
							75% {
								transform: rotate(270deg);
							}
							83.3% {
								transform: rotate(300deg);
							}
							91.6% {
								transform: rotate(330deg);
							}
							100% {
								transform: rotate(360deg);
							}
						}
					</style><g class="spinner_OSmW"><rect x="11" y="1" width="2" height="5" opacity=".14"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(30 12 12)" opacity=".29"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(60 12 12)" opacity=".43"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(90 12 12)" opacity=".57"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(120 12 12)" opacity=".71"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(150 12 12)" opacity=".86"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(180 12 12)"></rect></g></svg>`;return{c(){e=E("div"),e.innerHTML=t,this.h()},l(l){e=I(l,"DIV",{class:!0,"data-svelte-h":!0}),Je(e)!=="svelte-otpw2s"&&(e.innerHTML=t),this.h()},h(){f(e,"class","text-gray-500 rounded-full cursor-not-allowed")},m(l,n){A(l,e,n)},p:ye,d(l){l&&h(e)}}}function Jr(s){let e,t,l,n,o,r,i,a,u,c,d,m,p=s[5](s[1])+"",S,g,b,_,w,M,D,N=et(s[2].slice().reverse()),C=[];for(let F=0;F<N.length;F+=1)C[F]=Yl(Ql(s,N,F));function R(F,H){return F[0]?Gr:Zr}let T=R(s),P=T(s);return{c(){e=E("div"),t=E("div"),l=E("button"),n=pe("svg"),o=pe("path"),i=Q(),a=E("div"),u=E("div");for(let F=0;F<C.length;F+=1)C[F].c();c=Q(),d=E("div"),m=E("div"),S=we(p),b=Q(),_=E("div"),P.c(),this.h()},l(F){e=I(F,"DIV",{class:!0});var H=y(e);t=I(H,"DIV",{class:!0});var j=y(t);l=I(j,"BUTTON",{type:!0,class:!0});var re=y(l);n=_e(re,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var x=y(n);o=_e(x,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),y(o).forEach(h),x.forEach(h),re.forEach(h),j.forEach(h),i=Y(H),a=I(H,"DIV",{class:!0,dir:!0});var V=y(a);u=I(V,"DIV",{class:!0});var L=y(u);for(let te=0;te<C.length;te+=1)C[te].l(L);L.forEach(h),V.forEach(h),c=Y(H),d=I(H,"DIV",{class:!0});var q=y(d);m=I(q,"DIV",{class:!0});var J=y(m);S=ke(J,p),J.forEach(h),q.forEach(h),b=Y(H),_=I(H,"DIV",{class:!0});var W=y(_);P.l(W),W.forEach(h),H.forEach(h),this.h()},h(){f(o,"stroke-linecap","round"),f(o,"stroke-linejoin","round"),f(o,"d","M6 18 18 6M6 6l12 12"),f(n,"xmlns","http://www.w3.org/2000/svg"),f(n,"fill","none"),f(n,"viewBox","0 0 24 24"),f(n,"stroke-width","3"),f(n,"stroke","currentColor"),f(n,"class","size-4"),f(l,"type","button"),f(l,"class",r="p-1.5 "+(s[0]?" bg-gray-200 dark:bg-gray-700/50":"bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 ")+" rounded-full"),f(t,"class","flex items-center mr-1"),f(u,"class","flex-1 flex items-center gap-0.5 h-6"),f(a,"class","flex flex-1 self-center items-center justify-between ml-2 mx-1 overflow-hidden h-6"),f(a,"dir","rtl"),f(m,"class",g="text-sm "+(s[0]?" text-gray-500  dark:text-gray-400  ":" text-indigo-400 ")+" font-medium flex-1 mx-auto text-center"),f(d,"class","mx-1.5 pr-1 flex justify-center items-center"),f(_,"class","flex items-center mr-1"),f(e,"class",w=(s[0]?" bg-gray-100/50 dark:bg-gray-850/50":"bg-indigo-300/10 dark:bg-indigo-500/10 ")+" rounded-full flex p-2.5")},m(F,H){A(F,e,H),v(e,t),v(t,l),v(l,n),v(n,o),v(e,i),v(e,a),v(a,u);for(let j=0;j<C.length;j+=1)C[j]&&C[j].m(u,null);v(e,c),v(e,d),v(d,m),v(m,S),v(e,b),v(e,_),P.m(_,null),M||(D=se(l,"click",s[9]),M=!0)},p(F,H){if(H[0]&1&&r!==(r="p-1.5 "+(F[0]?" bg-gray-200 dark:bg-gray-700/50":"bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 ")+" rounded-full")&&f(l,"class",r),H[0]&5){N=et(F[2].slice().reverse());let j;for(j=0;j<N.length;j+=1){const re=Ql(F,N,j);C[j]?C[j].p(re,H):(C[j]=Yl(re),C[j].c(),C[j].m(u,null))}for(;j<C.length;j+=1)C[j].d(1);C.length=N.length}H[0]&2&&p!==(p=F[5](F[1])+"")&&De(S,p),H[0]&1&&g!==(g="text-sm "+(F[0]?" text-gray-500  dark:text-gray-400  ":" text-indigo-400 ")+" font-medium flex-1 mx-auto text-center")&&f(m,"class",g),T===(T=R(F))&&P?P.p(F,H):(P.d(1),P=T(F),P&&(P.c(),P.m(_,null))),H[0]&1&&w!==(w=(F[0]?" bg-gray-100/50 dark:bg-gray-850/50":"bg-indigo-300/10 dark:bg-indigo-500/10 ")+" rounded-full flex p-2.5")&&f(e,"class",w)},i:ye,o:ye,d(F){F&&h(e),vt(C,F),P.d(),M=!1,D()}}}const Xl=300;function Qr(s,e,t){let l,n,o;de(s,dt,V=>t(18,n=V)),de(s,Tt,V=>t(19,o=V));const r=ft("i18n");de(s,r,V=>t(17,l=V));const i=Ct();let{recording:a=!1}=e,u=!1,c=!1,d=0,m=null,p="";const S=()=>{m=setInterval(()=>{t(1,d++,d)},1e3)},g=()=>{clearInterval(m),t(1,d=0)},b=V=>{const L=Math.floor(V/60),q=V%60,J=q<10?`0${q}`:q;return`${L}:${J}`};let _,w,M=[];const D=-45;let N=Array(Xl).fill(0);const C=V=>{let L=0;for(let q=0;q<V.length;q++){const J=(V[q]-128)/128;L+=J*J}return Math.sqrt(L/V.length)},R=V=>{V=V*10;const q=Math.pow(V,1.5);return Math.min(1,Math.max(.01,q))},T=V=>{const L=new AudioContext,q=L.createMediaStreamSource(V),J=L.createAnalyser();J.minDecibels=D,q.connect(J);const W=J.frequencyBinCount,te=new Uint8Array(W),Be=new Uint8Array(J.fftSize);(()=>{const $e=()=>{if(!(!a||u)){if(a&&!u){J.getByteTimeDomainData(Be),J.getByteFrequencyData(te);const We=C(Be);N.push(R(We)),N.length>=Xl&&N.shift(),t(2,N)}window.requestAnimationFrame($e)}};window.requestAnimationFrame($e)})()},P=async V=>{await Ve();const L=sl(V,"recording.wav"),q=await il(localStorage.token,L).catch(J=>(ve.error(J),null));q&&(console.log(q.text),i("confirm",q.text))},F=async()=>{var L,q;S();const V=await navigator.mediaDevices.getUserMedia({audio:!0});if(w=new MediaRecorder(V),w.onstart=()=>{console.log("Recording started"),M=[],T(V)},w.ondataavailable=J=>M.push(J.data),w.onstop=async()=>{var J,W;if(console.log("Recording stopped"),(((W=(J=n==null?void 0:n.audio)==null?void 0:J.stt)==null?void 0:W.engine)??"")==="web")M=[];else{if(c){const te=new Blob(M,{type:"audio/wav"});await P(te),c=!1,t(0,u=!1)}M=[],t(8,a=!1)}},w.start(),(o.audio.stt.engine==="web"||(((q=(L=n==null?void 0:n.audio)==null?void 0:L.stt)==null?void 0:q.engine)??"")==="web")&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)){_=new(window.SpeechRecognition||window.webkitSpeechRecognition),_.continuous=!0;const J=2e3;let W;_.start(),_.onresult=async te=>{var qe;clearTimeout(W),console.log(te);const Be=te.results[Object.keys(te.results).length-1][0].transcript;p=`${p}${Be}`,await Ve(),(qe=document.getElementById("chat-textarea"))==null||qe.focus(),W=setTimeout(()=>{console.log("Speech recognition turned off due to inactivity."),_.stop()},J)},_.onend=function(){console.log("recognition ended"),j(),i("confirm",p),c=!1,t(0,u=!1)},_.onerror=function(te){console.log(te),ve.error(l.t("Speech recognition error: {{error}}",{error:te.error})),i("cancel"),H()}}},H=async()=>{a&&w&&await w.stop(),g(),M=[]},j=async()=>{t(0,u=!0),c=!0,a&&w&&await w.stop(),clearInterval(m)},re=async()=>{i("cancel"),H()},x=async()=>{await j()};return s.$$set=V=>{"recording"in V&&t(8,a=V.recording)},s.$$.update=()=>{s.$$.dirty[0]&256&&(a?F():H())},[u,d,N,r,i,b,H,j,a,re,x]}class Yr extends Ye{constructor(e){super(),Xe(this,e,Qr,Jr,Qe,{recording:8},null,[-1,-1])}}function Kl(s,e,t){const l=s.slice();return l[75]=e[t],l[77]=t,l}function xl(s){let e,t,l,n,o,r,i;return o=new us({}),{c(){e=E("div"),t=E("div"),l=E("div"),n=E("div"),ie(o.$$.fragment),this.h()},l(a){e=I(a,"DIV",{class:!0,id:!0,role:!0,"aria-label":!0});var u=y(e);t=I(u,"DIV",{class:!0});var c=y(t);l=I(c,"DIV",{class:!0});var d=y(l);n=I(d,"DIV",{class:!0});var m=y(n);ae(o.$$.fragment,m),m.forEach(h),d.forEach(h),c.forEach(h),u.forEach(h),this.h()},h(){f(n,"class","max-w-md"),f(l,"class","m-auto pt-64 flex flex-col justify-center"),f(t,"class","absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center"),f(e,"class",r="fixed "+(s[24]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"),f(e,"id","dropzone"),f(e,"role","region"),f(e,"aria-label","Drag and Drop Container")},m(a,u){A(a,e,u),v(e,t),v(t,l),v(l,n),ce(o,n,null),i=!0},p(a,u){(!i||u[0]&16777216&&r!==(r="fixed "+(a[24]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"))&&f(e,"class",r)},i(a){i||(O(o.$$.fragment,a),i=!0)},o(a){U(o.$$.fragment,a),i=!1},d(a){a&&h(e),ue(o)}}}function $l(s){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg>',n,o;return{c(){e=E("div"),t=E("button"),t.innerHTML=l,this.h()},l(r){e=I(r,"DIV",{class:!0});var i=y(e);t=I(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Je(t)!=="svelte-a2mahu"&&(t.innerHTML=l),i.forEach(h),this.h()},h(){f(t,"class","bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full"),f(e,"class","absolute -top-12 left-0 right-0 flex justify-center z-30")},m(r,i){A(r,e,i),v(e,t),n||(o=se(t,"click",s[35]),n=!0)},p:ye,d(r){r&&h(e),n=!1,o()}}}function Xr(s){let e,t,l;function n(r){s[40](r)}let o={};return s[1]!==void 0&&(o.prompt=s[1]),e=new pr({props:o}),s[39](e),be.push(()=>Ae(e,"prompt",n)),e.$on("youtube",s[41]),e.$on("url",s[42]),e.$on("select",s[43]),{c(){ie(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,i){ce(e,r,i),l=!0},p(r,i){const a={};!t&&i[0]&2&&(t=!0,a.prompt=r[1],He(()=>t=!1)),e.$set(a)},i(r){l||(O(e.$$.fragment,r),l=!0)},o(r){U(e.$$.fragment,r),l=!1},d(r){s[39](null),ue(e,r)}}}function Kr(s){let e,t,l,n;function o(a){s[37](a)}function r(a){s[38](a)}let i={};return s[1]!==void 0&&(i.prompt=s[1]),s[3]!==void 0&&(i.files=s[3]),e=new ir({props:i}),s[36](e),be.push(()=>Ae(e,"prompt",o)),be.push(()=>Ae(e,"files",r)),{c(){ie(e.$$.fragment)},l(a){ae(e.$$.fragment,a)},m(a,u){ce(e,a,u),n=!0},p(a,u){const c={};!t&&u[0]&2&&(t=!0,c.prompt=a[1],He(()=>t=!1)),!l&&u[0]&8&&(l=!0,c.files=a[3],He(()=>l=!1)),e.$set(c)},i(a){n||(O(e.$$.fragment,a),n=!0)},o(a){U(e.$$.fragment,a),n=!1},d(a){s[36](null),ue(e,a)}}}function en(s){let e,t,l,n,o,r,i,a,u=s[0].name+"",c,d,m,p,S,g,b,_;return S=new Er({}),{c(){e=E("div"),t=E("div"),l=E("img"),o=Q(),r=E("div"),i=we("Talking to "),a=E("span"),c=we(u),d=Q(),m=E("div"),p=E("button"),ie(S.$$.fragment),this.h()},l(w){e=I(w,"DIV",{class:!0});var M=y(e);t=I(M,"DIV",{class:!0});var D=y(t);l=I(D,"IMG",{crossorigin:!0,alt:!0,class:!0,src:!0}),o=Y(D),r=I(D,"DIV",{});var N=y(r);i=ke(N,"Talking to "),a=I(N,"SPAN",{class:!0});var C=y(a);c=ke(C,u),C.forEach(h),N.forEach(h),D.forEach(h),d=Y(M),m=I(M,"DIV",{});var R=y(m);p=I(R,"BUTTON",{class:!0});var T=y(p);ae(S.$$.fragment,T),T.forEach(h),R.forEach(h),M.forEach(h),this.h()},h(){var w,M,D;f(l,"crossorigin","anonymous"),f(l,"alt","model profile"),f(l,"class","size-5 max-w-[28px] object-cover rounded-full"),kt(l.src,n=((D=(M=(w=s[12].find(s[49]))==null?void 0:w.info)==null?void 0:M.meta)==null?void 0:D.profile_image_url)??(s[23].language==="dg-DG"?"/doge.png":`${Ot}/static/favicon.png`))||f(l,"src",n),f(a,"class","font-medium"),f(t,"class","flex items-center gap-2 text-sm dark:text-gray-500"),f(p,"class","flex items-center"),f(e,"class","px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900")},m(w,M){A(w,e,M),v(e,t),v(t,l),v(t,o),v(t,r),v(r,i),v(r,a),v(a,c),v(e,d),v(e,m),v(m,p),ce(S,p,null),g=!0,b||(_=se(p,"click",s[50]),b=!0)},p(w,M){var D,N,C;(!g||M[0]&8392705&&!kt(l.src,n=((C=(N=(D=w[12].find(w[49]))==null?void 0:D.info)==null?void 0:N.meta)==null?void 0:C.profile_image_url)??(w[23].language==="dg-DG"?"/doge.png":`${Ot}/static/favicon.png`)))&&f(l,"src",n),(!g||M[0]&1)&&u!==(u=w[0].name+"")&&De(c,u)},i(w){g||(O(S.$$.fragment,w),g=!0)},o(w){U(S.$$.fragment,w),g=!1},d(w){w&&h(e),ue(S),b=!1,_()}}}function xr(s){let e,t,l,n,o,r,i,a,u,c,d,m,p,S=s[10].length==0||s[10].at(-1).done==!0,g,b,_,w,M,D,N,C,R,T=s[3].length>0&&tn(s);function P(L){s[62](L)}function F(L){s[63](L)}let H={tools:s[26].reduce(s[59],{}),uploadFilesHandler:s[60],onClose:s[61],$$slots:{default:[oo]},$$scope:{ctx:s}};s[5]!==void 0&&(H.webSearchEnabled=s[5]),s[4]!==void 0&&(H.selectedToolIds=s[4]),r=new jr({props:H}),be.push(()=>Ae(r,"webSearchEnabled",P)),be.push(()=>Ae(r,"selectedToolIds",F));let j=S&&sn(s);const re=[co,ao],x=[];function V(L,q){return q[0]&1024&&(w=null),w==null&&(w=L[10].length==0||L[10].at(-1).done==!0),w?0:1}return M=V(s,[-1,-1,-1]),D=x[M]=re[M](s),{c(){e=E("form"),t=E("div"),T&&T.c(),l=Q(),n=E("div"),o=E("div"),ie(r.$$.fragment),u=Q(),c=E("textarea"),m=Q(),p=E("div"),j&&j.c(),b=Q(),_=E("div"),D.c(),this.h()},l(L){e=I(L,"FORM",{class:!0});var q=y(e);t=I(q,"DIV",{class:!0,dir:!0});var J=y(t);T&&T.l(J),l=Y(J),n=I(J,"DIV",{class:!0});var W=y(n);o=I(W,"DIV",{class:!0});var te=y(o);ae(r.$$.fragment,te),te.forEach(h),u=Y(W),c=I(W,"TEXTAREA",{id:!0,class:!0,placeholder:!0,rows:!0}),y(c).forEach(h),m=Y(W),p=I(W,"DIV",{class:!0});var Be=y(p);j&&j.l(Be),Be.forEach(h),W.forEach(h),J.forEach(h),b=Y(q),_=I(q,"DIV",{class:!0});var qe=y(_);D.l(qe),qe.forEach(h),q.forEach(h),this.h()},h(){var L;f(o,"class","ml-0.5 self-end mb-1.5 flex space-x-1"),f(c,"id","chat-textarea"),f(c,"class","scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-1 rounded-xl resize-none h-[48px] svelte-141e0sl"),f(c,"placeholder",d=s[21]!==""?s[21]:s[23].t("Send a Message")),f(c,"rows","1"),f(p,"class","self-end mb-2 flex space-x-1 mr-1"),f(n,"class","flex"),f(t,"class","flex-1 flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100"),f(t,"dir",g=((L=s[25])==null?void 0:L.chatDirection)??"LTR"),f(_,"class","flex items-end w-10"),f(e,"class","w-full flex gap-1.5")},m(L,q){A(L,e,q),v(e,t),T&&T.m(t,null),v(t,l),v(t,n),v(n,o),ce(r,o,null),v(n,u),v(n,c),s[64](c),fl(c,s[1]),v(n,m),v(n,p),j&&j.m(p,null),v(e,b),v(e,_),x[M].m(_,null),N=!0,C||(R=[se(c,"input",s[65]),se(c,"keypress",s[66]),se(c,"keydown",s[67]),se(c,"input",s[68]),se(c,"focus",s[69]),se(c,"paste",s[70]),se(e,"submit",Bn(s[74]))],C=!0)},p(L,q){var te;L[3].length>0?T?(T.p(L,q),q[0]&8&&O(T,1)):(T=tn(L),T.c(),O(T,1),T.m(t,l)):T&&(ze(),U(T,1,1,()=>{T=null}),Re());const J={};q[0]&201327104&&(J.tools=L[26].reduce(L[59],{})),q[0]&16384&&(J.uploadFilesHandler=L[60]),q[0]&2048&&(J.onClose=L[61]),q[2]&65536&&(J.$$scope={dirty:q,ctx:L}),!i&&q[0]&32&&(i=!0,J.webSearchEnabled=L[5],He(()=>i=!1)),!a&&q[0]&16&&(a=!0,J.selectedToolIds=L[4],He(()=>a=!1)),r.$set(J),(!N||q[0]&10485760&&d!==(d=L[21]!==""?L[21]:L[23].t("Send a Message")))&&f(c,"placeholder",d),q[0]&2&&fl(c,L[1]),q[0]&1024&&(S=L[10].length==0||L[10].at(-1).done==!0),S?j?(j.p(L,q),q[0]&1024&&O(j,1)):(j=sn(L),j.c(),O(j,1),j.m(p,null)):j&&(ze(),U(j,1,1,()=>{j=null}),Re()),(!N||q[0]&33554432&&g!==(g=((te=L[25])==null?void 0:te.chatDirection)??"LTR"))&&f(t,"dir",g);let W=M;M=V(L,q),M===W?x[M].p(L,q):(ze(),U(x[W],1,1,()=>{x[W]=null}),Re(),D=x[M],D?D.p(L,q):(D=x[M]=re[M](L),D.c()),O(D,1),D.m(_,null))},i(L){N||(O(T),O(r.$$.fragment,L),O(j),O(D),N=!0)},o(L){U(T),U(r.$$.fragment,L),U(j),U(D),N=!1},d(L){L&&h(e),T&&T.d(),ue(r),s[64](null),j&&j.d(),x[M].d(),C=!1,ht(R)}}}function $r(s){let e,t,l;function n(r){s[54](r)}let o={};return s[13]!==void 0&&(o.recording=s[13]),e=new Yr({props:o}),be.push(()=>Ae(e,"recording",n)),e.$on("cancel",s[55]),e.$on("confirm",s[56]),{c(){ie(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,i){ce(e,r,i),l=!0},p(r,i){const a={};!t&&i[0]&8192&&(t=!0,a.recording=r[13],He(()=>t=!1)),e.$set(a)},i(r){l||(O(e.$$.fragment,r),l=!0)},o(r){U(e.$$.fragment,r),l=!1},d(r){ue(e,r)}}}function tn(s){let e,t,l=et(s[3]),n=[];for(let r=0;r<l.length;r+=1)n[r]=nn(Kl(s,l,r));const o=r=>U(n[r],1,1,()=>{n[r]=null});return{c(){e=E("div");for(let r=0;r<n.length;r+=1)n[r].c();this.h()},l(r){e=I(r,"DIV",{class:!0});var i=y(e);for(let a=0;a<n.length;a+=1)n[a].l(i);i.forEach(h),this.h()},h(){f(e,"class","mx-2 mt-2 mb-1 flex flex-wrap gap-2")},m(r,i){A(r,e,i);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null);t=!0},p(r,i){if(i[0]&12583177){l=et(r[3]);let a;for(a=0;a<l.length;a+=1){const u=Kl(r,l,a);n[a]?(n[a].p(u,i),O(n[a],1)):(n[a]=nn(u),n[a].c(),O(n[a],1),n[a].m(e,null))}for(ze(),a=l.length;a<n.length;a+=1)o(a);Re()}},i(r){if(!t){for(let i=0;i<l.length;i+=1)O(n[i]);t=!0}},o(r){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)U(n[i]);t=!1},d(r){r&&h(e),vt(n,r)}}}function eo(s){var p;let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M7.5 3.375c0-1.036.84-1.875 1.875-1.875h.375a3.75 3.75 0 0 1 3.75 3.75v1.875C13.5 8.161 14.34 9 15.375 9h1.875A3.75 3.75 0 0 1 21 12.75v3.375C21 17.16 20.16 18 19.125 18h-9.75A1.875 1.875 0 0 1 7.5 16.125V3.375Z"></path><path d="M15 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 17.25 7.5h-1.875A.375.375 0 0 1 15 7.125V5.25ZM4.875 6H6v10.125A3.375 3.375 0 0 0 9.375 19.5H16.5v1.125c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V7.875C3 6.839 3.84 6 4.875 6Z"></path></svg>',n,o,r,i=(((p=s[75])==null?void 0:p.title)??`#${s[75].name}`)+"",a,u,c,d=s[23].t("Collection")+"",m;return{c(){e=E("div"),t=E("div"),t.innerHTML=l,n=Q(),o=E("div"),r=E("div"),a=we(i),u=Q(),c=E("div"),m=we(d),this.h()},l(S){e=I(S,"DIV",{class:!0});var g=y(e);t=I(g,"DIV",{class:!0,"data-svelte-h":!0}),Je(t)!=="svelte-1kdy8bu"&&(t.innerHTML=l),n=Y(g),o=I(g,"DIV",{class:!0});var b=y(o);r=I(b,"DIV",{class:!0});var _=y(r);a=ke(_,i),_.forEach(h),u=Y(b),c=I(b,"DIV",{class:!0});var w=y(c);m=ke(w,d),w.forEach(h),b.forEach(h),g.forEach(h),this.h()},h(){f(t,"class","p-2.5 bg-red-400 text-white rounded-lg"),f(r,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),f(c,"class","text-gray-500 text-sm"),f(o,"class","flex flex-col justify-center -space-y-0.5"),f(e,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(S,g){A(S,e,g),v(e,t),v(e,n),v(e,o),v(o,r),v(r,a),v(o,u),v(o,c),v(c,m)},p(S,g){var b;g[0]&8&&i!==(i=(((b=S[75])==null?void 0:b.title)??`#${S[75].name}`)+"")&&De(a,i),g[0]&8388608&&d!==(d=S[23].t("Collection")+"")&&De(m,d)},i:ye,o:ye,d(S){S&&h(e)}}}function to(s){let e,t,l,n,o,r=s[75].name+"",i,a,u,c=s[23].t("Document")+"",d;function m(g,b){return g[75].upload_status?so:no}let p=m(s),S=p(s);return{c(){e=E("div"),t=E("div"),S.c(),l=Q(),n=E("div"),o=E("div"),i=we(r),a=Q(),u=E("div"),d=we(c),this.h()},l(g){e=I(g,"DIV",{class:!0});var b=y(e);t=I(b,"DIV",{class:!0});var _=y(t);S.l(_),_.forEach(h),l=Y(b),n=I(b,"DIV",{class:!0});var w=y(n);o=I(w,"DIV",{class:!0});var M=y(o);i=ke(M,r),M.forEach(h),a=Y(w),u=I(w,"DIV",{class:!0});var D=y(u);d=ke(D,c),D.forEach(h),w.forEach(h),b.forEach(h),this.h()},h(){f(t,"class","p-2.5 bg-red-400 text-white rounded-lg"),f(o,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),f(u,"class","text-gray-500 text-sm"),f(n,"class","flex flex-col justify-center -space-y-0.5"),f(e,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(g,b){A(g,e,b),v(e,t),S.m(t,null),v(e,l),v(e,n),v(n,o),v(o,i),v(n,a),v(n,u),v(u,d)},p(g,b){p!==(p=m(g))&&(S.d(1),S=p(g),S&&(S.c(),S.m(t,null))),b[0]&8&&r!==(r=g[75].name+"")&&De(i,r),b[0]&8388608&&c!==(c=g[23].t("Document")+"")&&De(d,c)},i:ye,o:ye,d(g){g&&h(e),S.d()}}}function lo(s){let e,t,l,n,o,r=(s[0]?s[22].length===0:s[8].length!==s[22].length)&&ln(s);return{c(){e=E("div"),t=E("img"),n=Q(),r&&r.c(),this.h()},l(i){e=I(i,"DIV",{class:!0});var a=y(e);t=I(a,"IMG",{src:!0,alt:!0,class:!0}),n=Y(a),r&&r.l(a),a.forEach(h),this.h()},h(){kt(t.src,l=s[75].url)||f(t,"src",l),f(t,"alt","input"),f(t,"class","h-16 w-16 rounded-xl object-cover"),f(e,"class","relative")},m(i,a){A(i,e,a),v(e,t),v(e,n),r&&r.m(e,null),o=!0},p(i,a){(!o||a[0]&8&&!kt(t.src,l=i[75].url))&&f(t,"src",l),(i[0]?i[22].length===0:i[8].length!==i[22].length)?r?(r.p(i,a),a[0]&4194561&&O(r,1)):(r=ln(i),r.c(),O(r,1),r.m(e,null)):r&&(ze(),U(r,1,1,()=>{r=null}),Re())},i(i){o||(O(r),o=!0)},o(i){U(r),o=!1},d(i){i&&h(e),r&&r.d()}}}function no(s){let e,t,l,n,o,r;return{c(){e=pe("svg"),t=pe("style"),l=we(`.spinner_qM83 {
																		animation: spinner_8HQG 1.05s infinite;
																	}
																	.spinner_oXPr {
																		animation-delay: 0.1s;
																	}
																	.spinner_ZTLf {
																		animation-delay: 0.2s;
																	}
																	@keyframes spinner_8HQG {
																		0%,
																		57.14% {
																			animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																			transform: translate(0);
																		}
																		28.57% {
																			animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																			transform: translateY(-6px);
																		}
																		100% {
																			transform: translate(0);
																		}
																	}
																`),n=pe("circle"),o=pe("circle"),r=pe("circle"),this.h()},l(i){e=_e(i,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var a=y(e);t=_e(a,"style",{});var u=y(t);l=ke(u,`.spinner_qM83 {
																		animation: spinner_8HQG 1.05s infinite;
																	}
																	.spinner_oXPr {
																		animation-delay: 0.1s;
																	}
																	.spinner_ZTLf {
																		animation-delay: 0.2s;
																	}
																	@keyframes spinner_8HQG {
																		0%,
																		57.14% {
																			animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																			transform: translate(0);
																		}
																		28.57% {
																			animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																			transform: translateY(-6px);
																		}
																		100% {
																			transform: translate(0);
																		}
																	}
																`),u.forEach(h),n=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(n).forEach(h),o=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(o).forEach(h),r=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(r).forEach(h),a.forEach(h),this.h()},h(){f(n,"class","spinner_qM83"),f(n,"cx","4"),f(n,"cy","12"),f(n,"r","2.5"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","2.5"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","2.5"),f(e,"class","w-6 h-6 translate-y-[0.5px]"),f(e,"fill","currentColor"),f(e,"viewBox","0 0 24 24"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){A(i,e,a),v(e,t),v(t,l),v(e,n),v(e,o),v(e,r)},d(i){i&&h(e)}}}function so(s){let e,t,l;return{c(){e=pe("svg"),t=pe("path"),l=pe("path"),this.h()},l(n){e=_e(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var o=y(e);t=_e(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),y(t).forEach(h),l=_e(o,"path",{d:!0}),y(l).forEach(h),o.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z"),f(t,"clip-rule","evenodd"),f(l,"d","M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","w-6 h-6")},m(n,o){A(n,e,o),v(e,t),v(e,l)},d(n){n&&h(e)}}}function ln(s){let e,t;return e=new pt({props:{className:" absolute top-1 left-1",content:s[23].t("{{ models }}",{models:[...s[0]?[s[0]]:s[8]].filter(s[57]).join(", ")}),$$slots:{default:[ro]},$$scope:{ctx:s}}}),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,n){const o={};n[0]&12583169&&(o.content=l[23].t("{{ models }}",{models:[...l[0]?[l[0]]:l[8]].filter(l[57]).join(", ")})),n[2]&65536&&(o.$$scope={dirty:n,ctx:l}),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function ro(s){let e,t;return{c(){e=pe("svg"),t=pe("path"),this.h()},l(l){e=_e(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var n=y(e);t=_e(n,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),y(t).forEach(h),n.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","size-4 fill-yellow-300")},m(l,n){A(l,e,n),v(e,t)},p:ye,d(l){l&&h(e)}}}function nn(s){let e,t,l,n,o,r,i='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',a,u,c,d;const m=[lo,to,eo],p=[];function S(b,_){return b[75].type==="image"?0:b[75].type==="doc"?1:b[75].type==="collection"?2:-1}~(t=S(s))&&(l=p[t]=m[t](s));function g(){return s[58](s[77])}return{c(){e=E("div"),l&&l.c(),n=Q(),o=E("div"),r=E("button"),r.innerHTML=i,a=Q(),this.h()},l(b){e=I(b,"DIV",{class:!0});var _=y(e);l&&l.l(_),n=Y(_),o=I(_,"DIV",{class:!0});var w=y(o);r=I(w,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Je(r)!=="svelte-6u4utr"&&(r.innerHTML=i),w.forEach(h),a=Y(_),_.forEach(h),this.h()},h(){f(r,"class","bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition"),f(r,"type","button"),f(o,"class","absolute -top-1 -right-1"),f(e,"class","relative group")},m(b,_){A(b,e,_),~t&&p[t].m(e,null),v(e,n),v(e,o),v(o,r),v(e,a),u=!0,c||(d=se(r,"click",g),c=!0)},p(b,_){s=b;let w=t;t=S(s),t===w?~t&&p[t].p(s,_):(l&&(ze(),U(p[w],1,1,()=>{p[w]=null}),Re()),~t?(l=p[t],l?l.p(s,_):(l=p[t]=m[t](s),l.c()),O(l,1),l.m(e,n)):l=null)},i(b){u||(O(l),u=!0)},o(b){U(l),u=!1},d(b){b&&h(e),~t&&p[t].d(),c=!1,d()}}}function oo(s){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-5"><path d="M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"></path></svg>';return{c(){e=E("button"),e.innerHTML=t,this.h()},l(l){e=I(l,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Je(e)!=="svelte-1948p7i"&&(e.innerHTML=t),this.h()},h(){f(e,"class","bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-2 outline-none focus:outline-none"),f(e,"type","button")},m(l,n){A(l,e,n)},p:ye,d(l){l&&h(e)}}}function sn(s){let e,t;return e=new pt({props:{content:s[23].t("Record voice"),$$slots:{default:[io]},$$scope:{ctx:s}}}),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,n){const o={};n[0]&8388608&&(o.content=l[23].t("Record voice")),n[0]&8396800|n[2]&65536&&(o.$$scope={dirty:n,ctx:l}),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function io(s){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg>',l,n;return{c(){e=E("button"),e.innerHTML=t,this.h()},l(o){e=I(o,"BUTTON",{id:!0,class:!0,type:!0,"data-svelte-h":!0}),Je(e)!=="svelte-47fjze"&&(e.innerHTML=t),this.h()},h(){f(e,"id","voice-input-button"),f(e,"class","text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center"),f(e,"type","button")},m(o,r){A(o,e,r),l||(n=se(e,"click",s[71]),l=!0)},p:ye,d(o){o&&h(e),l=!1,n()}}}function ao(s){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg>',n,o;return{c(){e=E("div"),t=E("button"),t.innerHTML=l,this.h()},l(r){e=I(r,"DIV",{class:!0});var i=y(e);t=I(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Je(t)!=="svelte-5uu99u"&&(t.innerHTML=l),i.forEach(h),this.h()},h(){f(t,"class","bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5"),f(e,"class","flex items-center mb-1.5")},m(r,i){A(r,e,i),v(e,t),n||(o=se(t,"click",s[73]),n=!0)},p:ye,i:ye,o:ye,d(r){r&&h(e),n=!1,o()}}}function co(s){let e,t,l,n;const o=[fo,uo],r=[];function i(a,u){return a[1]===""?0:1}return e=i(s),t=r[e]=o[e](s),{c(){t.c(),l=Pe()},l(a){t.l(a),l=Pe()},m(a,u){r[e].m(a,u),A(a,l,u),n=!0},p(a,u){let c=e;e=i(a),e===c?r[e].p(a,u):(ze(),U(r[c],1,1,()=>{r[c]=null}),Re(),t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),O(t,1),t.m(l.parentNode,l))},i(a){n||(O(t),n=!0)},o(a){U(t),n=!1},d(a){a&&h(l),r[e].d(a)}}}function uo(s){let e,t,l;return t=new pt({props:{content:s[23].t("Send message"),$$slots:{default:[ho]},$$scope:{ctx:s}}}),{c(){e=E("div"),ie(t.$$.fragment),this.h()},l(n){e=I(n,"DIV",{class:!0});var o=y(e);ae(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","flex items-center mb-1")},m(n,o){A(n,e,o),ce(t,e,null),l=!0},p(n,o){const r={};o[0]&8388608&&(r.content=n[23].t("Send message")),o[0]&2|o[2]&65536&&(r.$$scope={dirty:o,ctx:n}),t.$set(r)},i(n){l||(O(t.$$.fragment,n),l=!0)},o(n){U(t.$$.fragment,n),l=!1},d(n){n&&h(e),ue(t)}}}function fo(s){let e,t,l;return t=new pt({props:{content:s[23].t("Call"),$$slots:{default:[mo]},$$scope:{ctx:s}}}),{c(){e=E("div"),ie(t.$$.fragment),this.h()},l(n){e=I(n,"DIV",{class:!0});var o=y(e);ae(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","flex items-center mb-1")},m(n,o){A(n,e,o),ce(t,e,null),l=!0},p(n,o){const r={};o[0]&8388608&&(r.content=n[23].t("Call")),o[0]&545259776|o[2]&65536&&(r.$$scope={dirty:o,ctx:n}),t.$set(r)},i(n){l||(O(t.$$.fragment,n),l=!0)},o(n){U(t.$$.fragment,n),l=!1},d(n){n&&h(e),ue(t)}}}function ho(s){let e,t,l,n,o;return{c(){e=E("button"),t=pe("svg"),l=pe("path"),this.h()},l(r){e=I(r,"BUTTON",{id:!0,class:!0,type:!0});var i=y(e);t=_e(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=y(t);l=_e(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),y(l).forEach(h),a.forEach(h),i.forEach(h),this.h()},h(){f(l,"fill-rule","evenodd"),f(l,"d","M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z"),f(l,"clip-rule","evenodd"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 16 16"),f(t,"fill","currentColor"),f(t,"class","size-6"),f(e,"id","send-message-button"),f(e,"class",n=(s[1]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 m-0.5 self-center"),f(e,"type","submit"),e.disabled=o=s[1]===""},m(r,i){A(r,e,i),v(e,t),v(t,l)},p(r,i){i[0]&2&&n!==(n=(r[1]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 m-0.5 self-center")&&f(e,"class",n),i[0]&2&&o!==(o=r[1]==="")&&(e.disabled=o)},d(r){r&&h(e)}}}function mo(s){let e,t,l,n,o;return t=new Wr({props:{className:"size-6"}}),{c(){e=E("button"),ie(t.$$.fragment),this.h()},l(r){e=I(r,"BUTTON",{class:!0,type:!0});var i=y(e);ae(t.$$.fragment,i),i.forEach(h),this.h()},h(){f(e,"class","text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-2 self-center"),f(e,"type","button")},m(r,i){A(r,e,i),ce(t,e,null),l=!0,n||(o=se(e,"click",s[72]),n=!0)},p:ye,i(r){l||(O(t.$$.fragment,r),l=!0)},o(r){U(t.$$.fragment,r),l=!1},d(r){r&&h(e),ue(t),n=!1,o()}}}function go(s){let e,t,l,n,o,r,i,a,u,c,d,m,p,S,g,b,_,w,M,D,N,C,R,T,P,F,H,j=s[23].t("LLMs can make mistakes. Verify important information.")+"",re,x,V,L,q=s[19]&&xl(s),J=s[2]===!1&&s[10].length>0&&$l(s);const W=[Kr,Xr],te=[];function Be(K,oe){return oe[0]&2&&(a=null),oe[0]&2&&(u=null),a==null&&(a=K[1].charAt(0)==="/"),a?0:(u==null&&(u=K[1].charAt(0)==="#"),u?1:-1)}~(c=Be(s,[-1,-1,-1]))&&(d=te[c]=W[c](s));function qe(K){s[45](K)}function $e(K){s[46](K)}function We(K){s[47](K)}let X={messages:s[10]};s[1]!==void 0&&(X.prompt=s[1]),s[20]!==void 0&&(X.user=s[20]),s[21]!==void 0&&(X.chatInputPlaceholder=s[21]),p=new wr({props:X}),s[44](p),be.push(()=>Ae(p,"prompt",qe)),be.push(()=>Ae(p,"user",$e)),be.push(()=>Ae(p,"chatInputPlaceholder",We)),p.$on("select",s[48]);let Z=s[0]!==void 0&&en(s);const he=[$r,xr],z=[];function $(K,oe){return K[13]?0:1}return T=$(s),P=z[T]=he[T](s),{c(){q&&q.c(),e=Q(),t=E("div"),l=E("div"),n=E("div"),o=E("div"),J&&J.c(),r=Q(),i=E("div"),d&&d.c(),m=Q(),ie(p.$$.fragment),_=Q(),Z&&Z.c(),w=Q(),M=E("div"),D=E("div"),N=E("div"),C=E("input"),R=Q(),P.c(),F=Q(),H=E("div"),re=we(j),this.h()},l(K){q&&q.l(K),e=Y(K),t=I(K,"DIV",{class:!0});var oe=y(t);l=I(oe,"DIV",{class:!0});var Me=y(l);n=I(Me,"DIV",{class:!0});var Ne=y(n);o=I(Ne,"DIV",{class:!0});var Ke=y(o);J&&J.l(Ke),Ke.forEach(h),r=Y(Ne),i=I(Ne,"DIV",{class:!0});var Ze=y(i);d&&d.l(Ze),m=Y(Ze),ae(p.$$.fragment,Ze),_=Y(Ze),Z&&Z.l(Ze),Ze.forEach(h),Ne.forEach(h),Me.forEach(h),w=Y(oe),M=I(oe,"DIV",{class:!0});var tt=y(M);D=I(tt,"DIV",{class:!0});var nt=y(D);N=I(nt,"DIV",{class:!0});var lt=y(N);C=I(lt,"INPUT",{type:!0}),R=Y(lt),P.l(lt),F=Y(lt),H=I(lt,"DIV",{class:!0});var _t=y(H);re=ke(_t,j),_t.forEach(h),lt.forEach(h),nt.forEach(h),tt.forEach(h),oe.forEach(h),this.h()},h(){f(o,"class","relative"),f(i,"class","w-full relative"),f(n,"class","flex flex-col max-w-6xl px-2.5 md:px-6 w-full"),f(l,"class","-mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center"),f(C,"type","file"),C.hidden=!0,C.multiple=!0,f(H,"class","mt-1.5 text-xs text-gray-500 text-center line-clamp-1"),f(N,"class","pb-2"),f(D,"class","max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0"),f(M,"class","bg-white dark:bg-gray-900"),f(t,"class","w-full")},m(K,oe){q&&q.m(K,oe),A(K,e,oe),A(K,t,oe),v(t,l),v(l,n),v(n,o),J&&J.m(o,null),v(n,r),v(n,i),~c&&te[c].m(i,null),v(i,m),ce(p,i,null),v(i,_),Z&&Z.m(i,null),v(t,w),v(t,M),v(M,D),v(D,N),v(N,C),s[51](C),v(N,R),z[T].m(N,null),v(N,F),v(N,H),v(H,re),x=!0,V||(L=[se(C,"change",s[52]),se(C,"change",s[53])],V=!0)},p(K,oe){K[19]?q?(q.p(K,oe),oe[0]&524288&&O(q,1)):(q=xl(K),q.c(),O(q,1),q.m(e.parentNode,e)):q&&(ze(),U(q,1,1,()=>{q=null}),Re()),K[2]===!1&&K[10].length>0?J?J.p(K,oe):(J=$l(K),J.c(),J.m(o,null)):J&&(J.d(1),J=null);let Me=c;c=Be(K,oe),c===Me?~c&&te[c].p(K,oe):(d&&(ze(),U(te[Me],1,1,()=>{te[Me]=null}),Re()),~c?(d=te[c],d?d.p(K,oe):(d=te[c]=W[c](K),d.c()),O(d,1),d.m(i,m)):d=null);const Ne={};oe[0]&1024&&(Ne.messages=K[10]),!S&&oe[0]&2&&(S=!0,Ne.prompt=K[1],He(()=>S=!1)),!g&&oe[0]&1048576&&(g=!0,Ne.user=K[20],He(()=>g=!1)),!b&&oe[0]&2097152&&(b=!0,Ne.chatInputPlaceholder=K[21],He(()=>b=!1)),p.$set(Ne),K[0]!==void 0?Z?(Z.p(K,oe),oe[0]&1&&O(Z,1)):(Z=en(K),Z.c(),O(Z,1),Z.m(i,null)):Z&&(ze(),U(Z,1,1,()=>{Z=null}),Re());let Ke=T;T=$(K),T===Ke?z[T].p(K,oe):(ze(),U(z[Ke],1,1,()=>{z[Ke]=null}),Re(),P=z[T],P?P.p(K,oe):(P=z[T]=he[T](K),P.c()),O(P,1),P.m(N,F)),(!x||oe[0]&8388608)&&j!==(j=K[23].t("LLMs can make mistakes. Verify important information.")+"")&&De(re,j)},i(K){x||(O(q),O(d),O(p.$$.fragment,K),O(Z),O(P),x=!0)},o(K){U(q),U(d),U(p.$$.fragment,K),U(Z),U(P),x=!1},d(K){K&&(h(e),h(t)),q&&q.d(K),J&&J.d(),~c&&te[c].d(),s[44](null),ue(p),Z&&Z.d(),s[51](null),z[T].d(),V=!1,ht(L)}}}function po(s,e,t){let l,n,o,r,i,a,u,c;de(s,Ut,k=>t(12,n=k)),de(s,Lt,k=>t(24,o=k)),de(s,dt,k=>t(25,r=k)),de(s,zn,k=>t(26,i=k)),de(s,nl,k=>t(27,a=k)),de(s,In,k=>t(28,u=k)),de(s,Tt,k=>t(29,c=k));const d=ft("i18n");de(s,d,k=>t(23,l=k));let{submitPrompt:m}=e,{stopResponse:p}=e,{autoScroll:S=!0}=e,{atSelectedModel:g}=e,{selectedModels:b}=e,_=!1,w,M,D,N,C,R,T=!1,P=null,F="",{files:H=[]}=e,{availableToolIds:j=[]}=e,{selectedToolIds:re=[]}=e,{webSearchEnabled:x=!1}=e,{prompt:V=""}=e,{messages:L=[]}=e,q=[];const J=()=>{const k=document.getElementById("messages-container");k.scrollTop=k.scrollHeight},W=async k=>{console.log(k);const ne={type:"doc",name:k.name,collection_name:"",upload_status:!1,error:""};try{if(t(3,H=[...H,ne]),["audio/mpeg","audio/wav"].includes(k.type)){const fe=await il(localStorage.token,k).catch(Ce=>(ve.error(Ce),null));if(fe){console.log(fe);const Ce=new Blob([fe.text],{type:"text/plain"});k=sl(Ce,`${k.name}.txt`)}}const me=await $n(localStorage.token,"",k);me&&(ne.upload_status=!0,ne.collection_name=me.collection_name,t(3,H))}catch(me){t(3,H=H.filter(fe=>fe.name!==k.name)),ve.error(me)}},te=async k=>{console.log(k);const ne={type:"doc",name:k,collection_name:"",upload_status:!1,url:k,error:""};try{t(3,H=[...H,ne]);const me=await es(localStorage.token,"",k);me&&(ne.upload_status=!0,ne.collection_name=me.collection_name,t(3,H))}catch(me){t(3,H=H.filter(fe=>fe.name!==k)),ve.error(me)}},Be=async k=>{console.log(k);const ne={type:"doc",name:k,collection_name:"",upload_status:!1,url:k,error:""};try{t(3,H=[...H,ne]);const me=await ts(localStorage.token,k);me&&(ne.upload_status=!0,ne.collection_name=me.collection_name,t(3,H))}catch(me){t(3,H=H.filter(fe=>fe.name!==k)),ve.error(me)}};ll(()=>{window.setTimeout(()=>w==null?void 0:w.focus(),0);const k=document.querySelector("body"),ne=Fe=>{Fe.key==="Escape"&&(console.log("Escape"),t(19,T=!1))},me=Fe=>{Fe.preventDefault(),t(19,T=!0)},fe=()=>{t(19,T=!1)},Ce=async Fe=>{var mt,st;if(Fe.preventDefault(),console.log(Fe),(mt=Fe.dataTransfer)!=null&&mt.files){const ge=Array.from((st=Fe.dataTransfer)==null?void 0:st.files);ge&&ge.length>0?ge.forEach(Oe=>{if(console.log(Oe,Oe.name.split(".").at(-1)),["image/gif","image/webp","image/jpeg","image/png"].includes(Oe.type)){if(q.length===0){ve.error(l.t("Selected model(s) do not support image inputs"));return}let Te=new FileReader;Te.onload=Ue=>{t(3,H=[...H,{type:"image",url:`${Ue.target.result}`}])},Te.readAsDataURL(Oe)}else dl.includes(Oe.type)||hl.includes(Oe.name.split(".").at(-1))||ve.error(l.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:Oe.type})),W(Oe)}):ve.error(l.t("File not found."))}t(19,T=!1)};return window.addEventListener("keydown",ne),k==null||k.addEventListener("dragover",me),k==null||k.addEventListener("drop",Ce),k==null||k.addEventListener("dragleave",fe),()=>{window.removeEventListener("keydown",ne),k==null||k.removeEventListener("dragover",me),k==null||k.removeEventListener("drop",Ce),k==null||k.removeEventListener("dragleave",fe)}});const qe=()=>{t(2,S=!0),J()};function $e(k){be[k?"unshift":"push"](()=>{D=k,t(15,D)})}function We(k){V=k,t(1,V)}function X(k){H=k,t(3,H)}function Z(k){be[k?"unshift":"push"](()=>{N=k,t(16,N)})}function he(k){V=k,t(1,V)}const z=k=>{console.log(k),Be(k.detail)},$=k=>{console.log(k),te(k.detail)},K=k=>{var ne;console.log(k),t(3,H=[...H,{type:((ne=k==null?void 0:k.detail)==null?void 0:ne.type)??"doc",...k.detail,upload_status:!0}])};function oe(k){be[k?"unshift":"push"](()=>{C=k,t(17,C)})}function Me(k){V=k,t(1,V)}function Ne(k){P=k,t(20,P)}function Ke(k){F=k,t(21,F)}const Ze=k=>{t(0,g=k.detail),w==null||w.focus()},tt=k=>k.id===g.id,nt=()=>{t(0,g=void 0)};function lt(k){be[k?"unshift":"push"](()=>{M=k,t(14,M)})}function _t(){R=this.files,t(18,R)}const zt=async()=>{R&&R.length>0?Array.from(R).forEach(ne=>{if(["image/gif","image/webp","image/jpeg","image/png"].includes(ne.type)){if(q.length===0){ve.error(l.t("Selected model(s) do not support image inputs")),t(18,R=null),t(14,M.value="",M);return}let me=new FileReader;me.onload=fe=>{t(3,H=[...H,{type:"image",url:`${fe.target.result}`}]),t(18,R=null),t(14,M.value="",M)},me.readAsDataURL(ne)}else dl.includes(ne.type)||hl.includes(ne.name.split(".").at(-1))?(W(ne),t(14,M.value="",M)):(ve.error(l.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:ne.type})),W(ne),t(14,M.value="",M))}):ve.error(l.t("File not found."))};function Rt(k){_=k,t(13,_)}const jt=async()=>{var k;t(13,_=!1),await Ve(),(k=document.getElementById("chat-textarea"))==null||k.focus()},qt=async k=>{var me;const ne=k.detail;t(1,V=`${V}${ne} `),t(13,_=!1),await Ve(),(me=document.getElementById("chat-textarea"))==null||me.focus(),((r==null?void 0:r.speechAutoSend)??!1)&&m(V,P)},Ft=k=>!q.includes(k),Wt=k=>{H.splice(k,1),t(3,H)},Zt=(k,ne,me,fe)=>((j.includes(ne.id)||((a==null?void 0:a.role)??"user")==="admin")&&(k[ne.id]={name:ne.name,description:ne.meta.description,enabled:!1}),k),Gt=()=>{M.click()},Jt=async()=>{await Ve(),w==null||w.focus()};function Qt(k){x=k,t(5,x)}function Yt(k){re=k,t(4,re)}function Xt(k){be[k?"unshift":"push"](()=>{w=k,t(11,w),t(1,V)})}function Kt(){V=this.value,t(1,V)}const B=k=>{(!u||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))&&(k.key==="Enter"&&!k.shiftKey&&k.preventDefault(),V!==""&&k.key==="Enter"&&!k.shiftKey&&m(V,P))},ee=async k=>{var me;const ne=k.ctrlKey||k.metaKey;if(V===""&&ne&&k.key.toLowerCase()==="r"){k.preventDefault(),console.log("regenerate");const fe=[...document.getElementsByClassName("regenerate-response-button")].at(-1);fe==null||fe.click()}if(V===""&&k.key=="ArrowUp"){k.preventDefault();const fe=[...document.getElementsByClassName("user-message")].at(-1),Ce=[...document.getElementsByClassName("edit-user-message-button")].at(-1);console.log(fe),fe.scrollIntoView({block:"center"}),Ce==null||Ce.click()}if(["/","#","@"].includes(V.charAt(0))&&k.key==="ArrowUp"&&(k.preventDefault(),(D||N||C).selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(V.charAt(0))&&k.key==="ArrowDown"&&(k.preventDefault(),(D||N||C).selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(V.charAt(0))&&k.key==="Enter"){k.preventDefault();const fe=[...document.getElementsByClassName("selected-command-option-button")].at(-1);k.shiftKey?t(1,V=`${V}
`):fe?fe==null||fe.click():(me=document.getElementById("send-message-button"))==null||me.click()}if(["/","#","@"].includes(V.charAt(0))&&k.key==="Tab"){k.preventDefault();const fe=[...document.getElementsByClassName("selected-command-option-button")].at(-1);fe==null||fe.click()}else if(k.key==="Tab"){const fe=Dn(V);if(fe.length>0){const Ce=fe.at(0),Fe=V;t(1,V=V.substring(0,(Ce==null?void 0:Ce.endIndex)+1)),await Ve(),k.target.scrollTop=k.target.scrollHeight,t(1,V=Fe),await Ve(),k.preventDefault(),k.target.setSelectionRange(Ce==null?void 0:Ce.startIndex,Ce.endIndex+1)}k.target.style.height="",k.target.style.height=Math.min(k.target.scrollHeight,200)+"px"}k.key==="Escape"&&(console.log("Escape"),t(0,g=void 0))},Ee=k=>{k.target.style.height="",k.target.style.height=Math.min(k.target.scrollHeight,200)+"px",t(20,P=null)},le=k=>{k.target.style.height="",k.target.style.height=Math.min(k.target.scrollHeight,200)+"px"},Le=k=>{const ne=k.clipboardData||window.clipboardData;if(ne&&ne.items){for(const me of ne.items)if(me.type.indexOf("image")!==-1){const fe=me.getAsFile(),Ce=new FileReader;Ce.onload=function(Fe){t(3,H=[...H,{type:"image",url:`${Fe.target.result}`}])},Ce.readAsDataURL(fe)}}},G=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(ne){return ve.error(l.t("Permission denied when accessing microphone: {{error}}",{error:ne})),null})&&t(13,_=!0)}catch{ve.error(l.t("Permission denied when accessing microphone"))}},je=async()=>{if(b.length>1){ve.error(l.t("Select only one model to call"));return}if(c.audio.stt.engine==="web"){ve.error(l.t("Call feature is not supported when using Web STT engine"));return}try{await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),Ht.set(!0)}catch{ve.error(l.t("Permission denied when accessing media devices"))}},xe=()=>{p()},Ge=()=>{m(V,P)};return s.$$set=k=>{"submitPrompt"in k&&t(6,m=k.submitPrompt),"stopResponse"in k&&t(7,p=k.stopResponse),"autoScroll"in k&&t(2,S=k.autoScroll),"atSelectedModel"in k&&t(0,g=k.atSelectedModel),"selectedModels"in k&&t(8,b=k.selectedModels),"files"in k&&t(3,H=k.files),"availableToolIds"in k&&t(9,j=k.availableToolIds),"selectedToolIds"in k&&t(4,re=k.selectedToolIds),"webSearchEnabled"in k&&t(5,x=k.webSearchEnabled),"prompt"in k&&t(1,V=k.prompt),"messages"in k&&t(10,L=k.messages)},s.$$.update=()=>{s.$$.dirty[0]&4353&&t(22,q=[...g?[g]:b].filter(k=>{var ne,me,fe,Ce;return((Ce=(fe=(me=(ne=n.find(Fe=>Fe.id===k))==null?void 0:ne.info)==null?void 0:me.meta)==null?void 0:fe.capabilities)==null?void 0:Ce.vision)??!0})),s.$$.dirty[0]&2050&&V&&w&&(t(11,w.style.height="",w),t(11,w.style.height=Math.min(w.scrollHeight,200)+"px",w))},[g,V,S,H,re,x,m,p,b,j,L,w,n,_,M,D,N,C,R,T,P,F,q,l,o,r,i,a,u,c,d,J,W,te,Be,qe,$e,We,X,Z,he,z,$,K,oe,Me,Ne,Ke,Ze,tt,nt,lt,_t,zt,Rt,jt,qt,Ft,Wt,Zt,Gt,Jt,Qt,Yt,Xt,Kt,B,ee,Ee,le,Le,G,je,xe,Ge]}class _o extends Ye{constructor(e){super(),Xe(this,e,po,go,Qe,{submitPrompt:6,stopResponse:7,autoScroll:2,atSelectedModel:0,selectedModels:8,files:3,availableToolIds:9,selectedToolIds:4,webSearchEnabled:5,prompt:1,messages:10},null,[-1,-1,-1])}}function rn(s,e,t){const l=s.slice();return l[12]=e[t],l[13]=e,l[14]=t,l}function vo(s){let e,t,l;return t=new pt({props:{content:s[4].t("Remove Model"),$$slots:{default:[wo]},$$scope:{ctx:s}}}),{c(){e=E("div"),ie(t.$$.fragment),this.h()},l(n){e=I(n,"DIV",{class:!0});var o=y(e);ae(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","self-center disabled:text-gray-600 disabled:hover:text-gray-600 mr-2")},m(n,o){A(n,e,o),ce(t,e,null),l=!0},p(n,o){const r={};o&16&&(r.content=n[4].t("Remove Model")),o&32771&&(r.$$scope={dirty:o,ctx:n}),t.$set(r)},i(n){l||(O(t.$$.fragment,n),l=!0)},o(n){U(t.$$.fragment,n),l=!1},d(n){n&&h(e),ue(t)}}}function bo(s){let e,t,l;return t=new pt({props:{content:s[4].t("Add Model"),$$slots:{default:[ko]},$$scope:{ctx:s}}}),{c(){e=E("div"),ie(t.$$.fragment),this.h()},l(n){e=I(n,"DIV",{class:!0});var o=y(e);ae(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","self-center mr-2 disabled:text-gray-600 disabled:hover:text-gray-600")},m(n,o){A(n,e,o),ce(t,e,null),l=!0},p(n,o){const r={};o&16&&(r.content=n[4].t("Add Model")),o&32771&&(r.$$scope={dirty:o,ctx:n}),t.$set(r)},i(n){l||(O(t.$$.fragment,n),l=!0)},o(n){U(t.$$.fragment,n),l=!1},d(n){n&&h(e),ue(t)}}}function wo(s){let e,t,l,n,o;function r(){return s[10](s[14])}return{c(){e=E("button"),t=pe("svg"),l=pe("path"),this.h()},l(i){e=I(i,"BUTTON",{});var a=y(e);t=_e(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var u=y(t);l=_e(u,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),y(l).forEach(h),u.forEach(h),a.forEach(h),this.h()},h(){f(l,"stroke-linecap","round"),f(l,"stroke-linejoin","round"),f(l,"d","M19.5 12h-15"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width","2"),f(t,"stroke","currentColor"),f(t,"class","size-3.5"),e.disabled=s[1]},m(i,a){A(i,e,a),v(e,t),v(t,l),n||(o=se(e,"click",r),n=!0)},p(i,a){s=i,a&2&&(e.disabled=s[1])},d(i){i&&h(e),n=!1,o()}}}function ko(s){let e,t,l,n,o;return{c(){e=E("button"),t=pe("svg"),l=pe("path"),this.h()},l(r){e=I(r,"BUTTON",{class:!0});var i=y(e);t=_e(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=y(t);l=_e(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),y(l).forEach(h),a.forEach(h),i.forEach(h),this.h()},h(){f(l,"stroke-linecap","round"),f(l,"stroke-linejoin","round"),f(l,"d","M12 6v12m6-6H6"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width","2"),f(t,"stroke","currentColor"),f(t,"class","size-3.5"),f(e,"class",""),e.disabled=s[1]},m(r,i){A(r,e,i),v(e,t),v(t,l),n||(o=se(e,"click",s[9]),n=!0)},p(r,i){i&2&&(e.disabled=r[1])},d(r){r&&h(e),n=!1,o()}}}function on(s){let e,t,l,n,o,r,i,a,u,c;function d(b){s[8](b,s[12],s[13],s[14])}let m={placeholder:s[4].t("Select a model"),items:s[3].map(cn)};s[12]!==void 0&&(m.value=s[12]),n=new _s({props:m}),be.push(()=>Ae(n,"value",d));const p=[bo,vo],S=[];function g(b,_){return b[14]===0?0:1}return i=g(s),a=S[i]=p[i](s),{c(){e=E("div"),t=E("div"),l=E("div"),ie(n.$$.fragment),r=Q(),a.c(),u=Q(),this.h()},l(b){e=I(b,"DIV",{class:!0});var _=y(e);t=I(_,"DIV",{class:!0});var w=y(t);l=I(w,"DIV",{class:!0});var M=y(l);ae(n.$$.fragment,M),M.forEach(h),w.forEach(h),r=Y(_),a.l(_),u=Y(_),_.forEach(h),this.h()},h(){f(l,"class","mr-1 max-w-full"),f(t,"class","overflow-hidden w-full"),f(e,"class","flex w-full max-w-fit")},m(b,_){A(b,e,_),v(e,t),v(t,l),ce(n,l,null),v(e,r),S[i].m(e,null),v(e,u),c=!0},p(b,_){s=b;const w={};_&16&&(w.placeholder=s[4].t("Select a model")),_&8&&(w.items=s[3].map(cn)),!o&&_&1&&(o=!0,w.value=s[12],He(()=>o=!1)),n.$set(w),a.p(s,_)},i(b){c||(O(n.$$.fragment,b),O(a),c=!0)},o(b){U(n.$$.fragment,b),U(a),c=!1},d(b){b&&h(e),ue(n),S[i].d()}}}function an(s){let e,t,l=s[4].t("Set as default")+"",n,o,r;return{c(){e=E("div"),t=E("button"),n=we(l),this.h()},l(i){e=I(i,"DIV",{class:!0});var a=y(e);t=I(a,"BUTTON",{});var u=y(t);n=ke(u,l),u.forEach(h),a.forEach(h),this.h()},h(){f(e,"class","text-left mt-0.5 ml-1 text-[0.7rem] text-gray-500")},m(i,a){A(i,e,a),v(e,t),v(t,n),o||(r=se(t,"click",s[7]),o=!0)},p(i,a){a&16&&l!==(l=i[4].t("Set as default")+"")&&De(n,l)},d(i){i&&h(e),o=!1,r()}}}function yo(s){let e,t,l,n,o=et(s[0]),r=[];for(let u=0;u<o.length;u+=1)r[u]=on(rn(s,o,u));const i=u=>U(r[u],1,1,()=>{r[u]=null});let a=s[2]&&!s[5]&&an(s);return{c(){e=E("div");for(let u=0;u<r.length;u+=1)r[u].c();t=Q(),a&&a.c(),l=Pe(),this.h()},l(u){e=I(u,"DIV",{class:!0});var c=y(e);for(let d=0;d<r.length;d+=1)r[d].l(c);c.forEach(h),t=Y(u),a&&a.l(u),l=Pe(),this.h()},h(){f(e,"class","flex flex-col w-full items-center md:items-start")},m(u,c){A(u,e,c);for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(e,null);A(u,t,c),a&&a.m(u,c),A(u,l,c),n=!0},p(u,[c]){if(c&27){o=et(u[0]);let d;for(d=0;d<o.length;d+=1){const m=rn(u,o,d);r[d]?(r[d].p(m,c),O(r[d],1)):(r[d]=on(m),r[d].c(),O(r[d],1),r[d].m(e,null))}for(ze(),d=o.length;d<r.length;d+=1)i(d);Re()}u[2]&&!u[5]?a?a.p(u,c):(a=an(u),a.c(),a.m(l.parentNode,l)):a&&(a.d(1),a=null)},i(u){if(!n){for(let c=0;c<o.length;c+=1)O(r[c]);n=!0}},o(u){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)U(r[c]);n=!1},d(u){u&&(h(e),h(t),h(l)),vt(r,u),a&&a.d(u)}}}const cn=s=>({value:s.id,label:s.name,model:s});function Eo(s,e,t){let l,n,o,r;de(s,Ut,g=>t(3,l=g)),de(s,dt,g=>t(11,o=g)),de(s,In,g=>t(5,r=g));const i=ft("i18n");de(s,i,g=>t(4,n=g));let{selectedModels:a=[""]}=e,{disabled:u=!1}=e,{showSetDefault:c=!0}=e;const d=async()=>{if(a.filter(b=>b==="").length){ve.error(n.t("Choose a model before saving..."));return}dt.set({...o,models:a}),await Qn(localStorage.token,{ui:o}),ve.success(n.t("Default model updated"))};function m(g,b,_,w){_[w]=g,t(0,a),t(3,l)}const p=()=>{t(0,a=[...a,""])},S=g=>{a.splice(g,1),t(0,a),t(3,l)};return s.$$set=g=>{"selectedModels"in g&&t(0,a=g.selectedModels),"disabled"in g&&t(1,u=g.disabled),"showSetDefault"in g&&t(2,c=g.showSetDefault)},s.$$.update=()=>{s.$$.dirty&9&&a.length>0&&l.length>0&&t(0,a=a.map(g=>l.map(b=>b.id).includes(g)?g:""))},[a,u,c,l,n,r,i,d,m,p,S]}class Io extends Ye{constructor(e){super(),Xe(this,e,Eo,yo,Qe,{selectedModels:0,disabled:1,showSetDefault:2})}}function So(s){let e;const t=s[10].default,l=it(t,s,s[16],null);return{c(){l&&l.c()},l(n){l&&l.l(n)},m(n,o){l&&l.m(n,o),e=!0},p(n,o){l&&l.p&&(!e||o&65536)&&at(l,t,n,n[16],e?ut(t,n[16],o,null):ct(n[16]),null)},i(n){e||(O(l,n),e=!0)},o(n){U(l,n),e=!1},d(n){l&&l.d(n)}}}function Do(s){let e,t,l,n,o=s[3].t("Share")+"",r;return{c(){e=pe("svg"),t=pe("path"),l=Q(),n=E("div"),r=we(o),this.h()},l(i){e=_e(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=y(e);t=_e(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),y(t).forEach(h),a.forEach(h),l=Y(i),n=I(i,"DIV",{class:!0});var u=y(n);r=ke(u,o),u.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","size-4"),f(n,"class","flex items-center")},m(i,a){A(i,e,a),v(e,t),A(i,l,a),A(i,n,a),v(n,r)},p(i,a){a&8&&o!==(o=i[3].t("Share")+"")&&De(r,o)},d(i){i&&(h(e),h(l),h(n))}}}function Mo(s){let e,t,l,n,o=s[3].t("Download")+"",r;return{c(){e=pe("svg"),t=pe("path"),l=Q(),n=E("div"),r=we(o),this.h()},l(i){e=_e(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=y(e);t=_e(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),y(t).forEach(h),a.forEach(h),l=Y(i),n=I(i,"DIV",{class:!0});var u=y(n);r=ke(u,o),u.forEach(h),this.h()},h(){f(t,"stroke-linecap","round"),f(t,"stroke-linejoin","round"),f(t,"d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width","1.5"),f(e,"stroke","currentColor"),f(e,"class","size-4"),f(n,"class","flex items-center")},m(i,a){A(i,e,a),v(e,t),A(i,l,a),A(i,n,a),v(n,r)},p(i,a){a&8&&o!==(o=i[3].t("Download")+"")&&De(r,o)},d(i){i&&(h(e),h(l),h(n))}}}function Co(s){let e,t=s[3].t("Export chat (.json)")+"",l;return{c(){e=E("div"),l=we(t),this.h()},l(n){e=I(n,"DIV",{class:!0});var o=y(e);l=ke(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(n,o){A(n,e,o),v(e,l)},p(n,o){o&8&&t!==(t=n[3].t("Export chat (.json)")+"")&&De(l,t)},d(n){n&&h(e)}}}function To(s){let e,t=s[3].t("Plain text (.txt)")+"",l;return{c(){e=E("div"),l=we(t),this.h()},l(n){e=I(n,"DIV",{class:!0});var o=y(e);l=ke(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(n,o){A(n,e,o),v(e,l)},p(n,o){o&8&&t!==(t=n[3].t("Plain text (.txt)")+"")&&De(l,t)},d(n){n&&h(e)}}}function Vo(s){let e,t=s[3].t("PDF document (.pdf)")+"",l;return{c(){e=E("div"),l=we(t),this.h()},l(n){e=I(n,"DIV",{class:!0});var o=y(e);l=ke(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(n,o){A(n,e,o),v(e,l)},p(n,o){o&8&&t!==(t=n[3].t("PDF document (.pdf)")+"")&&De(l,t)},d(n){n&&h(e)}}}function Bo(s){let e,t,l,n,o,r;return e=new Et({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Co]},$$scope:{ctx:s}}}),e.$on("click",s[12]),l=new Et({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[To]},$$scope:{ctx:s}}}),l.$on("click",s[13]),o=new Et({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Vo]},$$scope:{ctx:s}}}),o.$on("click",s[14]),{c(){ie(e.$$.fragment),t=Q(),ie(l.$$.fragment),n=Q(),ie(o.$$.fragment)},l(i){ae(e.$$.fragment,i),t=Y(i),ae(l.$$.fragment,i),n=Y(i),ae(o.$$.fragment,i)},m(i,a){ce(e,i,a),A(i,t,a),ce(l,i,a),A(i,n,a),ce(o,i,a),r=!0},p(i,a){const u={};a&65544&&(u.$$scope={dirty:a,ctx:i}),e.$set(u);const c={};a&65544&&(c.$$scope={dirty:a,ctx:i}),l.$set(c);const d={};a&65544&&(d.$$scope={dirty:a,ctx:i}),o.$set(d)},i(i){r||(O(e.$$.fragment,i),O(l.$$.fragment,i),O(o.$$.fragment,i),r=!0)},o(i){U(e.$$.fragment,i),U(l.$$.fragment,i),U(o.$$.fragment,i),r=!1},d(i){i&&(h(t),h(n)),ue(e,i),ue(l,i),ue(o,i)}}}function No(s){let e,t,l,n;return e=new Js({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Mo]},$$scope:{ctx:s}}}),l=new Rs({props:{class:"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",transition:Pt,sideOffset:8,$$slots:{default:[Bo]},$$scope:{ctx:s}}}),{c(){ie(e.$$.fragment),t=Q(),ie(l.$$.fragment)},l(o){ae(e.$$.fragment,o),t=Y(o),ae(l.$$.fragment,o)},m(o,r){ce(e,o,r),A(o,t,r),ce(l,o,r),n=!0},p(o,r){const i={};r&65544&&(i.$$scope={dirty:r,ctx:o}),e.$set(i);const a={};r&65544&&(a.$$scope={dirty:r,ctx:o}),l.$set(a)},i(o){n||(O(e.$$.fragment,o),O(l.$$.fragment,o),n=!0)},o(o){U(e.$$.fragment,o),U(l.$$.fragment,o),n=!1},d(o){o&&h(t),ue(e,o),ue(l,o)}}}function Lo(s){let e,t,l,n,o,r,i,a,u;return e=new Et({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[Do]},$$scope:{ctx:s}}}),e.$on("click",s[11]),l=new Ss({props:{$$slots:{default:[No]},$$scope:{ctx:s}}}),a=new ns({props:{chatId:s[1].id}}),{c(){ie(e.$$.fragment),t=Q(),ie(l.$$.fragment),n=Q(),o=E("hr"),r=Q(),i=E("div"),ie(a.$$.fragment),this.h()},l(c){ae(e.$$.fragment,c),t=Y(c),ae(l.$$.fragment,c),n=Y(c),o=I(c,"HR",{class:!0}),r=Y(c),i=I(c,"DIV",{class:!0});var d=y(i);ae(a.$$.fragment,d),d.forEach(h),this.h()},h(){f(o,"class","border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5"),f(i,"class","flex p-1")},m(c,d){ce(e,c,d),A(c,t,d),ce(l,c,d),A(c,n,d),A(c,o,d),A(c,r,d),A(c,i,d),ce(a,i,null),u=!0},p(c,d){const m={};d&65544&&(m.$$scope={dirty:d,ctx:c}),e.$set(m);const p={};d&65544&&(p.$$scope={dirty:d,ctx:c}),l.$set(p);const S={};d&2&&(S.chatId=c[1].id),a.$set(S)},i(c){u||(O(e.$$.fragment,c),O(l.$$.fragment,c),O(a.$$.fragment,c),u=!0)},o(c){U(e.$$.fragment,c),U(l.$$.fragment,c),U(a.$$.fragment,c),u=!1},d(c){c&&(h(t),h(n),h(o),h(r),h(i)),ue(e,c),ue(l,c),ue(a)}}}function Oo(s){let e,t,l;return t=new ol({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:8,side:"bottom",align:"end",transition:Pt,$$slots:{default:[Lo]},$$scope:{ctx:s}}}),{c(){e=E("div"),ie(t.$$.fragment),this.h()},l(n){e=I(n,"DIV",{slot:!0});var o=y(e);ae(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(n,o){A(n,e,o),ce(t,e,null),l=!0},p(n,o){const r={};o&65547&&(r.$$scope={dirty:o,ctx:n}),t.$set(r)},i(n){l||(O(t.$$.fragment,n),l=!0)},o(n){U(t.$$.fragment,n),l=!1},d(n){n&&h(e),ue(t)}}}function Ho(s){let e,t;return e=new rl({props:{$$slots:{content:[Oo],default:[So]},$$scope:{ctx:s}}}),e.$on("change",s[15]),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,[n]){const o={};n&65547&&(o.$$scope={dirty:n,ctx:l}),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function Ao(s,e,t){let l,{$$slots:n={},$$scope:o}=e;const{saveAs:r}=bs,i=ft("i18n");de(s,i,N=>t(3,l=N));let{shareEnabled:a=!1}=e,{shareHandler:u}=e,{downloadHandler:c}=e,{chat:d}=e,{onClose:m=()=>{}}=e;const p=async()=>{const N=d.chat;console.log("download",d);const C=N.messages.reduce((T,P,F,H)=>`${T}### ${P.role.toUpperCase()}
${P.content}

`,"");let R=new Blob([C],{type:"text/plain"});r(R,`chat-${N.title}.txt`)},S=async()=>{const N=d.chat;console.log("download",d);const C=await ws(N),R=window.URL.createObjectURL(C),T=document.createElement("a");T.href=R,T.download=`chat-${N.title}.pdf`,document.body.appendChild(T),T.click(),document.body.removeChild(T),window.URL.revokeObjectURL(R)},g=async()=>{let N=new Blob([JSON.stringify([d])],{type:"application/json"});r(N,`chat-export-${Date.now()}.json`)},b=()=>{u()},_=()=>{g()},w=()=>{p()},M=()=>{S()},D=N=>{N.detail===!1&&m()};return s.$$set=N=>{"shareEnabled"in N&&t(8,a=N.shareEnabled),"shareHandler"in N&&t(0,u=N.shareHandler),"downloadHandler"in N&&t(9,c=N.downloadHandler),"chat"in N&&t(1,d=N.chat),"onClose"in N&&t(2,m=N.onClose),"$$scope"in N&&t(16,o=N.$$scope)},[u,d,m,l,i,p,S,g,a,c,n,b,_,w,M,D,o]}class Uo extends Ye{constructor(e){super(),Xe(this,e,Ao,Ho,Qe,{shareEnabled:8,shareHandler:0,downloadHandler:9,chat:1,onClose:2})}}function un(s){let e,t,l;function n(r){s[15](r)}let o={showSetDefault:!s[2]};return s[0]!==void 0&&(o.selectedModels=s[0]),e=new Io({props:o}),be.push(()=>Ae(e,"selectedModels",n)),{c(){ie(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,i){ce(e,r,i),l=!0},p(r,i){const a={};i&4&&(a.showSetDefault=!r[2]),!t&&i&1&&(t=!0,a.selectedModels=r[0],He(()=>t=!1)),e.$set(a)},i(r){l||(O(e.$$.fragment,r),l=!0)},o(r){U(e.$$.fragment,r),l=!1},d(r){ue(e,r)}}}function fn(s){let e,t;return e=new Uo({props:{chat:s[3],shareEnabled:s[2],shareHandler:s[16],downloadHandler:s[17],$$slots:{default:[Po]},$$scope:{ctx:s}}}),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,n){const o={};n&8&&(o.chat=l[3]),n&4&&(o.shareEnabled=l[2]),n&32&&(o.shareHandler=l[16]),n&64&&(o.downloadHandler=l[17]),n&2097152&&(o.$$scope={dirty:n,ctx:l}),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function Po(s){let e,t='<div class="m-auto self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"></path></svg></div>';return{c(){e=E("button"),e.innerHTML=t,this.h()},l(l){e=I(l,"BUTTON",{class:!0,id:!0,"data-svelte-h":!0}),Je(e)!=="svelte-9m6068"&&(e.innerHTML=t),this.h()},h(){f(e,"class","hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(e,"id","chat-context-menu-button")},m(l,n){A(l,e,n)},p:ye,d(l){l&&h(e)}}}function zo(s){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"></path><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"></path></svg>',n,o,r;return{c(){e=E("button"),t=E("div"),t.innerHTML=l,this.h()},l(i){e=I(i,"BUTTON",{id:!0,class:!0});var a=y(e);t=I(a,"DIV",{class:!0,"data-svelte-h":!0}),Je(t)!=="svelte-1fcii9y"&&(t.innerHTML=l),a.forEach(h),this.h()},h(){f(t,"class","m-auto self-center"),f(e,"id","new-chat-button"),f(e,"class",n="flex "+(s[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")},m(i,a){A(i,e,a),v(e,t),o||(r=se(e,"click",s[18]),o=!0)},p(i,a){a&256&&n!==(n="flex "+(i[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")&&f(e,"class",n)},d(i){i&&h(e),o=!1,r()}}}function dn(s){let e,t;return e=new rs({props:{className:"max-w-[200px]",role:s[10].role,$$slots:{default:[Ro]},$$scope:{ctx:s}}}),e.$on("show",s[19]),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,n){const o={};n&1024&&(o.role=l[10].role),n&2098176&&(o.$$scope={dirty:n,ctx:l}),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function Ro(s){let e,t,l,n;return{c(){e=E("button"),t=E("div"),l=E("img"),this.h()},l(o){e=I(o,"BUTTON",{class:!0,"aria-label":!0});var r=y(e);t=I(r,"DIV",{class:!0});var i=y(t);l=I(i,"IMG",{src:!0,class:!0,alt:!0,draggable:!0}),i.forEach(h),r.forEach(h),this.h()},h(){kt(l.src,n=s[10].profile_image_url)||f(l,"src",n),f(l,"class","size-6 object-cover rounded-full"),f(l,"alt","User profile"),f(l,"draggable","false"),f(t,"class","self-center"),f(e,"class","select-none flex rounded-xl p-1.5 w-full hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(e,"aria-label","User Menu")},m(o,r){A(o,e,r),v(e,t),v(t,l)},p(o,r){r&1024&&!kt(l.src,n=o[10].profile_image_url)&&f(l,"src",n)},d(o){o&&h(e)}}}function jo(s){let e,t,l,n,o,r,i,a,u,c,d,m,p,S,g,b,_,w,M,D,N;function C(H){s[13](H)}let R={chatId:s[7]};s[5]!==void 0&&(R.show=s[5]),e=new ss({props:R}),be.push(()=>Ae(e,"show",C)),c=new ks({});let T=s[4]&&un(s),P=s[2]&&s[3]&&s[3].id&&fn(s);_=new pt({props:{content:s[9].t("New Chat"),$$slots:{default:[zo]},$$scope:{ctx:s}}});let F=s[10]!==void 0&&dn(s);return{c(){ie(e.$$.fragment),l=Q(),n=E("nav"),o=E("div"),r=E("div"),i=E("div"),a=E("button"),u=E("div"),ie(c.$$.fragment),m=Q(),p=E("div"),T&&T.c(),S=Q(),g=E("div"),P&&P.c(),b=Q(),ie(_.$$.fragment),w=Q(),F&&F.c(),this.h()},l(H){ae(e.$$.fragment,H),l=Y(H),n=I(H,"NAV",{id:!0,class:!0});var j=y(n);o=I(j,"DIV",{class:!0});var re=y(o);r=I(re,"DIV",{class:!0});var x=y(r);i=I(x,"DIV",{class:!0});var V=y(i);a=I(V,"BUTTON",{id:!0,class:!0});var L=y(a);u=I(L,"DIV",{class:!0});var q=y(u);ae(c.$$.fragment,q),q.forEach(h),L.forEach(h),V.forEach(h),m=Y(x),p=I(x,"DIV",{class:!0});var J=y(p);T&&T.l(J),J.forEach(h),S=Y(x),g=I(x,"DIV",{class:!0});var W=y(g);P&&P.l(W),b=Y(W),ae(_.$$.fragment,W),w=Y(W),F&&F.l(W),W.forEach(h),x.forEach(h),re.forEach(h),j.forEach(h),this.h()},h(){f(u,"class","m-auto self-center"),f(a,"id","sidebar-toggle-button"),f(a,"class","cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(i,"class",d=(s[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),f(p,"class","flex-1 overflow-hidden max-w-full"),f(g,"class","self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),f(r,"class","flex items-center w-full max-w-full"),f(o,"class","flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]"),f(n,"id","nav"),f(n,"class","sticky py-2.5 top-0 flex flex-row justify-center z-30")},m(H,j){ce(e,H,j),A(H,l,j),A(H,n,j),v(n,o),v(o,r),v(r,i),v(i,a),v(a,u),ce(c,u,null),v(r,m),v(r,p),T&&T.m(p,null),v(r,S),v(r,g),P&&P.m(g,null),v(g,b),ce(_,g,null),v(g,w),F&&F.m(g,null),M=!0,D||(N=se(a,"click",s[14]),D=!0)},p(H,[j]){const re={};j&128&&(re.chatId=H[7]),!t&&j&32&&(t=!0,re.show=H[5],He(()=>t=!1)),e.$set(re),(!M||j&256&&d!==(d=(H[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"))&&f(i,"class",d),H[4]?T?(T.p(H,j),j&16&&O(T,1)):(T=un(H),T.c(),O(T,1),T.m(p,null)):T&&(ze(),U(T,1,1,()=>{T=null}),Re()),H[2]&&H[3]&&H[3].id?P?(P.p(H,j),j&12&&O(P,1)):(P=fn(H),P.c(),O(P,1),P.m(g,b)):P&&(ze(),U(P,1,1,()=>{P=null}),Re());const x={};j&512&&(x.content=H[9].t("New Chat")),j&2097410&&(x.$$scope={dirty:j,ctx:H}),_.$set(x),H[10]!==void 0?F?(F.p(H,j),j&1024&&O(F,1)):(F=dn(H),F.c(),O(F,1),F.m(g,null)):F&&(ze(),U(F,1,1,()=>{F=null}),Re())},i(H){M||(O(e.$$.fragment,H),O(c.$$.fragment,H),O(T),O(P),O(_.$$.fragment,H),O(F),M=!0)},o(H){U(e.$$.fragment,H),U(c.$$.fragment,H),U(T),U(P),U(_.$$.fragment,H),U(F),M=!1},d(H){H&&(h(l),h(n)),ue(e,H),ue(c),T&&T.d(),P&&P.d(),ue(_),F&&F.d(),D=!1,N()}}}function qo(s,e,t){let l,n,o,r,i;de(s,Sn,T=>t(20,l=T)),de(s,yt,T=>t(7,n=T)),de(s,Lt,T=>t(8,o=T)),de(s,nl,T=>t(10,i=T));const a=ft("i18n");de(s,a,T=>t(9,r=T));let{initNewChat:u}=e,{title:c=l}=e,{shareEnabled:d=!1}=e,{chat:m}=e,{selectedModels:p}=e,{showModelSelector:S=!0}=e,g=!1,b=!1;function _(T){g=T,t(5,g)}const w=()=>{Lt.set(!o)};function M(T){p=T,t(0,p)}const D=()=>{t(5,g=!g)},N=()=>{t(6,b=!b)},C=()=>{u()},R=T=>{T.detail==="archived-chat"&&Rn.set(!0)};return s.$$set=T=>{"initNewChat"in T&&t(1,u=T.initNewChat),"title"in T&&t(12,c=T.title),"shareEnabled"in T&&t(2,d=T.shareEnabled),"chat"in T&&t(3,m=T.chat),"selectedModels"in T&&t(0,p=T.selectedModels),"showModelSelector"in T&&t(4,S=T.showModelSelector)},[p,u,d,m,S,g,b,n,o,r,i,a,c,_,w,M,D,N,C,R]}class Fo extends Ye{constructor(e){super(),Xe(this,e,qo,jo,Qe,{initNewChat:1,title:12,shareEnabled:2,chat:3,selectedModels:0,showModelSelector:4})}}function hn(s,e,t){const l=s.slice();return l[10]=e[t],l}function Wo(s){let e;const t=s[4].default,l=it(t,s,s[8],null);return{c(){l&&l.c()},l(n){l&&l.l(n)},m(n,o){l&&l.m(n,o),e=!0},p(n,o){l&&l.p&&(!e||o&256)&&at(l,t,n,n[8],e?ut(t,n[8],o,null):ct(n[8]),null)},i(n){e||(O(l,n),e=!0)},o(n){U(l,n),e=!1},d(n){l&&l.d(n)}}}function Zo(s){var r;let e,t,l=(((r=s[10])==null?void 0:r.label)??"Camera")+"",n,o;return{c(){e=E("div"),t=E("div"),n=we(l),o=Q(),this.h()},l(i){e=I(i,"DIV",{class:!0});var a=y(e);t=I(a,"DIV",{class:!0});var u=y(t);n=ke(u,l),u.forEach(h),a.forEach(h),o=Y(i),this.h()},h(){f(t,"class","line-clamp-1"),f(e,"class","flex items-center")},m(i,a){A(i,e,a),v(e,t),v(t,n),A(i,o,a)},p(i,a){var u;a&2&&l!==(l=(((u=i[10])==null?void 0:u.label)??"Camera")+"")&&De(n,l)},d(i){i&&(h(e),h(o))}}}function mn(s){let e,t;function l(){return s[5](s[10])}return e=new Et({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Zo]},$$scope:{ctx:s}}}),e.$on("click",l),{c(){ie(e.$$.fragment)},l(n){ae(e.$$.fragment,n)},m(n,o){ce(e,n,o),t=!0},p(n,o){s=n;const r={};o&258&&(r.$$scope={dirty:o,ctx:s}),e.$set(r)},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){U(e.$$.fragment,n),t=!1},d(n){ue(e,n)}}}function Go(s){let e,t,l=et(s[1]),n=[];for(let r=0;r<l.length;r+=1)n[r]=mn(hn(s,l,r));const o=r=>U(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=Pe()},l(r){for(let i=0;i<n.length;i+=1)n[i].l(r);e=Pe()},m(r,i){for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(r,i);A(r,e,i),t=!0},p(r,i){if(i&10){l=et(r[1]);let a;for(a=0;a<l.length;a+=1){const u=hn(r,l,a);n[a]?(n[a].p(u,i),O(n[a],1)):(n[a]=mn(u),n[a].c(),O(n[a],1),n[a].m(e.parentNode,e))}for(ze(),a=l.length;a<n.length;a+=1)o(a);Re()}},i(r){if(!t){for(let i=0;i<l.length;i+=1)O(n[i]);t=!0}},o(r){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)U(n[i]);t=!1},d(r){r&&h(e),vt(n,r)}}}function Jo(s){let e,t,l;return t=new ol({props:{class:"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-[9999] bg-white dark:bg-gray-900 dark:text-white shadow-sm",sideOffset:6,side:"top",align:"start",transition:Pt,$$slots:{default:[Go]},$$scope:{ctx:s}}}),{c(){e=E("div"),ie(t.$$.fragment),this.h()},l(n){e=I(n,"DIV",{slot:!0});var o=y(e);ae(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(n,o){A(n,e,o),ce(t,e,null),l=!0},p(n,o){const r={};o&258&&(r.$$scope={dirty:o,ctx:n}),t.$set(r)},i(n){l||(O(t.$$.fragment,n),l=!0)},o(n){U(t.$$.fragment,n),l=!1},d(n){n&&h(e),ue(t)}}}function Qo(s){let e,t,l;function n(r){s[6](r)}let o={$$slots:{content:[Jo],default:[Wo]},$$scope:{ctx:s}};return s[2]!==void 0&&(o.show=s[2]),e=new rl({props:o}),be.push(()=>Ae(e,"show",n)),e.$on("change",s[7]),{c(){ie(e.$$.fragment)},l(r){ae(e.$$.fragment,r)},m(r,i){ce(e,r,i),l=!0},p(r,[i]){const a={};i&258&&(a.$$scope={dirty:i,ctx:r}),!t&&i&4&&(t=!0,a.show=r[2],He(()=>t=!1)),e.$set(a)},i(r){l||(O(e.$$.fragment,r),l=!0)},o(r){U(e.$$.fragment,r),l=!1},d(r){ue(e,r)}}}function Yo(s,e,t){let{$$slots:l={},$$scope:n}=e;ft("i18n");const o=Ct();let{onClose:r=()=>{}}=e,{devices:i}=e,a=!1;const u=m=>{o("change",m.deviceId)};function c(m){a=m,t(2,a)}const d=m=>{m.detail===!1&&r()};return s.$$set=m=>{"onClose"in m&&t(0,r=m.onClose),"devices"in m&&t(1,i=m.devices),"$$scope"in m&&t(8,n=m.$$scope)},[r,i,a,o,l,u,c,d,n]}class Xo extends Ye{constructor(e){super(),Xe(this,e,Yo,Qo,Qe,{onClose:0,devices:1})}}function gn(s){let e,t,l,n,o,r,i,a,u,c,d,m,p,S,g,b,_,w,M,D,N='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"></path></svg>',C,R,T,P=s[2]&&pn(s);function F(W,te){return W[2]?$o:ei}let H=F(s),j=H(s);const re=[si,ni],x=[];function V(W,te){return W[2]?0:1}m=V(s),p=x[m]=re[m](s);function L(W,te){return W[1]?ai:ii}let q=L(s),J=q(s);return{c(){e=E("audio"),l=Q(),n=E("div"),o=E("div"),r=E("div"),P&&P.c(),i=Q(),a=E("div"),j.c(),u=Q(),c=E("div"),d=E("div"),p.c(),S=Q(),g=E("div"),b=E("button"),_=E("div"),J.c(),w=Q(),M=E("div"),D=E("button"),D.innerHTML=N,this.h()},l(W){e=I(W,"AUDIO",{id:!0,src:!0,style:!0}),y(e).forEach(h),l=Y(W),n=I(W,"DIV",{class:!0});var te=y(n);o=I(te,"DIV",{class:!0});var Be=y(o);r=I(Be,"DIV",{class:!0});var qe=y(r);P&&P.l(qe),i=Y(qe),a=I(qe,"DIV",{class:!0});var $e=y(a);j.l($e),$e.forEach(h),u=Y(qe),c=I(qe,"DIV",{class:!0});var We=y(c);d=I(We,"DIV",{});var X=y(d);p.l(X),X.forEach(h),S=Y(We),g=I(We,"DIV",{});var Z=y(g);b=I(Z,"BUTTON",{type:!0});var he=y(b);_=I(he,"DIV",{class:!0});var z=y(_);J.l(z),z.forEach(h),he.forEach(h),Z.forEach(h),w=Y(We),M=I(We,"DIV",{});var $=y(M);D=I($,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Je(D)!=="svelte-khrbnh"&&(D.innerHTML=N),$.forEach(h),We.forEach(h),qe.forEach(h),Be.forEach(h),te.forEach(h),this.h()},h(){f(e,"id","audioElement"),kt(e.src,t="")||f(e,"src",t),Bt(e,"display","none"),f(a,"class","flex justify-center items-center flex-1 h-full w-full max-h-full"),f(_,"class","line-clamp-1 text-sm font-medium"),f(b,"type","button"),f(D,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(D,"type","button"),f(c,"class","flex justify-between items-center pb-2 w-full"),f(r,"class","max-w-lg w-full h-screen max-h-[100dvh] flex flex-col justify-between p-3 md:p-6"),f(o,"class","absolute w-full h-screen max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center"),f(n,"class","absolute w-full h-screen max-h-[100dvh] flex z-[999] overflow-hidden")},m(W,te){A(W,e,te),A(W,l,te),A(W,n,te),v(n,o),v(o,r),P&&P.m(r,null),v(r,i),v(r,a),j.m(a,null),v(r,u),v(r,c),v(c,d),x[m].m(d,null),v(c,S),v(c,g),v(g,b),v(b,_),J.m(_,null),v(c,w),v(c,M),v(M,D),C=!0,R||(T=se(D,"click",s[17]),R=!0)},p(W,te){W[2]?P?P.p(W,te):(P=pn(W),P.c(),P.m(r,i)):P&&(P.d(1),P=null),H===(H=F(W))&&j?j.p(W,te):(j.d(1),j=H(W),j&&(j.c(),j.m(a,null)));let Be=m;m=V(W),m===Be?x[m].p(W,te):(ze(),U(x[Be],1,1,()=>{x[Be]=null}),Re(),p=x[m],p?p.p(W,te):(p=x[m]=re[m](W),p.c()),O(p,1),p.m(d,null)),q===(q=L(W))&&J?J.p(W,te):(J.d(1),J=q(W),J&&(J.c(),J.m(_,null)))},i(W){C||(O(p),C=!0)},o(W){U(p),C=!1},d(W){W&&(h(e),h(l),h(n)),P&&P.d(),j.d(),x[m].d(),J.d(),R=!1,T()}}}function pn(s){let e;function t(o,r){return o[1]?xo:Ko}let l=t(s),n=l(s);return{c(){e=E("div"),n.c(),this.h()},l(o){e=I(o,"DIV",{class:!0});var r=y(e);n.l(r),r.forEach(h),this.h()},h(){f(e,"class","flex justify-center items-center w-full min-h-20")},m(o,r){A(o,e,r),n.m(e,null)},p(o,r){l===(l=t(o))&&n?n.p(o,r):(n.d(1),n=l(o),n&&(n.c(),n.m(e,null)))},d(o){o&&h(e),n.d()}}}function Ko(s){let e,t;return{c(){e=E("div"),this.h()},l(l){e=I(l,"DIV",{class:!0}),y(e).forEach(h),this.h()},h(){f(e,"class",t=(s[3]*100>4?" size-[4.5rem]":s[3]*100>2?" size-16":s[3]*100>1?"size-14":"size-12")+" transition-all bg-black dark:bg-white rounded-full")},m(l,n){A(l,e,n)},p(l,n){n[0]&8&&t!==(t=(l[3]*100>4?" size-[4.5rem]":l[3]*100>2?" size-16":l[3]*100>1?"size-14":"size-12")+" transition-all bg-black dark:bg-white rounded-full")&&f(e,"class",t)},d(l){l&&h(e)}}}function xo(s){let e,t,l,n,o,r;return{c(){e=pe("svg"),t=pe("style"),l=we(`.spinner_qM83 {
										animation: spinner_8HQG 1.05s infinite;
									}
									.spinner_oXPr {
										animation-delay: 0.1s;
									}
									.spinner_ZTLf {
										animation-delay: 0.2s;
									}
									@keyframes spinner_8HQG {
										0%,
										57.14% {
											animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
											transform: translate(0);
										}
										28.57% {
											animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
											transform: translateY(-6px);
										}
										100% {
											transform: translate(0);
										}
									}
								`),n=pe("circle"),o=pe("circle"),r=pe("circle"),this.h()},l(i){e=_e(i,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var a=y(e);t=_e(a,"style",{});var u=y(t);l=ke(u,`.spinner_qM83 {
										animation: spinner_8HQG 1.05s infinite;
									}
									.spinner_oXPr {
										animation-delay: 0.1s;
									}
									.spinner_ZTLf {
										animation-delay: 0.2s;
									}
									@keyframes spinner_8HQG {
										0%,
										57.14% {
											animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
											transform: translate(0);
										}
										28.57% {
											animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
											transform: translateY(-6px);
										}
										100% {
											transform: translate(0);
										}
									}
								`),u.forEach(h),n=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(n).forEach(h),o=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(o).forEach(h),r=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(r).forEach(h),a.forEach(h),this.h()},h(){f(n,"class","spinner_qM83"),f(n,"cx","4"),f(n,"cy","12"),f(n,"r","3"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","3"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","3"),f(e,"class","size-12 text-gray-900 dark:text-gray-400"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){A(i,e,a),v(e,t),v(t,l),v(e,n),v(e,o),v(e,r)},p:ye,d(i){i&&h(e)}}}function $o(s){let e,t,l,n,o,r,i,a='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-6"><path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"></path></svg>',u,c;return{c(){e=E("div"),t=E("video"),l=Q(),n=E("canvas"),o=Q(),r=E("div"),i=E("button"),i.innerHTML=a,this.h()},l(d){e=I(d,"DIV",{class:!0});var m=y(e);t=I(m,"VIDEO",{id:!0,class:!0}),y(t).forEach(h),l=Y(m),n=I(m,"CANVAS",{id:!0,style:!0}),y(n).forEach(h),o=Y(m),r=I(m,"DIV",{class:!0});var p=y(r);i=I(p,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Je(i)!=="svelte-zfg1vd"&&(i.innerHTML=a),p.forEach(h),m.forEach(h),this.h()},h(){f(t,"id","camera-feed"),t.autoplay=!0,f(t,"class","rounded-2xl h-full min-w-full object-cover object-center"),t.playsInline=!0,f(n,"id","camera-canvas"),Bt(n,"display","none"),f(i,"type","button"),f(i,"class","p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full"),f(r,"class","absolute top-4 md:top-8 left-4"),f(e,"class","relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full")},m(d,m){A(d,e,m),v(e,t),v(e,l),v(e,n),v(e,o),v(e,r),v(r,i),u||(c=se(i,"click",s[14]),u=!0)},p:ye,d(d){d&&h(e),u=!1,c()}}}function ei(s){let e;function t(o,r){return o[1]?li:ti}let l=t(s),n=l(s);return{c(){n.c(),e=Pe()},l(o){n.l(o),e=Pe()},m(o,r){n.m(o,r),A(o,e,r)},p(o,r){l===(l=t(o))&&n?n.p(o,r):(n.d(1),n=l(o),n&&(n.c(),n.m(e.parentNode,e)))},d(o){o&&h(e),n.d(o)}}}function ti(s){let e,t;return{c(){e=E("div"),this.h()},l(l){e=I(l,"DIV",{class:!0}),y(e).forEach(h),this.h()},h(){f(e,"class",t=(s[3]*100>4?" size-52":s[3]*100>2?"size-48":s[3]*100>1?"size-[11.5rem]":"size-44")+" transition-all bg-black dark:bg-white rounded-full")},m(l,n){A(l,e,n)},p(l,n){n[0]&8&&t!==(t=(l[3]*100>4?" size-52":l[3]*100>2?"size-48":l[3]*100>1?"size-[11.5rem]":"size-44")+" transition-all bg-black dark:bg-white rounded-full")&&f(e,"class",t)},d(l){l&&h(e)}}}function li(s){let e,t,l,n,o,r;return{c(){e=pe("svg"),t=pe("style"),l=we(`.spinner_qM83 {
										animation: spinner_8HQG 1.05s infinite;
									}
									.spinner_oXPr {
										animation-delay: 0.1s;
									}
									.spinner_ZTLf {
										animation-delay: 0.2s;
									}
									@keyframes spinner_8HQG {
										0%,
										57.14% {
											animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
											transform: translate(0);
										}
										28.57% {
											animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
											transform: translateY(-6px);
										}
										100% {
											transform: translate(0);
										}
									}
								`),n=pe("circle"),o=pe("circle"),r=pe("circle"),this.h()},l(i){e=_e(i,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var a=y(e);t=_e(a,"style",{});var u=y(t);l=ke(u,`.spinner_qM83 {
										animation: spinner_8HQG 1.05s infinite;
									}
									.spinner_oXPr {
										animation-delay: 0.1s;
									}
									.spinner_ZTLf {
										animation-delay: 0.2s;
									}
									@keyframes spinner_8HQG {
										0%,
										57.14% {
											animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
											transform: translate(0);
										}
										28.57% {
											animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
											transform: translateY(-6px);
										}
										100% {
											transform: translate(0);
										}
									}
								`),u.forEach(h),n=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(n).forEach(h),o=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(o).forEach(h),r=_e(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),y(r).forEach(h),a.forEach(h),this.h()},h(){f(n,"class","spinner_qM83"),f(n,"cx","4"),f(n,"cy","12"),f(n,"r","3"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","3"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","3"),f(e,"class","size-44 text-gray-900 dark:text-gray-400"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){A(i,e,a),v(e,t),v(t,l),v(e,n),v(e,o),v(e,r)},p:ye,d(i){i&&h(e)}}}function ni(s){let e,t;return e=new pt({props:{content:s[6].t("Camera"),$$slots:{default:[ri]},$$scope:{ctx:s}}}),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,n){const o={};n[0]&64&&(o.content=l[6].t("Camera")),n[1]&2048&&(o.$$scope={dirty:n,ctx:l}),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function si(s){let e,t;return e=new Xo({props:{devices:s[4],$$slots:{default:[oi]},$$scope:{ctx:s}}}),e.$on("change",s[15]),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,n){const o={};n[0]&16&&(o.devices=l[4]),n[1]&2048&&(o.$$scope={dirty:n,ctx:l}),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function ri(s){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"></path></svg>',l,n;return{c(){e=E("button"),e.innerHTML=t,this.h()},l(o){e=I(o,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Je(e)!=="svelte-r4n822"&&(e.innerHTML=t),this.h()},h(){f(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(e,"type","button")},m(o,r){A(o,e,r),l||(n=se(e,"click",s[16]),l=!0)},p:ye,d(o){o&&h(e),l=!1,n()}}}function oi(s){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd"></path></svg>';return{c(){e=E("button"),e.innerHTML=t,this.h()},l(l){e=I(l,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Je(e)!=="svelte-t977tc"&&(e.innerHTML=t),this.h()},h(){f(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(e,"type","button")},m(l,n){A(l,e,n)},p:ye,d(l){l&&h(e)}}}function ii(s){let e=s[6].t("Listening...")+"",t;return{c(){t=we(e)},l(l){t=ke(l,e)},m(l,n){A(l,t,n)},p(l,n){n[0]&64&&e!==(e=l[6].t("Listening...")+"")&&De(t,e)},d(l){l&&h(t)}}}function ai(s){let e=s[6].t("Thinking...")+"",t;return{c(){t=we(e)},l(l){t=ke(l,e)},m(l,n){A(l,t,n)},p(l,n){n[0]&64&&e!==(e=l[6].t("Thinking...")+"")&&De(t,e)},d(l){l&&h(t)}}}function ci(s){let e,t,l=s[0]&&gn(s);return{c(){l&&l.c(),e=Pe()},l(n){l&&l.l(n),e=Pe()},m(n,o){l&&l.m(n,o),A(n,e,o),t=!0},p(n,o){n[0]?l?(l.p(n,o),o[0]&1&&O(l,1)):(l=gn(n),l.c(),O(l,1),l.m(e.parentNode,e)):l&&(ze(),U(l,1,1,()=>{l=null}),Re())},i(n){t||(O(l),t=!0)},o(n){U(l),t=!1},d(n){n&&h(e),l&&l.d(n)}}}function ui(s,e,t){let l,n,o,r;de(s,Ht,Z=>t(0,l=Z)),de(s,Tt,Z=>t(27,n=Z)),de(s,dt,Z=>t(28,o=Z));const i=ft("i18n");de(s,i,Z=>t(6,r=Z));let{submitPrompt:a}=e,{files:u}=e,c=!1,d=!1,m=!1,p=null,S={},g=null,b=0,_=!1,w=null,M,D=[];const N=-45,C=Z=>{let he=0;for(let z=0;z<Z.length;z++){const $=(Z[z]-128)/128;he+=$*$}return Math.sqrt(he/Z.length)},R=Z=>{const he=new AudioContext,z=he.createMediaStreamSource(Z),$=he.createAnalyser();$.minDecibels=N,z.connect($);const K=$.frequencyBinCount,oe=new Uint8Array(K),Me=new Uint8Array($.fftSize);let Ne=Date.now();_=!1,(()=>{const Ze=()=>{if(!M||!l){M&&M.stop();return}$.getByteTimeDomainData(Me),$.getByteFrequencyData(oe),t(3,b=C(Me)),oe.some(nt=>nt>0)&&(T(),_=!0,Ne=Date.now()),_&&Date.now()-Ne>2e3&&(d=!0,M&&M.stop()),window.requestAnimationFrame(Ze)};window.requestAnimationFrame(Ze)})()},T=()=>{w&&(speechSynthesis.cancel(),w=null),S[g]&&(S[g].pause(),S[g].currentTime=0);const Z=document.getElementById("audioElement");Z.pause(),Z.currentTime=0},P=Z=>l?new Promise(he=>{g=Z;const z=document.getElementById("audioElement"),$=S[Z];z.src=$.src,z.muted=!0,z.play().then(()=>{z.muted=!1}).catch(K=>{ve.error(K)}),z.onended=async K=>{await new Promise(oe=>setTimeout(oe,300)),Object.keys(S).length-1,he(K)}}):Promise.resolve(),F=async Z=>{await Ve();const he=sl(Z,"recording.wav"),z=await il(localStorage.token,he).catch($=>(ve.error($),null));if(z&&(console.log(z.text),z.text!=="")){const $=await a(z.text);if(console.log($),$.at(0)){const K=$[0];(K??"").trim()!==""&&H(K)}}},H=async Z=>{var he,z,$,K;if((n.audio.tts.engine??"")==""){let oe=[];const Me=setInterval(async()=>{var Ne;if(oe=await speechSynthesis.getVoices(),oe.length>0){clearInterval(Me);const Ke=((Ne=oe==null?void 0:oe.filter(Ze=>{var tt,nt,lt,_t;return Ze.voiceURI===(((nt=(tt=o==null?void 0:o.audio)==null?void 0:tt.tts)==null?void 0:nt.voice)??((_t=(lt=n==null?void 0:n.audio)==null?void 0:lt.tts)==null?void 0:_t.voice))}))==null?void 0:Ne.at(0))??void 0;w=new SpeechSynthesisUtterance(Z),Ke&&(w.voice=Ke),speechSynthesis.speak(w)}},100)}else if(n.audio.tts.engine==="openai"){console.log("openai");const oe=Wn(Z).reduce((Ne,Ke)=>{const Ze=Ne.length-1;if(Ze>=0){const tt=Ne[Ze];tt.split(/\s+/).length<2?Ne[Ze]=tt+" "+Ke:Ne.push(Ke)}else Ne.push(Ke);return Ne},[]);console.log(oe);let Me=Promise.resolve();for(const[Ne,Ke]of oe.entries()){const Ze=await ps(localStorage.token,((z=(he=o==null?void 0:o.audio)==null?void 0:he.tts)==null?void 0:z.voice)??((K=($=n==null?void 0:n.audio)==null?void 0:$.tts)==null?void 0:K.voice),Ke).catch(tt=>(ve.error(tt),null));if(Ze){const tt=await Ze.blob(),nt=URL.createObjectURL(tt),lt=new Audio(nt);S[Ne]=lt,Me=Me.then(()=>P(Ne))}}}},j=async()=>{if(l){if(d){if(t(1,c=!0),p){const he=te();t(12,u=[{type:"image",url:he}])}const Z=new Blob(D,{type:"audio/wav"});await F(Z),d=!1,t(1,c=!1)}D=[],M=!1,re()}else D=[],M=!1},re=async()=>{const Z=await navigator.mediaDevices.getUserMedia({audio:!0});M=new MediaRecorder(Z),M.onstart=()=>{console.log("Recording started"),D=[],R(Z)},M.ondataavailable=he=>{_&&D.push(he.data)},M.onstop=async()=>{console.log("Recording stopped"),await j()},M.start()};let x=[],V=null;const L=async()=>{const Z=await navigator.mediaDevices.enumerateDevices();t(4,x=Z.filter(he=>he.kind==="videoinput")),navigator.mediaDevices.getDisplayMedia&&t(4,x=[...x,{deviceId:"screen",label:"Screen Share"}]),console.log(x),V===null&&x.length>0&&t(5,V=x[0].deviceId)},q=async()=>{if(await L(),p===null){t(2,m=!0),await Ve();try{await J()}catch(Z){console.error("Error accessing webcam: ",Z)}}},J=async()=>{const Z=document.getElementById("camera-feed");Z&&(V==="screen"?p=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}):p=await navigator.mediaDevices.getUserMedia({video:{deviceId:V?{exact:V}:void 0}}),p&&(await L(),Z.srcObject=p,await Z.play()))},W=async()=>{p&&p.getTracks().forEach(he=>he.stop()),p=null},te=()=>{const Z=document.getElementById("camera-feed"),he=document.getElementById("camera-canvas");if(!he)return;const z=he.getContext("2d");he.width=Z.videoWidth,he.height=Z.videoHeight,z.drawImage(Z,0,0,Z.videoWidth,Z.videoHeight);const $=he.toDataURL("image/png");return console.log($),$},Be=async()=>{await W(),t(2,m=!1)},qe=()=>{Be()},$e=async Z=>{console.log(Z.detail),t(5,V=Z.detail),await W(),await J()},We=()=>{q()},X=async()=>{Ht.set(!1)};return s.$$set=Z=>{"submitPrompt"in Z&&t(13,a=Z.submitPrompt),"files"in Z&&t(12,u=Z.files)},s.$$.update=()=>{s.$$.dirty[0]&1&&(l?re():Be())},[l,c,m,b,x,V,r,i,q,J,W,Be,u,a,qe,$e,We,X]}class fi extends Ye{constructor(e){super(),Xe(this,e,ui,ci,Qe,{submitPrompt:13,files:12},null,[-1,-1])}}const{document:tl}=Ln;function _n(s,e,t){const l=s.slice();return l[67]=e[t],l}function vn(s){let e,t,l,n,o,r,i,a,u,c,d,m,p,S,g,b,_,w,M,D,N,C,R,T,P,F,H;function j(z){s[29](z)}function re(z){s[30](z)}let x={title:s[12],shareEnabled:s[15].length>0,chat:s[11],initNewChat:s[22]};s[1]!==void 0&&(x.selectedModels=s[1]),s[7]!==void 0&&(x.showModelSelector=s[7]),t=new Fo({props:x}),be.push(()=>Ae(t,"selectedModels",j)),be.push(()=>Ae(t,"showModelSelector",re));let V=s[20].length>0&&s[15].length===0&&!s[16]&&s[1].length<=1&&bn(s);function L(z){s[33](z)}function q(z){s[34](z)}function J(z){s[35](z)}function W(z){s[36](z)}let te={chatId:s[16],selectedModels:s[1],processing:hi,bottomPadding:s[14].length>0,sendPrompt:s[24],continueGeneration:s[27],regenerateResponse:s[26]};s[3]!==void 0&&(te.history=s[3]),s[15]!==void 0&&(te.messages=s[15]),s[5]!==void 0&&(te.autoScroll=s[5]),s[13]!==void 0&&(te.prompt=s[13]),c=new On({props:te}),be.push(()=>Ae(c,"history",L)),be.push(()=>Ae(c,"messages",q)),be.push(()=>Ae(c,"autoScroll",J)),be.push(()=>Ae(c,"prompt",W));function Be(z){s[40](z)}function qe(z){s[41](z)}function $e(z){s[42](z)}function We(z){s[43](z)}function X(z){s[44](z)}function Z(z){s[45](z)}let he={availableToolIds:s[8].reduce(s[39],[]),selectedModels:s[1],messages:s[15],submitPrompt:s[23],stopResponse:s[25]};return s[14]!==void 0&&(he.files=s[14]),s[13]!==void 0&&(he.prompt=s[13]),s[5]!==void 0&&(he.autoScroll=s[5]),s[9]!==void 0&&(he.selectedToolIds=s[9]),s[10]!==void 0&&(he.webSearchEnabled=s[10]),s[2]!==void 0&&(he.atSelectedModel=s[2]),_=new _o({props:he}),be.push(()=>Ae(_,"files",Be)),be.push(()=>Ae(_,"prompt",qe)),be.push(()=>Ae(_,"autoScroll",$e)),be.push(()=>Ae(_,"selectedToolIds",We)),be.push(()=>Ae(_,"webSearchEnabled",X)),be.push(()=>Ae(_,"atSelectedModel",Z)),{c(){e=E("div"),ie(t.$$.fragment),o=Q(),V&&V.c(),r=Q(),i=E("div"),a=E("div"),u=E("div"),ie(c.$$.fragment),b=Q(),ie(_.$$.fragment),this.h()},l(z){e=I(z,"DIV",{class:!0});var $=y(e);ae(t.$$.fragment,$),o=Y($),V&&V.l($),r=Y($),i=I($,"DIV",{class:!0});var K=y(i);a=I(K,"DIV",{class:!0,id:!0});var oe=y(a);u=I(oe,"DIV",{class:!0});var Me=y(u);ae(c.$$.fragment,Me),Me.forEach(h),oe.forEach(h),b=Y(K),ae(_.$$.fragment,K),K.forEach(h),$.forEach(h),this.h()},h(){f(u,"class",g="h-full w-full flex flex-col "+(s[0]?"py-4":"pt-2 pb-4")),f(a,"class","pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full"),f(a,"id","messages-container"),f(i,"class","flex flex-col flex-auto"),f(e,"class",T="h-screen max-h-[100dvh] "+(s[19]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col")},m(z,$){A(z,e,$),ce(t,e,null),v(e,o),V&&V.m(e,null),v(e,r),v(e,i),v(i,a),v(a,u),ce(c,u,null),s[37](a),v(i,b),ce(_,i,null),P=!0,F||(H=se(a,"scroll",s[38]),F=!0)},p(z,$){const K={};$[0]&4096&&(K.title=z[12]),$[0]&32768&&(K.shareEnabled=z[15].length>0),$[0]&2048&&(K.chat=z[11]),!l&&$[0]&2&&(l=!0,K.selectedModels=z[1],He(()=>l=!1)),!n&&$[0]&128&&(n=!0,K.showModelSelector=z[7],He(()=>n=!1)),t.$set(K),z[20].length>0&&z[15].length===0&&!z[16]&&z[1].length<=1?V?(V.p(z,$),$[0]&1146882&&O(V,1)):(V=bn(z),V.c(),O(V,1),V.m(e,r)):V&&(ze(),U(V,1,1,()=>{V=null}),Re());const oe={};$[0]&65536&&(oe.chatId=z[16]),$[0]&2&&(oe.selectedModels=z[1]),$[0]&16384&&(oe.bottomPadding=z[14].length>0),!d&&$[0]&8&&(d=!0,oe.history=z[3],He(()=>d=!1)),!m&&$[0]&32768&&(m=!0,oe.messages=z[15],He(()=>m=!1)),!p&&$[0]&32&&(p=!0,oe.autoScroll=z[5],He(()=>p=!1)),!S&&$[0]&8192&&(S=!0,oe.prompt=z[13],He(()=>S=!1)),c.$set(oe),(!P||$[0]&1&&g!==(g="h-full w-full flex flex-col "+(z[0]?"py-4":"pt-2 pb-4")))&&f(u,"class",g);const Me={};$[0]&131328&&(Me.availableToolIds=z[8].reduce(z[39],[])),$[0]&2&&(Me.selectedModels=z[1]),$[0]&32768&&(Me.messages=z[15]),!w&&$[0]&16384&&(w=!0,Me.files=z[14],He(()=>w=!1)),!M&&$[0]&8192&&(M=!0,Me.prompt=z[13],He(()=>M=!1)),!D&&$[0]&32&&(D=!0,Me.autoScroll=z[5],He(()=>D=!1)),!N&&$[0]&512&&(N=!0,Me.selectedToolIds=z[9],He(()=>N=!1)),!C&&$[0]&1024&&(C=!0,Me.webSearchEnabled=z[10],He(()=>C=!1)),!R&&$[0]&4&&(R=!0,Me.atSelectedModel=z[2],He(()=>R=!1)),_.$set(Me),(!P||$[0]&524288&&T!==(T="h-screen max-h-[100dvh] "+(z[19]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col"))&&f(e,"class",T)},i(z){P||(O(t.$$.fragment,z),O(V),O(c.$$.fragment,z),O(_.$$.fragment,z),P=!0)},o(z){U(t.$$.fragment,z),U(V),U(c.$$.fragment,z),U(_.$$.fragment,z),P=!1},d(z){z&&h(e),ue(t),V&&V.d(),ue(c),s[37](null),ue(_),F=!1,H()}}}function bn(s){let e,t,l,n,o=et(s[20].filter(s[31])),r=[];for(let a=0;a<o.length;a+=1)r[a]=wn(_n(s,o,a));const i=a=>U(r[a],1,1,()=>{r[a]=null});return{c(){e=E("div"),t=E("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){e=I(a,"DIV",{class:!0});var u=y(e);t=I(u,"DIV",{class:!0});var c=y(t);for(let d=0;d<r.length;d+=1)r[d].l(c);c.forEach(h),u.forEach(h),this.h()},h(){f(t,"class","flex flex-col gap-1 w-full"),f(e,"class",l="absolute top-[4.25rem] w-full "+(s[19]?"md:max-w-[calc(100%-260px)]":""))},m(a,u){A(a,e,u),v(e,t);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(t,null);n=!0},p(a,u){if(u[0]&1048576){o=et(a[20].filter(a[31]));let c;for(c=0;c<o.length;c+=1){const d=_n(a,o,c);r[c]?(r[c].p(d,u),O(r[c],1)):(r[c]=wn(d),r[c].c(),O(r[c],1),r[c].m(t,null))}for(ze(),c=o.length;c<r.length;c+=1)i(c);Re()}(!n||u[0]&524288&&l!==(l="absolute top-[4.25rem] w-full "+(a[19]?"md:max-w-[calc(100%-260px)]":"")))&&f(e,"class",l)},i(a){if(!n){for(let u=0;u<o.length;u+=1)O(r[u]);n=!0}},o(a){r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)U(r[u]);n=!1},d(a){a&&h(e),vt(r,a)}}}function wn(s){let e,t;return e=new nr({props:{banner:s[67]}}),e.$on("dismiss",s[32]),{c(){ie(e.$$.fragment)},l(l){ae(e.$$.fragment,l)},m(l,n){ce(e,l,n),t=!0},p(l,n){const o={};n[0]&1048576&&(o.banner=l[67]),e.$set(o)},i(l){t||(O(e.$$.fragment,l),t=!0)},o(l){U(e.$$.fragment,l),t=!1},d(l){ue(e,l)}}}function di(s){let e,t,l,n,o,r,i;tl.title=e=`
		`+(s[12]?`${s[12].length>30?`${s[12].slice(0,30)}...`:s[12]} | ${s[18]}`:`${s[18]}`)+`
	`;function a(d){s[28](d)}let u={submitPrompt:s[23]};s[14]!==void 0&&(u.files=s[14]),l=new fi({props:u}),be.push(()=>Ae(l,"files",a));let c=(!s[0]||s[4]&&s[0])&&vn(s);return{c(){t=Q(),ie(l.$$.fragment),o=Q(),c&&c.c(),r=Pe()},l(d){Nn("svelte-1123lr8",tl.head).forEach(h),t=Y(d),ae(l.$$.fragment,d),o=Y(d),c&&c.l(d),r=Pe()},m(d,m){A(d,t,m),ce(l,d,m),A(d,o,m),c&&c.m(d,m),A(d,r,m),i=!0},p(d,m){(!i||m[0]&266240)&&e!==(e=`
		`+(d[12]?`${d[12].length>30?`${d[12].slice(0,30)}...`:d[12]} | ${d[18]}`:`${d[18]}`)+`
	`)&&(tl.title=e);const p={};!n&&m[0]&16384&&(n=!0,p.files=d[14],He(()=>n=!1)),l.$set(p),!d[0]||d[4]&&d[0]?c?(c.p(d,m),m[0]&17&&O(c,1)):(c=vn(d),c.c(),O(c,1),c.m(r.parentNode,r)):c&&(ze(),U(c,1,1,()=>{c=null}),Re())},i(d){i||(O(l.$$.fragment,d),O(c),i=!0)},o(d){U(l.$$.fragment,d),U(c),i=!1},d(d){d&&(h(t),h(o),h(r)),ue(l,d),c&&c.d(d)}}}let hi="";function mi(s,e,t){let l,n,o,r,i,a,u,c,d,m,p,S;de(s,yt,B=>t(16,l=B)),de(s,dt,B=>t(48,n=B)),de(s,Ut,B=>t(17,r=B)),de(s,Ht,B=>t(50,i=B)),de(s,nl,B=>t(51,a=B)),de(s,jn,B=>t(52,u=B)),de(s,An,B=>t(53,c=B)),de(s,Tt,B=>t(54,d=B)),de(s,Sn,B=>t(18,m=B)),de(s,Lt,B=>t(19,p=B)),de(s,qn,B=>t(20,S=B));const g=ft("i18n");de(s,g,B=>t(49,o=B));let{chatIdProp:b=""}=e,_=!1,w=!1,M=!0,D,N=!0,C=[""],R,T=[],P=[],F=!1,H=null,j="",re="",x=[],V=[],L={messages:{},currentId:null};ll(async()=>{l?(n.saveChatHistory??!0)||await xt("/"):await q()});const q=async()=>{var Ee;window.history.replaceState(L.state,"","/"),await yt.set(""),t(5,M=!0),t(12,j=""),t(15,V=[]),t(3,L={messages:{},currentId:null}),c.url.searchParams.get("models")?t(1,C=(Ee=c.url.searchParams.get("models"))==null?void 0:Ee.split(",")):n!=null&&n.models?t(1,C=n==null?void 0:n.models):d!=null&&d.default_models?(console.log((d==null?void 0:d.default_models.split(","))??""),t(1,C=d==null?void 0:d.default_models.split(","))):t(1,C=[""]),c.url.searchParams.get("q")&&(t(13,re=c.url.searchParams.get("q")??""),re&&(await Ve(),$e(re))),t(1,C=C.map(le=>r.map(Le=>Le.id).includes(le)?le:""));const B=await vl(localStorage.token);B?dt.set(B.ui):dt.set(JSON.parse(localStorage.getItem("settings")??"{}"));const ee=document.getElementById("chat-textarea");setTimeout(()=>ee==null?void 0:ee.focus(),0)},J=async()=>{if(yt.set(b),t(11,H=await Xn(localStorage.token,l).catch(async B=>(await xt("/"),null))),H){await Ke();const B=H.chat;if(B){console.log(B),t(1,C=((B==null?void 0:B.models)??void 0)!==void 0?B.models:[B.models??""]),t(3,L=((B==null?void 0:B.history)??void 0)!==void 0?B.history:Gn(B.messages)),t(12,j=B.title);const ee=await vl(localStorage.token);return ee?await dt.set(ee.ui):await dt.set(JSON.parse(localStorage.getItem("settings")??"{}")),await dt.set({...n,system:B.system??n.system,params:B.options??n.params}),t(5,M=!0),await Ve(),V.length>0&&t(3,L.messages[V.at(-1).id].done=!0,L),await Ve(),!0}else return null}},W=async()=>{await Ve(),D&&t(6,D.scrollTop=D.scrollHeight,D)},te=B=>{const ee=L.messages[B];return ee.parentId?[...te(ee.parentId),ee]:[ee]},Be=async(B,ee)=>{await Hn.run({querySelector:".mermaid"});const Ee=await as(localStorage.token,{model:B,messages:ee.map(le=>({id:le.id,role:le.role,content:le.content,timestamp:le.timestamp})),chat_id:l}).catch(le=>(console.error(le),null));if(Ee!==null)for(const le of Ee.messages)t(3,L.messages[le.id]={...L.messages[le.id],...L.messages[le.id].content!==le.content?{originalContent:L.messages[le.id].content}:{},...le},L)},qe=async(B,ee="")=>setInterval(()=>{u==null||u.emit("usage",{action:"chat",model:B,chat_id:ee})},1e3),$e=async(B,ee=null)=>{let Ee=[];if(console.log("submitPrompt",l),t(1,C=C.map(le=>r.map(Le=>Le.id).includes(le)?le:"")),C.includes(""))ve.error(o.t("Model not selected"));else if(V.length!=0&&V.at(-1).done!=!0)console.log("wait");else if(x.length>0&&x.filter(le=>le.upload_status===!1).length>0)ve.error(o.t("Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready."));else{const le=document.getElementById("chat-textarea");le&&(le.value="",le.style.height="");const Le=JSON.parse(JSON.stringify(x));t(14,x=[]),t(13,re="");let G=gl(),je={id:G,parentId:V.length!==0?V.at(-1).id:null,childrenIds:[],role:"user",user:ee??void 0,content:B,files:Le.length>0?Le:void 0,timestamp:Math.floor(Date.now()/1e3),models:C.filter((xe,Ge)=>C.indexOf(xe)===Ge)};t(3,L.messages[G]=je,L),t(3,L.currentId=G,L),V.length!==0&&L.messages[V.at(-1).id].childrenIds.push(G),await Ve(),Ee=await We(B,G)}return Ee},We=async(B,ee,Ee=null,le=!0)=>{let Le=[],G=Ee?[Ee]:R!==void 0?[R.id]:C;const je={};for(const Ge of G){const k=r.filter(ne=>ne.id===Ge).at(0);if(k){let ne=gl(),me={parentId:ee,id:ne,childrenIds:[],role:"assistant",content:"",model:k.id,modelName:k.name??k.id,userContext:null,timestamp:Math.floor(Date.now()/1e3)};t(3,L.messages[ne]=me,L),t(3,L.currentId=ne,L),ee!==null&&t(3,L.messages[ee].childrenIds=[...L.messages[ee].childrenIds,ne],L),je[Ge]=ne}}await Ve(),le&&V.length==2&&(n.saveChatHistory??!0?(t(11,H=await Yn(localStorage.token,{id:l,title:o.t("New Chat"),models:C,system:n.system??void 0,options:{...n.params??{}},messages:V,history:L,tags:[],timestamp:Date.now()})),await Dt.set(await Mt(localStorage.token)),await yt.set(H.id)):await yt.set("local"),await Ve());const xe=JSON.parse(JSON.stringify(l));return await Promise.all(G.map(async Ge=>{var ne,me,fe;console.log("modelId",Ge);const k=r.filter(Ce=>Ce.id===Ge).at(0);if(k){V.some(Te=>{var Ue;return(Ue=Te.files)==null?void 0:Ue.some(Ie=>Ie.type==="image")})&&!(((fe=(me=(ne=k.info)==null?void 0:ne.meta)==null?void 0:me.capabilities)==null?void 0:fe.vision)??!0)&&ve.error(o.t("Model {{modelName}} is not vision capable",{modelName:k.name??k.id}));let Fe=je[Ge],mt=L.messages[Fe],st=null;if(((n==null?void 0:n.memory)??!1)&&st===null){const Te=await os(localStorage.token,B).catch(Ue=>(ve.error(Ue),null));Te&&(Te.documents[0].length>0&&(st=Te.documents.reduce((Ue,Ie,Se)=>{const rt=Te.metadatas[Se][0].created_at,bt=new Date(rt*1e3).toISOString().split("T")[0];return Ue.push(`${Se+1}. [${bt}]. ${Ie[0]}`),Ue},[])),console.log(st))}mt.userContext=st;const ge=await qe(k.id,xe);F&&await X(k.id,ee,Fe);let Oe=null;(k==null?void 0:k.owned_by)==="openai"?Oe=await he(k,B,Fe,xe):k&&(Oe=await Z(k,B,Fe,xe)),Le.push(Oe),console.log("chatEventEmitter",ge),ge&&clearInterval(ge)}else ve.error(o.t("Model {{modelId}} not found",{modelId:Ge}))})),await Dt.set(await Mt(localStorage.token)),Le},X=async(B,ee,Ee)=>{const le=L.messages[Ee];le.statusHistory=[{done:!1,action:"web_search",description:o.t("Generating search query")}],t(15,V),t(3,L);const Le=L.messages[ee].content;let G=await cs(localStorage.token,B,V,Le).catch(xe=>(console.log(xe),Le));G||(ve.warning(o.t("No search query generated")),le.statusHistory.push({done:!0,error:!0,action:"web_search",description:"No search query generated"}),t(15,V),t(3,L)),le.statusHistory.push({done:!1,action:"web_search",description:o.t('Searching "{{searchQuery}}"',{searchQuery:G})}),t(15,V),t(3,L);const je=await ls(localStorage.token,G).catch(xe=>(console.log(xe),ve.error(xe),null));je?(le.statusHistory.push({done:!0,action:"web_search",description:o.t("Searched {{count}} sites",{count:je.filenames.length}),query:G,urls:je.filenames}),((le==null?void 0:le.files)??!0)&&(le.files=[]),le.files.push({collection_name:je.collection_name,name:G,type:"web_search_results",urls:je.filenames}),t(15,V),t(3,L)):(le.statusHistory.push({done:!0,error:!0,action:"web_search",description:"No search results found"}),t(15,V),t(3,L))},Z=async(B,ee,Ee,le)=>{var me,fe,Ce,Fe,mt,st;let Le=null;const G=L.messages[Ee];await Ve(),W();const je=[n.system||((G==null?void 0:G.userContext)??null)?{role:"system",content:`${pl((n==null?void 0:n.system)??"",a.name)}${(G==null?void 0:G.userContext)??null?`

User Context:
${((G==null?void 0:G.userContext)??[]).join(`
`)}`:""}`}:void 0,...V].filter(ge=>{var Oe;return(Oe=ge==null?void 0:ge.content)==null?void 0:Oe.trim()}).map((ge,Oe,Te)=>{var Se;const Ue={role:ge.role,content:ge.content},Ie=(Se=ge.files)==null?void 0:Se.filter(rt=>rt.type==="image").map(rt=>rt.url.slice(rt.url.indexOf(",")+1));return Ie&&Ie.length>0&&ge.role==="user"&&(Ue.images=Ie),Ue});let xe=-1;je.forEach((ge,Oe)=>{ge.images&&(xe=Oe)}),je.forEach((ge,Oe)=>{Oe!==xe&&delete ge.images});let Ge=[];(((fe=(me=B==null?void 0:B.info)==null?void 0:me.meta)==null?void 0:fe.knowledge)??!1)&&(Ge=B.info.meta.knowledge),Ge=[...Ge,...V.filter(ge=>(ge==null?void 0:ge.files)??null).map(ge=>ge.files.filter(Oe=>["doc","collection","web_search_results"].includes(Oe.type))).flat(1)].filter((ge,Oe,Te)=>Te.findIndex(Ue=>JSON.stringify(Ue)===JSON.stringify(ge))===Oe);const[k,ne]=await Jn(localStorage.token,{model:B.id,messages:je,options:{...n.params??{},stop:((Ce=n==null?void 0:n.params)==null?void 0:Ce.stop)??void 0?n.params.stop.map(ge=>decodeURIComponent(JSON.parse('"'+ge.replace(/\"/g,'\\"')+'"'))):void 0,num_predict:((Fe=n==null?void 0:n.params)==null?void 0:Fe.max_tokens)??void 0,repeat_penalty:((mt=n==null?void 0:n.params)==null?void 0:mt.frequency_penalty)??void 0},format:n.requestFormat??void 0,keep_alive:n.keepAlive??void 0,tool_ids:P.length>0?P:void 0,docs:Ge.length>0?Ge:void 0,citations:Ge.length>0,chat_id:l});if(k&&k.ok){console.log("controller",ne);const ge=k.body.pipeThrough(new TextDecoderStream).pipeThrough(Zn(`
`)).getReader();for(;;){const{value:Oe,done:Te}=await ge.read();if(Te||w||le!==l){if(G.done=!0,t(15,V),t(3,L),w)ne.abort("User: Stop Response");else{const Ue=te(Ee);await Be(B.id,Ue)}Le=G.content;break}try{let Ue=Oe.split(`
`);for(const Ie of Ue)if(Ie!==""){console.log(Ie);let Se=JSON.parse(Ie);if("citations"in Se){G.citations=Se.citations;continue}if("detail"in Se)throw Se;if(Se.done==!1){if(G.content==""&&Se.message.content==`
`)continue;G.content+=Se.message.content,t(15,V),t(3,L)}else{if(G.done=!0,G.content==""&&(G.error={code:400,content:"Oops! No text generated from Ollama, Please try again."}),G.context=Se.context??null,G.info={total_duration:Se.total_duration,load_duration:Se.load_duration,sample_count:Se.sample_count,sample_duration:Se.sample_duration,prompt_eval_count:Se.prompt_eval_count,prompt_eval_duration:Se.prompt_eval_duration,eval_count:Se.eval_count,eval_duration:Se.eval_duration},t(15,V),t(3,L),n.notificationEnabled&&!document.hasFocus()){const rt=new Notification(selectedModelfile?`${selectedModelfile.title.charAt(0).toUpperCase()+selectedModelfile.title.slice(1)}`:`${B.id}`,{body:G.content,icon:(selectedModelfile==null?void 0:selectedModelfile.imageUrl)??`${Ot}/static/favicon.png`})}n.responseAutoCopy&&_l(G.content),n.responseAutoPlayback&&!i&&(await Ve(),(st=document.getElementById(`speak-button-${G.id}`))==null||st.click())}}}catch(Ue){console.log(Ue),"detail"in Ue&&ve.error(Ue.detail);break}M&&W()}l==le&&(n.saveChatHistory??!0)&&(t(11,H=await el(localStorage.token,le,{messages:V,history:L,models:C})),await Dt.set(await Mt(localStorage.token)))}else{if(k!==null){const ge=await k.json();console.log(ge),"detail"in ge?(ve.error(ge.detail),G.error={content:ge.detail}):(ve.error(ge.error),G.error={content:ge.error})}else ve.error(o.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"})),G.error={content:o.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"})};G.done=!0,t(15,V),t(3,L)}if(w=!1,await Ve(),M&&W(),V.length==2&&V.at(1).content!==""){window.history.replaceState(L.state,"",`/c/${le}`);const ge=await Me(ee);await Ne(le,ge)}return Le},he=async(B,ee,Ee,le)=>{var xe,Ge,k,ne,me,fe,Ce,Fe,mt,st,ge,Oe;let Le=null;const G=L.messages[Ee];let je=[];(((Ge=(xe=B==null?void 0:B.info)==null?void 0:xe.meta)==null?void 0:Ge.knowledge)??!1)&&(je=B.info.meta.knowledge),je=[...je,...V.filter(Te=>(Te==null?void 0:Te.files)??null).map(Te=>Te.files.filter(Ue=>["doc","collection","web_search_results"].includes(Ue.type))).flat(1)].filter((Te,Ue,Ie)=>Ie.findIndex(Se=>JSON.stringify(Se)===JSON.stringify(Te))===Ue),W();try{const[Te,Ue]=await xn(localStorage.token,{model:B.id,stream:!0,stream_options:((me=(ne=(k=B.info)==null?void 0:k.meta)==null?void 0:ne.capabilities)==null?void 0:me.usage)??!1?{include_usage:!0}:void 0,messages:[n.system||((G==null?void 0:G.userContext)??null)?{role:"system",content:`${pl((n==null?void 0:n.system)??"",a.name)}${(G==null?void 0:G.userContext)??null?`

User Context:
${((G==null?void 0:G.userContext)??[]).join(`
`)}`:""}`}:void 0,...V].filter(Ie=>{var Se;return(Se=Ie==null?void 0:Ie.content)==null?void 0:Se.trim()}).map((Ie,Se,rt)=>{var bt;return{role:Ie.role,...((bt=Ie.files)==null?void 0:bt.filter(wt=>wt.type==="image").length)>0&&Ie.role==="user"?{content:[{type:"text",text:rt.length-1!==Se?Ie.content:(Ie==null?void 0:Ie.raContent)??Ie.content},...Ie.files.filter(wt=>wt.type==="image").map(wt=>({type:"image_url",image_url:{url:wt.url}}))]}:{content:rt.length-1!==Se?Ie.content:(Ie==null?void 0:Ie.raContent)??Ie.content}}}),seed:((fe=n==null?void 0:n.params)==null?void 0:fe.seed)??void 0,stop:((Ce=n==null?void 0:n.params)==null?void 0:Ce.stop)??void 0?n.params.stop.map(Ie=>decodeURIComponent(JSON.parse('"'+Ie.replace(/\"/g,'\\"')+'"'))):void 0,temperature:((Fe=n==null?void 0:n.params)==null?void 0:Fe.temperature)??void 0,top_p:((mt=n==null?void 0:n.params)==null?void 0:mt.top_p)??void 0,frequency_penalty:((st=n==null?void 0:n.params)==null?void 0:st.frequency_penalty)??void 0,max_tokens:((ge=n==null?void 0:n.params)==null?void 0:ge.max_tokens)??void 0,tool_ids:P.length>0?P:void 0,docs:je.length>0?je:void 0,citations:je.length>0,chat_id:l},`${Fn}`);if(await Ve(),W(),Te&&Te.ok&&Te.body){const Ie=await Ks(Te.body,n.splitLargeChunks);let Se=null;for await(const rt of Ie){const{value:bt,done:wt,citations:al,error:cl,usage:ul}=rt;if(cl){await z(cl,null,B,G);break}if(wt||w||le!==l){if(G.done=!0,t(15,V),t(3,L),w)Ue.abort("User: Stop Response");else{const Vn=te(Ee);await Be(B.id,Vn)}Le=G.content;break}if(ul&&(Se=ul),al){G.citations=al;continue}G.content==""&&bt==`
`||(G.content+=bt,t(15,V),t(3,L),M&&W())}if(n.notificationEnabled&&!document.hasFocus()){const rt=new Notification(`${B.id}`,{body:G.content,icon:`${Ot}/static/favicon.png`})}n.responseAutoCopy&&_l(G.content),n.responseAutoPlayback&&!i&&(await Ve(),(Oe=document.getElementById(`speak-button-${G.id}`))==null||Oe.click()),Se&&(G.info={...Se,openai:!0}),l==le&&(n.saveChatHistory??!0)&&(t(11,H=await el(localStorage.token,le,{models:C,messages:V,history:L})),await Dt.set(await Mt(localStorage.token)))}else await z(null,Te,B,G)}catch(Te){await z(Te,null,B,G)}if(t(15,V),t(3,L),w=!1,await Ve(),M&&W(),V.length==2){window.history.replaceState(L.state,"",`/c/${le}`);const Te=await Me(ee);await Ne(le,Te)}return Le},z=async(B,ee,Ee,le)=>{let Le="",G;B?G=B:ee!==null&&(G=await ee.json()),console.error(G),"detail"in G?(ve.error(G.detail),Le=G.detail):"error"in G?"message"in G.error?(ve.error(G.error.message),Le=G.error.message):(ve.error(G.error),Le=G.error):"message"in G&&(ve.error(G.message),Le=G.message),le.error={content:o.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:Ee.name??Ee.id})+`
`+Le},le.done=!0,t(15,V),t(3,L)},$=()=>{w=!0,console.log("stopResponse")},K=async B=>{if(console.log("regenerateResponse"),V.length!=0){let ee=L.messages[B.parentId],Ee=ee.content;((ee==null?void 0:ee.models)??[...C]).length==1?await We(Ee,ee.id,void 0,!1):await We(Ee,ee.id,B.model,!1)}},oe=async()=>{console.log("continueGeneration");const B=JSON.parse(JSON.stringify(l));if(V.length!=0&&V.at(-1).done==!0){const ee=L.messages[L.currentId];ee.done=!1,await Ve();const Ee=r.filter(le=>le.id===ee.model).at(0);Ee&&((Ee==null?void 0:Ee.owned_by)==="openai"?await he(Ee,L.messages[ee.parentId].content,ee.id,B):await Z(Ee,L.messages[ee.parentId].content,ee.id,B))}else ve.error(o.t("Model {{modelId}} not found",{modelId}))},Me=async B=>{var ee;return((ee=n==null?void 0:n.title)==null?void 0:ee.auto)??!0?await is(localStorage.token,C[0],B,l).catch(le=>(console.error(le),"New Chat")):`${B}`},Ne=async(B,ee)=>{B===l&&t(12,j=ee),(n.saveChatHistory??!0)&&(t(11,H=await el(localStorage.token,B,{title:ee})),await Dt.set(await Mt(localStorage.token)))},Ke=async()=>await Kn(localStorage.token,l).catch(async B=>[]);function Ze(B){x=B,t(14,x)}function tt(B){C=B,t(1,C)}function nt(B){N=B,t(7,N)}const lt=B=>B.dismissible?!JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]").includes(B.id):!0,_t=B=>{const ee=B.detail;localStorage.setItem("dismissedBannerIds",JSON.stringify([ee,...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]")].filter(Ee=>S.find(le=>le.id===Ee))))};function zt(B){L=B,t(3,L)}function Rt(B){V=B,t(15,V),t(3,L)}function jt(B){M=B,t(5,M)}function qt(B){re=B,t(13,re)}function Ft(B){be[B?"unshift":"push"](()=>{D=B,t(6,D)})}const Wt=B=>{t(5,M=D.scrollHeight-D.scrollTop<=D.clientHeight+5)},Zt=(B,ee,Ee,le)=>{var G,je;const Le=r.find(xe=>xe.id===ee);return((je=(G=Le==null?void 0:Le.info)==null?void 0:G.meta)==null?void 0:je.toolIds)??!1?[...new Set([...B,...Le.info.meta.toolIds])]:B};function Gt(B){x=B,t(14,x)}function Jt(B){re=B,t(13,re)}function Qt(B){M=B,t(5,M)}function Yt(B){P=B,t(9,P)}function Xt(B){F=B,t(10,F)}function Kt(B){R=B,t(2,R)}return s.$$set=B=>{"chatIdProp"in B&&t(0,b=B.chatIdProp)},s.$$.update=()=>{if(s.$$.dirty[0]&6&&t(8,T=R!==void 0?[R.id]:C),s.$$.dirty[0]&8)if(L.currentId!==null){let B=[],ee=L.messages[L.currentId];for(;ee!==null;)B.unshift({...ee}),ee=ee.parentId!==null?L.messages[ee.parentId]:null;t(15,V=B)}else t(15,V=[]);s.$$.dirty[0]&1&&b&&(async()=>{if(await J()){await Ve(),t(4,_=!0),window.setTimeout(()=>W(),0);const B=document.getElementById("chat-textarea");B==null||B.focus()}else await xt("/")})()},[b,C,R,L,_,M,D,N,T,P,F,H,j,re,x,V,l,r,m,p,S,g,q,$e,We,$,K,oe,Ze,tt,nt,lt,_t,zt,Rt,jt,qt,Ft,Wt,Zt,Gt,Jt,Qt,Yt,Xt,Kt]}class Xi extends Ye{constructor(e){super(),Xe(this,e,mi,di,Qe,{chatIdProp:0},null,[-1,-1,-1])}}export{Xi as C};
//# sourceMappingURL=Chat.3cf16cfd.js.map
