import{r as f,cH as ln,cI as At,cJ as an,V as O,cK as cn,cL as $t,cM as Yt,cN as dn,cO as pn,cP as Ht,cQ as Ct,cR as fn,ai as Rt,ae as Bt,u as tt,h as ye,bv as Fn,bw as mn,j as t,B as fe,I as K,f as lt,cS as hn,cT as Cn,aB as xu,cU as En,cV as xn,ak as Ut,av as ae,bk as kt,bm as gn,ad as A,cW as ke,af as at,ca as Su,c0 as ku,c1 as _u,t as V,aa as Vt,bl as yn,R as vn,al as gu,cX as Jt,S as _e,ah as bt,b_ as Kt,cY as jn,cZ as wn,c_ as et,c$ as bn,b8 as Nn,d0 as yu,d1 as Bn,d2 as An,n as Gt,d3 as Sn,d4 as kn,aq as G,ap as vu,d5 as _n,d6 as Tn,d7 as In,ao as St,d8 as ju,d9 as Wt,da as On,db as $n,dc as Rn,dd as wu,de as Ln,df as zn,dg as Pn,aX as Mn,dh as Hn,di as Tt,dj as Un,dk as bu,bn as Vn,dl as Kn,dm as Gn,am as Lt,cA as Wn,az as qn,aA as Yn,dn as Nu,dp as Jn,dq as Xn,aO as Zn,dr as Qn,ds as es,dt as ts,du as us}from"./index-5634da17.js";import{I as Tu,C as ns}from"./index-f8d475cd.js";import{T as Iu}from"./textarea-f494b04c.js";import{G as Xt,P as Ou,D as $u,E as Ru,F as Lu,B as Zt,K as zu,H as Pu,I as Mu,A as Hu,C as Z,T as ss,R as os,L as rs}from"./index-ccf8a447.js";import{c as Uu,d as Ds,e as ls,f as Vu,g as as,h as Ku,i as Gu,k as is,l as Wu,$ as cs}from"./index-adfcaaa4.js";import{C as It}from"./index-22d35d7a.js";import{D as qu}from"./index-eb534ee4.js";import{D as ds}from"./index-bd9574ff.js";import{A as ps}from"./addNewVariableButton-9ef956e1.js";import{a as fs,E as Fs}from"./index-f73dfd96.js";import{T as ms}from"./index-fa3cc2ef.js";import{C as hs}from"./checkbox-2a2c6b2c.js";import{u as W}from"./shortcuts-b309903c.js";function Cs(){return O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},O.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function Es(){return O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},O.createElement("path",{d:"M0 0h32v4.2H0z"}))}function xs(){return O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},O.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function gs(){return O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},O.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function ys(){return O.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},O.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Nt=({children:e,className:u,...n})=>O.createElement("button",{type:"button",className:$t(["react-flow__controls-button",u]),...n},e);Nt.displayName="ControlButton";const vs=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),Yu=({style:e,showZoom:u=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:i,onZoomIn:a,onZoomOut:d,onFitView:s,onInteractiveChange:h,className:p,children:C,position:c="bottom-left"})=>{const m=ln(),[E,g]=f.useState(!1),{isInteractive:j,minZoomReached:x,maxZoomReached:F}=At(vs,Yt),{zoomIn:w,zoomOut:b,fitView:y}=an();if(f.useEffect(()=>{g(!0)},[]),!E)return null;const _=()=>{w(),a==null||a()},T=()=>{b(),d==null||d()},P=()=>{y(i),s==null||s()},I=()=>{m.setState({nodesDraggable:!j,nodesConnectable:!j,elementsSelectable:!j}),h==null||h(!j)};return O.createElement(cn,{className:$t(["react-flow__controls",p]),position:c,style:e,"data-testid":"rf__controls"},u&&O.createElement(O.Fragment,null,O.createElement(Nt,{onClick:_,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:F},O.createElement(Cs,null)),O.createElement(Nt,{onClick:T,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:x},O.createElement(Es,null))),n&&O.createElement(Nt,{className:"react-flow__controls-fitview",onClick:P,title:"fit view","aria-label":"fit view"},O.createElement(xs,null)),o&&O.createElement(Nt,{className:"react-flow__controls-interactive",onClick:I,title:"toggle interactivity","aria-label":"toggle interactivity"},j?O.createElement(ys,null):O.createElement(gs,null)),C)};Yu.displayName="Controls";var js=f.memo(Yu),Ye;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ye||(Ye={}));function ws({color:e,dimensions:u,lineWidth:n}){return O.createElement("path",{stroke:e,strokeWidth:n,d:`M${u[0]/2} 0 V${u[1]} M0 ${u[1]/2} H${u[0]}`})}function bs({color:e,radius:u}){return O.createElement("circle",{cx:u,cy:u,r:u,fill:e})}const Ns={[Ye.Dots]:"#91919a",[Ye.Lines]:"#eee",[Ye.Cross]:"#e2e2e2"},Bs={[Ye.Dots]:1,[Ye.Lines]:1,[Ye.Cross]:6},As=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Ju({id:e,variant:u=Ye.Dots,gap:n=20,size:o,lineWidth:i=1,offset:a=2,color:d,style:s,className:h}){const p=f.useRef(null),{transform:C,patternId:c}=At(As,Yt),m=d||Ns[u],E=o||Bs[u],g=u===Ye.Dots,j=u===Ye.Cross,x=Array.isArray(n)?n:[n,n],F=[x[0]*C[2]||1,x[1]*C[2]||1],w=E*C[2],b=j?[w,w]:F,y=g?[w/a,w/a]:[b[0]/a,b[1]/a];return O.createElement("svg",{className:$t(["react-flow__background",h]),style:{...s,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:p,"data-testid":"rf__background"},O.createElement("pattern",{id:c+e,x:C[0]%F[0],y:C[1]%F[1],width:F[0],height:F[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${y[0]},-${y[1]})`},g?O.createElement(bs,{color:m,radius:w/a}):O.createElement(ws,{dimensions:b,color:m,lineWidth:i})),O.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${c+e})`}))}Ju.displayName="Background";var Ss=f.memo(Ju);const ks=e=>{var u;return(u=e.domNode)==null?void 0:u.querySelector(".react-flow__renderer")};function _s({children:e}){const u=At(ks);return u?fn.createPortal(e,u):null}const Ts=(e,u)=>{var n,o,i,a,d,s;return((n=e==null?void 0:e.positionAbsolute)==null?void 0:n.x)===((o=u==null?void 0:u.positionAbsolute)==null?void 0:o.x)&&((i=e==null?void 0:e.positionAbsolute)==null?void 0:i.y)===((a=u==null?void 0:u.positionAbsolute)==null?void 0:a.y)&&(e==null?void 0:e.width)===(u==null?void 0:u.width)&&(e==null?void 0:e.height)===(u==null?void 0:u.height)&&(e==null?void 0:e.selected)===(u==null?void 0:u.selected)&&((d=e==null?void 0:e[Ht])==null?void 0:d.z)===((s=u==null?void 0:u[Ht])==null?void 0:s.z)},Is=(e,u)=>e.length===u.length&&e.every((n,o)=>Ts(n,u[o])),Os=e=>({transform:e.transform,nodeOrigin:e.nodeOrigin,selectedNodesCount:e.getNodes().filter(u=>u.selected).length});function $s(e,u,n,o,i){let a=.5;i==="start"?a=0:i==="end"&&(a=1);let d=[(e.x+e.width*a)*u[2]+u[0],e.y*u[2]+u[1]-o],s=[-100*a,-100];switch(n){case Ct.Right:d=[(e.x+e.width)*u[2]+u[0]+o,(e.y+e.height*a)*u[2]+u[1]],s=[0,-100*a];break;case Ct.Bottom:d[1]=(e.y+e.height)*u[2]+u[1]+o,s[1]=0;break;case Ct.Left:d=[e.x*u[2]+u[0]-o,(e.y+e.height*a)*u[2]+u[1]],s=[-100,-100*a];break}return`translate(${d[0]}px, ${d[1]}px) translate(${s[0]}%, ${s[1]}%)`}function Xu({nodeId:e,children:u,className:n,style:o,isVisible:i,position:a=Ct.Top,offset:d=10,align:s="center",...h}){const p=dn(),C=f.useCallback(b=>(Array.isArray(e)?e:[e||p||""]).reduce((_,T)=>{const P=b.nodeInternals.get(T);return P&&_.push(P),_},[]),[e,p]),c=At(C,Is),{transform:m,nodeOrigin:E,selectedNodesCount:g}=At(Os,Yt);if(!(typeof i=="boolean"?i:c.length===1&&c[0].selected&&g===1)||!c.length)return null;const x=pn(c,E),F=Math.max(...c.map(b=>{var y;return(((y=b[Ht])==null?void 0:y.z)||1)+1})),w={position:"absolute",transform:$s(x,m,a,d,s),zIndex:F,...o};return O.createElement(_s,null,O.createElement("div",{style:w,className:$t(["react-flow__node-toolbar",n]),...h},u))}function qt(){return qt=Object.assign?Object.assign.bind():function(e){for(var u=1;u<arguments.length;u++){var n=arguments[u];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},qt.apply(this,arguments)}var Zu=["shift","alt","meta","mod","ctrl"],Rs={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function Et(e){return(Rs[e]||e).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function Ls(e){return Zu.includes(e)}function zt(e,u){return u===void 0&&(u=","),e.split(u)}function Pt(e,u,n){u===void 0&&(u="+");var o=e.toLocaleLowerCase().split(u).map(function(d){return Et(d)}),i={alt:o.includes("alt"),ctrl:o.includes("ctrl")||o.includes("control"),shift:o.includes("shift"),meta:o.includes("meta"),mod:o.includes("mod")},a=o.filter(function(d){return!Zu.includes(d)});return qt({},i,{keys:a,description:n})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&Qu([Et(e.key),Et(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&en([Et(e.key),Et(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){xt.clear()})})();var xt=new Set;function Qt(e){return Array.isArray(e)}function zs(e,u){u===void 0&&(u=",");var n=Qt(e)?e:e.split(u);return n.every(function(o){return xt.has(o.trim().toLowerCase())})}function Qu(e){var u=Array.isArray(e)?e:[e];xt.has("meta")&&xt.forEach(function(n){return!Ls(n)&&xt.delete(n.toLowerCase())}),u.forEach(function(n){return xt.add(n.toLowerCase())})}function en(e){var u=Array.isArray(e)?e:[e];e==="meta"?xt.clear():u.forEach(function(n){return xt.delete(n.toLowerCase())})}function Ps(e,u,n){(typeof n=="function"&&n(e,u)||n===!0)&&e.preventDefault()}function Ms(e,u,n){return typeof n=="function"?n(e,u):n===!0||n===void 0}function Hs(e){return tn(e,["input","textarea","select"])}function tn(e,u){var n=e.target;u===void 0&&(u=!1);var o=n&&n.tagName;return Qt(u)?!!(o&&u&&u.some(function(i){return i.toLowerCase()===o.toLowerCase()})):!!(o&&u&&u===!0)}function Us(e,u){return e.length===0&&u?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):u?e.some(function(n){return u.includes(n)})||e.includes("*"):!0}var Vs=function(u,n,o){o===void 0&&(o=!1);var i=n.alt,a=n.meta,d=n.mod,s=n.shift,h=n.ctrl,p=n.keys,C=u.key,c=u.code,m=u.ctrlKey,E=u.metaKey,g=u.shiftKey,j=u.altKey,x=Et(c),F=C.toLowerCase();if(!(p!=null&&p.includes(x))&&!(p!=null&&p.includes(F))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(x))return!1;if(!o){if(i===!j&&F!=="alt"||s===!g&&F!=="shift")return!1;if(d){if(!E&&!m)return!1}else if(a===!E&&F!=="meta"&&F!=="os"||h===!m&&F!=="ctrl"&&F!=="control")return!1}return p&&p.length===1&&(p.includes(F)||p.includes(x))?!0:p?zs(p):!p},Ks=f.createContext(void 0),Gs=function(){return f.useContext(Ks)};function un(e,u){return e&&u&&typeof e=="object"&&typeof u=="object"?Object.keys(e).length===Object.keys(u).length&&Object.keys(e).reduce(function(n,o){return n&&un(e[o],u[o])},!0):e===u}var Ws=f.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),qs=function(){return f.useContext(Ws)};function Ys(e){var u=f.useRef(void 0);return un(u.current,e)||(u.current=e),u.current}var Bu=function(u){u.stopPropagation(),u.preventDefault(),u.stopImmediatePropagation()},Js=typeof window<"u"?f.useLayoutEffect:f.useEffect;function q(e,u,n,o){var i=f.useRef(null),a=f.useRef(!1),d=n instanceof Array?o instanceof Array?void 0:o:n,s=Qt(e)?e.join(d==null?void 0:d.splitKey):e,h=n instanceof Array?n:o instanceof Array?o:void 0,p=f.useCallback(u,h??[]),C=f.useRef(p);h?C.current=p:C.current=u;var c=Ys(d),m=qs(),E=m.enabledScopes,g=Gs();return Js(function(){if(!((c==null?void 0:c.enabled)===!1||!Us(E,c==null?void 0:c.scopes))){var j=function(y,_){var T;if(_===void 0&&(_=!1),!(Hs(y)&&!tn(y,c==null?void 0:c.enableOnFormTags))){if(i.current!==null){var P=i.current.getRootNode();if((P instanceof Document||P instanceof ShadowRoot)&&P.activeElement!==i.current&&!i.current.contains(P.activeElement)){Bu(y);return}}(T=y.target)!=null&&T.isContentEditable&&!(c!=null&&c.enableOnContentEditable)||zt(s,c==null?void 0:c.splitKey).forEach(function(I){var k,ue=Pt(I,c==null?void 0:c.combinationKey);if(Vs(y,ue,c==null?void 0:c.ignoreModifiers)||(k=ue.keys)!=null&&k.includes("*")){if(c!=null&&c.ignoreEventWhen!=null&&c.ignoreEventWhen(y)||_&&a.current)return;if(Ps(y,ue,c==null?void 0:c.preventDefault),!Ms(y,ue,c==null?void 0:c.enabled)){Bu(y);return}C.current(y,ue),_||(a.current=!0)}})}},x=function(y){y.key!==void 0&&(Qu(Et(y.code)),((c==null?void 0:c.keydown)===void 0&&(c==null?void 0:c.keyup)!==!0||c!=null&&c.keydown)&&j(y))},F=function(y){y.key!==void 0&&(en(Et(y.code)),a.current=!1,c!=null&&c.keyup&&j(y,!0))},w=i.current||(d==null?void 0:d.document)||document;return w.addEventListener("keyup",F),w.addEventListener("keydown",x),g&&zt(s,c==null?void 0:c.splitKey).forEach(function(b){return g.addHotkey(Pt(b,c==null?void 0:c.combinationKey,c==null?void 0:c.description))}),function(){w.removeEventListener("keyup",F),w.removeEventListener("keydown",x),g&&zt(s,c==null?void 0:c.splitKey).forEach(function(b){return g.removeHotkey(Pt(b,c==null?void 0:c.combinationKey,c==null?void 0:c.description))})}}},[s,c,E]),i}function Au(e,u){return e.map(n=>u.find(o=>o.name===n)).map(n=>n.id)}function Xs({component:e,is_component:u,children:n,open:o,setOpen:i,disabled:a}){const d=Rt(L=>L.version),s=Bt(L=>L.hasStore),h=Bt(L=>L.hasApiKey),p=tt(L=>L.setSuccessData),C=tt(L=>L.setErrorData),[c,m]=i!==void 0&&o!==void 0?[o,i]:f.useState(!n),[E,g]=f.useState(!1),j=u?"component":"workflow",[x,F]=f.useState([]),[w,b]=f.useState(!1),[y,_]=f.useState(!0),[T,P]=f.useState([]),[I,k]=f.useState([]),ue=ye(L=>L.saveFlow),[Fe,Te]=f.useState(!1),re=(e==null?void 0:e.name)??"",me=(e==null?void 0:e.description)??"";f.useEffect(()=>{c&&h&&s&&(ve(),$())},[c,h,s]);function ve(){b(!0),Fn().then(L=>{F(L),b(!1)})}async function $(){Te(!0);const L=[];await mn({fields:["name","id","is_component"],filterByUser:!0}).then(te=>{var he;(he=te==null?void 0:te.results)==null||he.forEach(ne=>{(ne.is_component??!1)===u&&L.push({name:ne.name,id:ne.id})}),k(L),Te(!1)})}const se=async(L=!1)=>{hn(e),Cn(e);const te=xu({id:e.id,data:e.data,description:me,name:re,last_tested_version:d,is_component:u});function he(){u||ue(te,!0),p({title:`${u?"Component":"Flow"} shared successfully!`})}L?xn(te,Au(T,x),y,I.find(ne=>ne.name===re).id).then(he,ne=>{C({title:"Error sharing "+u?"component":"flow",list:[ne.response.data.detail]})}):En(te,Au(T,x),y).then(he,ne=>{C({title:"Error sharing "+u?"component":"flow",list:[ne.response.data.detail]})})},Q=()=>{se(!0),m(!1)},ee=()=>{e=xu(e),Ut(e)};let R=f.useMemo(()=>t.jsx(t.Fragment,{children:t.jsx(It,{open:E,title:"Replace",cancelText:"Cancel",confirmationText:"Replace",size:"x-small",icon:"SaveAll",index:6,onConfirm:()=>{Q(),g(!1)},onCancel:()=>{g(!1)},children:t.jsxs(It.Content,{children:[t.jsxs("span",{children:["It seems ",re," already exists. Do you want to replace it with the current?"]}),t.jsx("br",{}),t.jsx("span",{className:" text-xs text-destructive ",children:"Note: This action is irreversible."})]})})}),[I,re,Fe,se,E]);return t.jsxs(t.Fragment,{children:[t.jsxs(fe,{size:"smaller-h-full",open:!a&&c,setOpen:m,onSubmit:()=>{!I.some(te=>te.name===re)?(se(),m(!1)):g(!0)},children:[t.jsx(fe.Trigger,{asChild:!0,children:n||t.jsx(t.Fragment,{})}),t.jsxs(fe.Header,{description:`Publish ${u?"your component":"workflow"} to the Langflow Store.`,children:[t.jsx("span",{className:"pr-2",children:"Share"}),t.jsx(K,{name:"Share3",className:"-m-0.5 h-6 w-6 text-foreground","aria-hidden":"true"})]}),t.jsxs(fe.Content,{children:[t.jsx("div",{className:"w-full rounded-lg border border-border p-4",children:t.jsx(fs,{name:re,description:me})}),t.jsx("div",{className:"mt-3 flex h-8 w-full",children:t.jsx(ms,{tags:x,loadingTags:w,disabled:!1,selectedTags:T,setSelectedTags:P})}),t.jsxs("div",{className:"mb-2 mt-5 flex items-center space-x-2",children:[t.jsx(hs,{id:"public",checked:y,onCheckedChange:L=>{_(L)},"data-testid":"public-checkbox"}),t.jsxs("label",{htmlFor:"public",className:"export-modal-save-api text-sm ",children:["Set ",j," status to public"]})]}),t.jsxs("span",{className:" text-xs text-destructive ",children:[t.jsx("b",{children:"Attention:"})," API keys in specified fields are automatically removed upon sharing."]})]}),t.jsx(fe.Footer,{submit:{label:`Share ${u?" Component":" Flow"}`,loading:Fe},children:t.jsxs(t.Fragment,{children:[!u&&t.jsx(Fs,{children:t.jsxs(lt,{type:"button",variant:"outline",className:"gap-2",onClick:()=>{},children:[t.jsx(K,{name:"Download",className:"h-4 w-4"}),"Export"]})}),u&&t.jsxs(lt,{type:"button",variant:"outline",className:"gap-2",onClick:()=>{m(!1),ee()},children:[t.jsx(K,{name:"Download",className:"h-4 w-4"}),"Export"]})]})})]}),t.jsx(t.Fragment,{children:R})]})}const Zs=()=>/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26D3\uFE0F?(?:\u200D\uD83D\uDCA5)?|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF43\uDF45-\uDF4A\uDF4C-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDF44(?:\u200D\uD83D\uDFEB)?|\uDF4B(?:\u200D\uD83D\uDFE9)?|\uDFC3(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4\uDEB5](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE41\uDE43\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC08(?:\u200D\u2B1B)?|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC26(?:\u200D(?:\u2B1B|\uD83D\uDD25))?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?|\uDE42(?:\u200D[\u2194\u2195]\uFE0F?)?|\uDEB6(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC2\uDECE-\uDEDB\uDEE0-\uDEE8]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDCE(?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D(?:[\u2640\u2642]\uFE0F?(?:\u200D\u27A1\uFE0F?)?|\u27A1\uFE0F?))?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1|\uDDD1\u200D\uD83E\uDDD2(?:\u200D\uD83E\uDDD2)?|\uDDD2(?:\u200D\uD83E\uDDD2)?))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF\uDDBC\uDDBD](?:\u200D\u27A1\uFE0F?)?|[\uDDB0-\uDDB3]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/g;function nn({isMac:e,hasShift:u,filteredShortcut:n,shortcutWPlus:o}){return u?t.jsxs("span",{className:"flex gap-0.5 text-xs",children:[e?t.jsx(K,{name:"Command",className:"h-3 w-3"}):n[0],t.jsx(K,{name:"ArrowBigUp",className:" h-4 w-4"}),n.map((i,a)=>{if(a>0)return t.jsxs("span",{className:"",children:[" ",i.toUpperCase()," "]})})]}):t.jsxs("span",{className:"flex gap-1 text-xs",children:[o[0].toLowerCase()==="space"?"Space":o[0].length<=1?o[0]:e?t.jsx(K,{name:"Command",className:"h-3 w-3"}):o[0],o.map((i,a)=>{if(a>0)return t.jsxs("span",{className:"",children:[" ",i.toUpperCase()," "]})})]})}const Qs=cs,sn=f.forwardRef(({className:e,children:u,...n},o)=>t.jsxs(Uu,{ref:o,className:ae("flex w-full items-center justify-between",e),...n,children:[u,t.jsx(Ds,{asChild:!0})]}));sn.displayName=Uu.displayName;const on=f.forwardRef(({className:e,children:u,position:n="popper",...o},i)=>t.jsx(ls,{children:t.jsx(Vu,{ref:i,className:ae("relative z-50 min-w-[14rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...o,children:t.jsx(as,{className:ae("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:u})})}));on.displayName=Vu.displayName;const eo=f.forwardRef(({className:e,...u},n)=>t.jsx(Ku,{ref:n,className:ae("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...u}));eo.displayName=Ku.displayName;const pe=f.forwardRef(({className:e,children:u,...n},o)=>t.jsx(Gu,{ref:o,className:ae("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 pl-3 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:t.jsx(is,{children:u})}));pe.displayName=Gu.displayName;const to=f.forwardRef(({className:e,...u},n)=>t.jsx(Wu,{ref:n,className:ae("-mx-1 my-1 h-px bg-muted",e),...u}));to.displayName=Wu.displayName;function rn({disabled:e,onChange:u,setDb:n,name:o,data:i,editNode:a=!1}){const d=kt(m=>m.globalVariablesEntries),s=kt(m=>m.getVariableId),h=kt(m=>m.unavaliableFields),p=kt(m=>m.removeGlobalVariable),C=tt(m=>m.setErrorData);f.useEffect(()=>{i&&d&&!d.includes(i.value)&&i.load_from_db&&setTimeout(()=>{u("",!0),n(!1)},100)},[d]),f.useEffect(()=>{!i.value&&i.display_name&&h[i.display_name]&&!e&&setTimeout(()=>{n(!0),u(h[i.display_name])},100)},[h]);async function c(m){const E=s(m);E!==void 0?await gn(E).then(()=>{p(m),(i==null?void 0:i.value)===m&&(i!=null&&i.load_from_db)&&(u(""),n(!1))}).catch(()=>{C({title:"Error deleting variable",list:[ae("ID not found for variable: ",m)]})}):C({title:"Error deleting variable",list:[ae("ID not found for variable: ",m)]})}return t.jsx(Tu,{id:"input-"+o,editNode:a,disabled:e,password:i.password??!1,value:i.value??"",options:d,optionsPlaceholder:"Global Variables",optionsIcon:"Globe",optionsButton:t.jsx(ps,{children:t.jsxs(ns,{value:"doNotFilter-addNewVariable",children:[t.jsx(K,{name:"Plus",className:ae("mr-2 h-4 w-4 text-primary"),"aria-hidden":"true"}),t.jsx("span",{children:"Add New Variable"})]})}),optionButton:m=>t.jsx(ds,{onConfirm:E=>{E.stopPropagation(),E.preventDefault(),c(m)},description:'variable "'+m+'"',asChild:!0,children:t.jsx("button",{onClick:E=>{E.stopPropagation()},className:"pr-1",children:t.jsx(K,{name:"Trash2",className:ae("h-4 w-4 text-primary opacity-0 hover:text-status-red group-hover:opacity-100"),"aria-hidden":"true"})})}),selectedOption:i!=null&&i.load_from_db&&d&&d.includes((i==null?void 0:i.value)??"")?i==null?void 0:i.value:"",setSelectedOption:m=>{u(m),n(m!=="")},onChange:(m,E)=>{u(m,E),n(!1)}})}function uo({node:{data:e},value:{value:u,nodeClass:n,handleOnNewValue:o,handleOnChangeDb:i}}){const a=(F,w)=>{o(F,w),C(b=>{let y=V.cloneDeep(b);return y.value=F,y}),h(F)},d=(F,w)=>{i(F,w),C(b=>{let y=V.cloneDeep(b);return y.load_from_db=F,y})},[s,h]=f.useState(u),[p,C]=f.useState(e),[c,m]=f.useState(!1),E=A(F=>F.edges),g={inputTypes:p.input_types,type:p.type,id:n.id,fieldName:p.key},j=E.some(F=>F.targetHandle===ke(p.proxy?{...g,proxy:p.proxy}:g))??!1;function x(){switch(p.type){case"str":return p.options?t.jsx(qu,{editNode:!0,options:p.options,onSelect:F=>a(F,p.key),value:s??"Choose an option",id:"dropdown-edit-"+p.name}):p!=null&&p.list?t.jsx(Mu,{componentName:p.key??void 0,editNode:!0,disabled:j,value:!s||s===""?[""]:s,onChange:F=>{a(F,p.key)}}):p.multiline?t.jsx(Hu,{id:"textarea-edit-"+p.name,"data-testid":"textarea-edit-"+p.name,disabled:j,editNode:!0,value:s??"",onChange:F=>{a(F,p.key)}}):t.jsx(rn,{disabled:j,editNode:!0,onChange:F=>a(F,p.key),setDb:F=>{d(F,p.key)},name:p.key,data:p});case"NestedDict":return t.jsx(Pu,{disabled:j,editNode:!0,value:s.toString()==="{}"?{}:s,onChange:F=>{a(F,p.key)},id:"editnode-div-dict-input"});case"dict":return t.jsx("div",{className:at("max-h-48 w-full overflow-auto custom-scroll",(s==null?void 0:s.length)>1?"my-3":""),children:t.jsx(zu,{disabled:j,editNode:!0,value:(s==null?void 0:s.length)===0||!s?[{"":""}]:Su(s,p.type),duplicateKey:c,onChange:F=>{const w=ku(F);m(_u(w)),a(w,p.key)},isList:p.list??!1})});case"bool":return t.jsx(Zt,{id:"toggle-edit-"+p.name,disabled:j,enabled:s,setEnabled:F=>{a(F,p.key)},size:"small",editNode:!0});case"float":return t.jsx(Lu,{disabled:j,editNode:!0,rangeSpec:p.rangeSpec,value:s??"",onChange:F=>{a(F,p.key)}});case"int":return t.jsx(Ru,{rangeSpec:p.rangeSpec,id:"edit-int-input-"+p.name,disabled:j,editNode:!0,value:s??"",onChange:F=>{a(F,p.key)}});case"file":return t.jsx($u,{editNode:!0,disabled:j,value:s??"",onChange:F=>{a(F,p.key)},fileTypes:p.fileTypes,onFileChange:F=>{p.file_path=F}});case"prompt":return t.jsx(Ou,{readonly:!!n.flow,field_name:p.key,editNode:!0,disabled:j,nodeClass:n,setNodeClass:F=>{n=F},value:s??"",onChange:F=>{a(F,p.key)},id:"prompt-area-edit-"+p.name,"data-testid":"modal-prompt-input-"+p.name});case"code":return t.jsx(Xt,{readonly:!!(n.flow&&p.dynamic),dynamic:p.dynamic??!1,setNodeClass:F=>{n=F},nodeClass:n,disabled:j,editNode:!0,value:s??"",onChange:F=>{a(F,p.key)},id:"code-area-edit"+p.name});case"Any":return t.jsx(t.Fragment,{children:"-"});default:return String(s)}}return t.jsx("div",{className:"group mx-auto flex h-full w-[300px] items-center justify-center py-2.5",children:x()})}function no({value:{name:e,enabled:u,setEnabled:n}}){const[o,i]=f.useState(u);return t.jsx("div",{className:"flex h-full items-center",children:t.jsx(Zt,{id:"show"+e,enabled:o,setEnabled:a=>{i(a),n(a)},size:"small",editNode:!0})})}const so=(e,u,n,o,i)=>f.useMemo(()=>[{headerName:"Field Name",field:"display_name",valueGetter:d=>{const s=d.data;return(s.display_name?s.display_name:s.name)??d.data.key},wrapText:!0,autoHeight:!0,flex:1,resizable:!1,cellClass:"no-border"},{headerName:"Description",field:"info",tooltipField:"info",wrapText:!0,autoHeight:!0,flex:2,resizable:!1,cellClass:"no-border"},{headerName:"Value",field:"value",cellRenderer:uo,valueGetter:d=>({value:d.data.value,nodeClass:e.node,handleOnNewValue:u,handleOnChangeDb:n}),minWidth:340,autoHeight:!0,flex:1,resizable:!1,cellClass:"no-border"},{headerName:"Show",field:"advanced",cellRenderer:no,valueGetter:d=>({name:d.data.name,enabled:!d.data.advanced,setEnabled:()=>{o(d.data.key)}}),editable:!1,maxWidth:80,resizable:!1,cellClass:"no-border"}],[i,e]),oo=(e,u)=>f.useMemo(()=>Object.keys(e.node.template).filter(o=>{const i=e.node.template[o];return o.charAt(0)!=="_"&&i.show&&Vt.has(i.type)&&!(o==="code"&&i.type==="code"||o.includes("code")&&i.proxy)}).map(o=>({...e.node.template[o],key:o,id:o})),[u,e]),ro=f.forwardRef(({nodeLength:e,open:u,setOpen:n,data:o},i)=>{var j;const a=f.useRef(V.cloneDeep(o)),d=Rt(x=>x.dark),s=A(x=>x.setNode);function h(x){var F;a.current.node.template[x].advanced=!((F=a.current.node.template[x])!=null&&F.advanced)}const p=(x,F)=>{a.current.node.template[F].value=x},C=(x,F)=>{a.current.node.template[F].load_from_db=x},c=oo(o,u),m=so(o,p,C,h,u),[E,g]=f.useState(null);return f.useEffect(()=>{E&&u&&(a.current=V.cloneDeep(o),E.refreshCells())},[E,u]),t.jsxs(fe,{open:u,setOpen:n,children:[t.jsx(fe.Trigger,{children:t.jsx(t.Fragment,{})}),t.jsxs(fe.Header,{description:(j=o.node)==null?void 0:j.description,children:[t.jsx("span",{className:"pr-2",children:o.type}),t.jsx(yn,{variant:d?"gray":"secondary",children:t.jsxs("span",{className:"relative top-[0.6px]",children:["ID: ",o.id]})})]}),t.jsx(fe.Content,{children:t.jsx("div",{className:"flex h-full flex-col",children:t.jsx("div",{className:"h-full",children:e>0&&t.jsx(vn,{onGridReady:x=>{g(x.api)},tooltipShowDelay:.5,columnDefs:m,rowData:c},"editNode")})})}),t.jsx(fe.Footer,{submit:{label:"Save Changes",onClick:()=>{s(o.id,x=>({...x,data:{...x.data,node:a.current.node}})),n(!1)}}})]},o.id)});function Se({value:e,icon:u,style:n,dataTestId:o,ping:i,shortcut:a}){const d=navigator.platform.toUpperCase().includes("MAC");let s=!1;const h=a==null?void 0:a.split("+");h.forEach(c=>{c.toLowerCase().includes("shift")&&(s=!0)});const p=h.filter(c=>!c.toLowerCase().includes("shift"));let C=[];return s||(C=p.join("+").split(" ")),t.jsxs("div",{className:`flex ${n}`,"data-testid":o,children:[t.jsx(K,{name:u,className:`   mr-2  ${u==="Share3"?"absolute left-2  top-[0.25em] h-6 w-6":"mt-[0.15em] h-4 w-4"}   ${i&&"animate-pulse text-green-500"}`}),t.jsx("span",{className:`${u==="Share3"?"ml-[1.8em]":" "}`,children:e}),t.jsx("span",{className:"absolute right-2 top-[0.43em] flex items-center rounded-sm bg-muted px-1.5 py-[0.1em] text-muted-foreground ",children:t.jsx(nn,{isMac:d,hasShift:s,filteredShortcut:p,shortcutWPlus:C})})]})}function Do({data:e,deleteNode:u,setShowNode:n,numberOfHandles:o,showNode:i,name:a="code",selected:d,setShowState:s,onCloseAdvancedModal:h,updateNode:p}){var z,de,Qe,Le,D,S,M,J,oe,xe,ge,Ae,ze,Pe,Me,He,Ue,Ve,Ke,Ge,We,qe;const C=Rt(l=>l.version),[c,m]=f.useState(!1),[E,g]=f.useState(!1),[j,x]=f.useState(!1),[F,w]=f.useState(gu(V.cloneDeep(e),C)),b=!0,y=navigator.platform.toUpperCase().includes("MAC"),_=Object.keys(e.node.template).filter(l=>{var N;return l.charAt(0)!=="_"&&((N=e.node)==null?void 0:N.template[l].show)&&(e.node.template[l].type==="str"||e.node.template[l].type==="bool"||e.node.template[l].type==="float"||e.node.template[l].type==="code"||e.node.template[l].type==="prompt"||e.node.template[l].type==="file"||e.node.template[l].type==="Any"||e.node.template[l].type==="int"||e.node.template[l].type==="dict"||e.node.template[l].type==="NestedDict")}).length,T=Bt(l=>l.hasStore),P=Bt(l=>l.hasApiKey),I=Bt(l=>l.validApiKey),k=W(l=>l.shortcuts),ue=A(l=>l.unselectAll);function Fe(l){if(l.preventDefault(),Y){s(N=>!N),n(!(e.showNode??!0));return}Oe({title:"Minimization are only available for nodes with one handle or fewer."})}function Te(l){l.preventDefault(),je&&Xe("ungroup")}function re(l){l.preventDefault(),!(bt()&&!j)&&(P||T)&&g(N=>!N)}function me(l){if(l.preventDefault(),!(bt()&&!Ce)){if(Ee)return Be(N=>!N);Oe({title:`You can not access ${e.id} code`})}}function ve(l){l.preventDefault(),!(bt()&&!c)&&(je||m(N=>!N))}function $(l){if(l.preventDefault(),!(bt()&&!j)){if($e){x(N=>!N);return}if(Ee&&!$e){be(V.cloneDeep(e),!1),Ie({title:`${e.id} saved successfully`});return}}}function se(l){var N,H;if(l.preventDefault(),(N=e.node)!=null&&N.documentation)return Je((H=e.node)==null?void 0:H.documentation);Oe({title:`${e.id} docs is not available at the moment.`})}function Q(l){l.preventDefault(),Ut(F)}function ee(l){l.preventDefault(),ce(e.id,N=>{var H,X;return{...N,data:{...N.data,node:{...N.data.node,frozen:!((X=(H=N.data)==null?void 0:H.node)!=null&&X.frozen)}}}})}const R=W(l=>l.advanced),L=W(l=>l.minimize),te=W(l=>l.component),he=W(l=>l.save),ne=W(l=>l.docs),gt=W(l=>l.code),yt=W(l=>l.group),U=W(l=>l.download),ut=W(l=>l.freeze);q(L,Fe,{preventDefault:b}),q(yt,Te,{preventDefault:b}),q(te,re,{preventDefault:b}),q(gt,me,{preventDefault:b}),q(R,ve,{preventDefault:b}),q(he,$,{preventDefault:b}),q(ne,se,{preventDefault:b}),q(U,Q,{preventDefault:b}),q(ut,ee,{preventDefault:b});const Y=o<=1,je=!!((z=e.node)!=null&&z.flow),we=((de=e.node)==null?void 0:de.frozen)??!1,nt=A(l=>l.paste),ie=A(l=>l.nodes),it=A(l=>l.edges),ct=A(l=>l.setNodes),dt=A(l=>l.setEdges),be=ye(l=>l.saveComponent),pt=A(l=>l.getNodePosition),ft=ye(l=>l.flows),Ne=ye(l=>l.takeSnapshot),Je=l=>{window.open(l,"_blank","noreferrer")};f.useEffect(()=>{c||h(!1)},[c]);const st=Jt(),ot=A(l=>l.setLastCopiedSelection),Ie=tt(l=>l.setSuccessData),Oe=tt(l=>l.setNoticeData);f.useEffect(()=>{w(gu(V.cloneDeep(e),C))},[e,e.node,(Qe=e.node)==null?void 0:Qe.display_name,(Le=e.node)==null?void 0:Le.description,(D=e.node)==null?void 0:D.template,c,E]);const Xe=l=>{var N,H,X,Ft,mt;switch(l){case"save":if($e)return x(!0);be(V.cloneDeep(e),!1);break;case"freeze":ce(e.id,De=>{var jt,wt;return{...De,data:{...De.data,node:{...De.data.node,frozen:!((wt=(jt=De.data)==null?void 0:jt.node)!=null&&wt.frozen)}}}});break;case"code":Be(!Ce);break;case"advanced":m(!0);break;case"show":Ne(),n(!(e.showNode??!0));break;case"Share":(P||T)&&g(!0);break;case"Download":Ut(F);break;case"SaveAll":be(V.cloneDeep(e),!1);break;case"documentation":(N=e.node)!=null&&N.documentation&&Je((H=e.node)==null?void 0:H.documentation);break;case"disabled":break;case"unselect":ue();break;case"ungroup":Ne(),jn(e.id,wn(pt(e.id),(X=e.node)==null?void 0:X.flow),e.node.template,ie,it,ct,dt);break;case"override":x(!0);break;case"delete":u(e.id);break;case"update":p();break;case"copy":const ht=ie.filter(De=>De.id===e.id);ot({nodes:Kt.cloneDeep(ht),edges:[]});break;case"duplicate":nt({nodes:[ie.find(De=>De.id===e.id)],edges:[]},{x:50,y:10,paneX:(Ft=ie.find(De=>De.id===e.id))==null?void 0:Ft.position.x,paneY:(mt=ie.find(De=>De.id===e.id))==null?void 0:mt.position.y});break}},$e=ft.some(l=>{var N;return Object.values(l).includes((N=e.node)==null?void 0:N.display_name)});function Re({name:l,shortcut:N}){let H=!1;const X=N==null?void 0:N.split("+");X.forEach(ht=>{ht.toLowerCase().includes("shift")&&(H=!0)});const Ft=X.filter(ht=>!ht.toLowerCase().includes("shift"));let mt=[];return H||(mt=Ft.join("+").split(" ")),t.jsxs("div",{className:"flex justify-center",children:[t.jsxs("span",{children:[" ",l," "]}),t.jsx("span",{className:"ml-3 flex items-center rounded-sm bg-muted px-1.5 py-[0.1em] text-lg text-muted-foreground",children:t.jsx(nn,{isMac:y,hasShift:H,filteredShortcut:Ft,shortcutWPlus:mt})})]})}const ce=A(l=>l.setNode),Ze=l=>{e.node.template[a].value!==l&&Ne(),e.node.template[a].value=l,ce(e.id,N=>{let H=V.cloneDeep(N);return H.data={...H.data},H.data.node.template[a].value=l,H})},rt=(l,N)=>{e.node&&(e.node.template[a].value!==N&&Ne(),ce(e.id,H=>{let X=V.cloneDeep(H);return X.data={...X.data,node:l,description:l.description??e.node.description,display_name:l.display_name??e.node.display_name},X.data.node.template[a].value=N,X}),st(e.id))},[Ce,Be]=f.useState(!1),Ee=Object.keys(e.node.template).includes("code"),[r,v]=f.useState(!1);return t.jsx(t.Fragment,{children:t.jsx("div",{className:"w-26 nocopy nowheel nopan nodelete nodrag noundo h-10",children:t.jsxs("span",{className:"isolate inline-flex rounded-md shadow-sm",children:[Ee&&t.jsx(_e,{content:Re(k.find(({name:l})=>l.split(" ")[0].toLowerCase()==="code")),side:"top",children:t.jsx("button",{className:"relative inline-flex items-center rounded-l-md bg-background px-2 py-2 text-foreground shadow-md ring-1 ring-inset ring-ring transition-all duration-500 ease-in-out hover:bg-muted focus:z-10",onClick:()=>{Be(!Ce)},"data-testid":"code-button-modal",children:t.jsx(K,{name:"Code",className:"h-4 w-4"})})}),_>0&&t.jsx(_e,{content:Re(k.find(({name:l})=>l.split(" ")[0].toLowerCase()==="advanced")),side:"top",children:t.jsx("button",{className:`${je?"rounded-l-md":""} relative -ml-px inline-flex items-center bg-background px-2 py-2 text-foreground shadow-md ring-1 ring-inset ring-ring  transition-all duration-500 ease-in-out hover:bg-muted focus:z-10`,onClick:()=>{m(!0)},"data-testid":"code-button-modal",children:t.jsx(K,{name:"Settings2",className:"h-4 w-4"})})}),t.jsx(_e,{content:Re(k.find(({name:l})=>l.split(" ")[0].toLowerCase()==="freeze")),side:"top",children:t.jsx("button",{className:at("relative -ml-px inline-flex items-center bg-background px-2 py-2 text-foreground shadow-md ring-1 ring-inset ring-ring  transition-all duration-500 ease-in-out hover:bg-muted focus:z-10"),onClick:l=>{l.preventDefault(),ce(e.id,N=>{var H,X;return{...N,data:{...N.data,node:{...N.data.node,frozen:!((X=(H=N.data)==null?void 0:H.node)!=null&&X.frozen)}}}})},children:t.jsx(K,{name:"Snowflake",className:ae("h-4 w-4 transition-all",we?"animate-wiggle text-ice":"")})})}),t.jsxs(Qs,{onValueChange:Xe,value:"",children:[t.jsx(_e,{content:"All",side:"top",children:t.jsx(sn,{children:t.jsx("div",{children:t.jsx("div",{"data-testid":"more-options-modal",className:at("relative -ml-px inline-flex h-8 w-[31px] items-center rounded-r-md bg-background text-foreground  shadow-md ring-1 ring-inset  ring-ring transition-all duration-500 ease-in-out hover:bg-muted focus:z-10"),children:t.jsx(K,{name:"MoreHorizontal",className:"relative left-2 h-4 w-4"})})})})}),t.jsxs(on,{children:[Ee&&t.jsx(pe,{value:"code",children:t.jsx(Se,{shortcut:(S=k.find(l=>l.name==="Code"))==null?void 0:S.shortcut,value:"Code",icon:"Code",dataTestId:"code-button-modal"})}),_>0&&t.jsx(pe,{value:_===0?"disabled":"advanced",children:t.jsx(Se,{shortcut:(M=k.find(l=>l.name==="Advanced Settings"))==null?void 0:M.shortcut,value:"Advanced",icon:"Settings2",dataTestId:"edit-button-modal"})}),t.jsx(pe,{value:"save",children:t.jsx(Se,{shortcut:(J=k.find(l=>l.name==="Save"))==null?void 0:J.shortcut,value:"Save",icon:"SaveAll",dataTestId:"save-button-modal"})}),t.jsx(pe,{value:"duplicate",children:t.jsx(Se,{shortcut:(oe=k.find(l=>l.name==="Duplicate"))==null?void 0:oe.shortcut,value:"Duplicate",icon:"Copy",dataTestId:"copy-button-modal"})}),t.jsx(pe,{value:"copy",children:t.jsx(Se,{shortcut:(xe=k.find(l=>l.name==="Copy"))==null?void 0:xe.shortcut,value:"Copy",icon:"Clipboard",dataTestId:"copy-button-modal"})}),T&&t.jsx(pe,{value:"Share",disabled:!P||!I,children:t.jsx(Se,{shortcut:(ge=k.find(l=>l.name==="Component Share"))==null?void 0:ge.shortcut,value:"Share",icon:"Share3",dataTestId:"share-button-modal"})}),(!T||!P||!I)&&t.jsx(pe,{value:"Download",children:t.jsx(Se,{shortcut:(Ae=k.find(l=>l.name==="Download"))==null?void 0:Ae.shortcut,value:"Download",icon:"Download",dataTestId:"Download-button-modal"})}),t.jsx(pe,{value:"documentation",disabled:((ze=e.node)==null?void 0:ze.documentation)==="",children:t.jsx(Se,{shortcut:(Pe=k.find(l=>l.name==="Docs"))==null?void 0:Pe.shortcut,value:"Docs",icon:"FileText",dataTestId:"docs-button-modal"})}),Y&&t.jsx(pe,{value:"show",children:t.jsx(Se,{shortcut:(Me=k.find(l=>l.name==="Minimize"))==null?void 0:Me.shortcut,value:i?"Minimize":"Expand",icon:i?"Minimize2":"Maximize2",dataTestId:"minimize-button-modal"})}),je&&t.jsx(pe,{value:"ungroup",children:t.jsx(Se,{shortcut:(He=k.find(l=>l.name==="Group"))==null?void 0:He.shortcut,value:"Ungroup",icon:"Ungroup",dataTestId:"group-button-modal"})}),t.jsx(pe,{value:"freeze",children:t.jsx(Se,{shortcut:(Ue=k.find(l=>l.name==="Freeze"))==null?void 0:Ue.shortcut,value:"Freeze",icon:"Snowflake",dataTestId:"group-button-modal",style:`${we?" text-ice":""} transition-all`})}),t.jsx(pe,{value:"Download",children:t.jsx(Se,{shortcut:(Ve=k.find(l=>l.name==="Download"))==null?void 0:Ve.shortcut,value:"Download",icon:"Download",dataTestId:"download-button-modal"})}),t.jsx(pe,{value:"delete",className:"focus:bg-red-400/[.20]",onFocus:()=>v(!0),onBlur:()=>v(!1),children:t.jsxs("div",{className:"font-red flex text-status-red",children:[t.jsx(K,{name:"Trash2",className:"relative top-0.5 mr-2 h-4 w-4 "})," ",t.jsx("span",{className:"",children:"Delete"})," ",t.jsx("span",{className:` absolute right-2 top-2 flex items-center justify-center rounded-sm px-1 py-[0.2] ${r?" ":"bg-muted"}`,children:t.jsx(K,{name:"Delete",className:"h-4 w-4 stroke-2 text-red-400"})})]})})]})]}),t.jsx(It,{open:j,title:"Replace",cancelText:"Create New",confirmationText:"Replace",size:"x-small",icon:"SaveAll",index:6,onConfirm:(l,N)=>{be(V.cloneDeep(e),!0),Ie({title:`${e.id} successfully overridden!`})},onClose:x,onCancel:()=>{be(V.cloneDeep(e),!1),Ie({title:"New node successfully saved!"})},children:t.jsx(It.Content,{children:t.jsxs("span",{children:["It seems ",(Ke=e.node)==null?void 0:Ke.display_name," already exists. Do you want to replace it with the current or create a new one?"]})})}),c&&t.jsx(ro,{data:e,nodeLength:_,open:c,setOpen:m}),E&&t.jsx(Xs,{open:E,setOpen:g,is_component:!0,component:F}),Ee&&t.jsx("div",{className:"hidden",children:Ce&&t.jsx(Xt,{open:Ce,setOpen:Be,readonly:!!((Ge=e.node)!=null&&Ge.flow&&e.node.template[a].dynamic),dynamic:((We=e.node)==null?void 0:We.template[a].dynamic)??!1,setNodeClass:rt,nodeClass:e.node,disabled:!1,value:((qe=e.node)==null?void 0:qe.template[a].value)??"",onChange:Ze,id:"code-input-node-toolbar-"+a})})]})})})}function lo(e){return Object.keys(e.node.template).filter(n=>n.charAt(0)!=="_").map(n=>{const{template:o}=e.node;if(o[n].input_types)return!0;if(!o[n].show)return!1;switch(o[n].type){case"str":case"bool":case"float":case"code":case"prompt":case"file":case"int":return!1;default:return!0}}).reduce((n,o)=>n+(o?1:0),0)}const ao=(e,u,n)=>{let o=u&&!u.valid;return e===et.INACTIVE?"inactive-status":e===et.BUILT&&o||e===et.ERROR?n?"built-invalid-status-dark":"built-invalid-status":e===et.BUILDING?"building-status":""},io=(e,u,n,o)=>{var i,a,d;f.useEffect(()=>{var c,m,E,g,j,x,F;if(!bn.includes(o[e.type])||!((E=(m=(c=e.node)==null?void 0:c.template)==null?void 0:m.code)!=null&&E.value))return;const s=u[e.type].template;if(!s.code)return;const h=(g=s.code)==null?void 0:g.value,p=(x=(j=e.node.template)==null?void 0:j.code)==null?void 0:x.value;h!==p&&!["CustomComponent","Prompt"].includes(e.type)&&!(((F=e.node)==null?void 0:F.edited)??!1)?n(!0):n(!1)},[(d=(a=(i=e.node)==null?void 0:i.template)==null?void 0:a.code)==null?void 0:d.value,u,n])},co=(e,u,n,o,i,a,d,s)=>f.useCallback(()=>{var E,g;const p=(E=e==null?void 0:e.node)==null?void 0:E.icon,C=n[u[e.type]],c=p||((g=e.node)!=null&&g.flow?"group_components":o),m=`generic-node-icon ${i?"":" absolute inset-x-6 h-12 w-12 "}`;return p&&a?d(p):s(C,c,m)},[e,u,n,o,i,a,d,s]),po=(e,u)=>{const n=u&&u.valid,o=u&&!u.valid&&e===et.INACTIVE,i=e===et.ERROR||u&&!u.valid;return(()=>e===et.BUILDING?t.jsx(Nn,{className:"text-medium-indigo"}):t.jsx("div",{className:ae("h-4 w-4 shrink-0 cursor-pointer rounded-full",n?"bg-status-green":o?"bg-status-gray":i?"bg-status-red":"bg-muted-foreground/40")}))()},fo=(e,u,n,o,i)=>f.useCallback((d,s,h)=>{n(e,p=>{let C=V.cloneDeep(p);return C.data={...C.data,node:d,description:d.description??u.description,display_name:d.display_name??u.display_name,edited:!1},C.data.node.template[h].value=s,o(!1),C}),i(e)},[e,u,n,o,i]),Fo=(e,u,n)=>{f.useEffect(()=>{var i;const o=u[e]&&((i=u[e])==null?void 0:i.length)>0?u[e][u[e].length-1]:null;n(o||null)},[u[e],e,n])},mo=(e,u)=>{f.useEffect(()=>{if(e!=null&&e.data.logs){let n="";Array.isArray(e.data.logs)&&(n=e.data.logs.map(o=>o!=null&&o.message?o.message:JSON.stringify(o)).join(`
`)),typeof n!="string"&&(n=JSON.stringify(e.data.logs)),u(n)}},[e,e==null?void 0:e.data.logs,u])};function ho(e,u,n){if(!e&&!u)return 0;if(!e)return 1;if(!u)return-1;const o=e.toLowerCase(),i=u.toLowerCase(),a=yu.has(o),d=yu.has(i);if(a&&!d)return-1;if(!a&&d)return 1;const s=n.indexOf(o),h=n.indexOf(i);return s!==-1&&h!==-1?s-h:s!==-1?-1:h!==-1?1:e.localeCompare(u)}function Mt({isLoading:e,disabled:u,name:n,button_text:o,data:i,handleUpdateValues:a,className:d,id:s}){const h=async()=>{u||a(n,i)},p=ae(d,u?"cursor-not-allowed":""),c=ae("h-4 w-4 animate-wiggle",u?"text-muted-foreground":"");return t.jsxs(lt,{variant:"primary",disabled:u,className:p,onClick:h,id:s,loading:e,children:[o&&t.jsx("span",{className:"mr-1",children:o}),t.jsx(K,{name:"RefreshCcw",className:c,id:s+"-icon"})]})}const Ot=async(e,u)=>{var i,a,d,s,h,p,C;const n=(d=(a=(i=u.node)==null?void 0:i.template)==null?void 0:a.code)==null?void 0:d.value;if(!n){console.error("Code not found in the template");return}const o=(s=u.node)==null?void 0:s.template;if(!o){console.error("No template found in the node.");return}try{const c=await An(n,o,e,(p=(h=u.node)==null?void 0:h.template[e])==null?void 0:p.value);if(c.status===200&&((C=u.node)!=null&&C.template))return c.data.template}catch(c){throw console.error("Error occurred while updating the node:",c),c}},Co=V.debounce(Ot,Bn),Eo=(e,u,n,o,i,a)=>{const d=tt(s=>s.setErrorData);f.useEffect(()=>{async function s(){var h,p,C,c,m,E,g,j,x;if(((p=(h=e.node)==null?void 0:h.template[u])!=null&&p.real_time_refresh||(c=(C=e.node)==null?void 0:C.template[u])!=null&&c.refresh_button)&&(((g=(E=(m=e.node)==null?void 0:m.template[u])==null?void 0:E.options)==null?void 0:g.length)??0)===0){a(!0);try{let F=await n(u,e);F&&o(e.id,w=>{let b=V.cloneDeep(w);return b.data={...b.data},b.data.node.template=F,b})}catch(F){let w=F;d({title:"Error while updating the Component",list:[((x=(j=w==null?void 0:w.response)==null?void 0:j.data)==null?void 0:x.detail)??"Unknown error"]})}a(!1),i()}}s()},[])},xo=(e,u,n,o,i,a,d,s)=>{const h=tt(C=>C.setErrorData);return{handleOnNewValue:async(C,c=!1)=>{var F,w,b,y;const m=e.node.template[u],E=m.value;E!==C&&!c&&n();const g=((F=e.node)==null?void 0:F.template[u].real_time_refresh)&&!((w=e.node)!=null&&w.template[u].refresh_button)&&E!==C,j=m.type;m.value=C;let x;if(g){s(!0);try{["int"].includes(j)?x=await o(u,e):x=await i(u,e)}catch(_){let T=_;h({title:"Error while updating the Component",list:[((y=(b=T==null?void 0:T.response)==null?void 0:b.data)==null?void 0:y.detail.error)??"Unknown error"]})}s(!1)}a(e.id,_=>{var P;const T=V.cloneDeep(_);return T.data={...T.data},(P=e.node)!=null&&P.template[u].real_time_refresh&&x?T.data.node.template=x:T.data.node.template[u].value=C,T}),d()}}},go=(e,u,n,o,i,a)=>({handleNodeClass:(s,h)=>{e.node&&(e.node.template[u].value!==h&&n(),o(e.id,p=>{let C=V.cloneDeep(p);return C.data={...C.data,node:s,description:s.description??e.node.description,display_name:s.display_name??e.node.display_name},C.data.node.template[u].value=h,C}),i(e.id),a())}}),yo=(e,u,n)=>{const o=tt(a=>a.setErrorData);return{handleRefreshButtonPress:async(a,d)=>{var s,h;e(!0);try{let p=await Ot(a,d);p&&u(d.id,C=>{let c=V.cloneDeep(C);return c.data={...c.data},c.data.node.template=p,c})}catch(p){let C=p;o({title:"Error while updating the Component",list:[((h=(s=C==null?void 0:C.response)==null?void 0:s.data)==null?void 0:h.detail)??"Unknown error"]})}e(!1),n()}}},vo=({item:e,index:u,left:n})=>{var i;const o=Gt[e.family]??Gt.unknown;return t.jsxs("div",{"data-testid":`available-${n?"input":"output"}-${e.family}`,children:[u===0&&t.jsx("span",{children:n?Sn:kn}),t.jsxs("span",{className:at(u>0?"mt-2 flex items-center":"mt-3 flex items-center"),children:[t.jsx("div",{className:"h-5 w-5",style:{color:G[e.family]},children:t.jsx(o,{className:"h-5 w-5",strokeWidth:1.5,style:{color:G[e.family]??G.unknown}})}),t.jsxs("span",{className:"ps-2 text-xs text-foreground","data-testid":`tooltip-${vu[e.family]??"Other"}`,children:[vu[e.family]??"Other"," ",e!=null&&e.display_name&&((i=e==null?void 0:e.display_name)==null?void 0:i.length)>0?t.jsxs("span",{className:"text-xs","data-testid":`tooltip-${e==null?void 0:e.display_name}`,children:[" ",e.display_name===""?"":" - ",e.display_name.split(", ").length>2?e.display_name.split(", ").map((a,d)=>t.jsx(O.Fragment,{children:t.jsx("span",{children:d===e.display_name.split(", ").length-1?a:a+=", "})},a+name)):e.display_name]}):t.jsxs("span",{className:"text-xs","data-testid":`tooltip-${e==null?void 0:e.type}`,children:[" ",e.type===""?"":" - ",e.type.split(", ").length>2?e.type.split(", ").map((a,d)=>t.jsx(O.Fragment,{children:t.jsx("span",{children:d===e.type.split(", ").length-1?a:a+=", "})},a+name)):e.type]})]})]},u)]},u)},jo=["str","SecretStr"];function wo({value:e}){return t.jsx(Iu,{className:"h-full w-full text-destructive custom-scroll",placeholder:"Empty",value:e,readOnly:!0})}function bo(e){var C,c;const u=e.nodeId,n=A(m=>m.nodes),o=A(m=>m.flowPool),i=n.find(m=>(m==null?void 0:m.id)===u),a=(o[u]??[])[(((C=o[u])==null?void 0:C.length)??1)-1],d=((c=a==null?void 0:a.data)==null?void 0:c.logs[0])??"",s=d==null?void 0:d.type;let h=d==null?void 0:d.message;const p=["record","object","array","message"];return h.raw&&(h=h.raw),t.jsxs(t.Fragment,{children:[t.jsx(Z,{condition:!s||s==="unknown",children:t.jsx("div",{children:"NO OUTPUT"})}),t.jsx(Z,{condition:s==="ValueError",children:t.jsx(wo,{value:h})}),t.jsx(Z,{condition:i&&s==="text",children:t.jsx(ss,{left:!1,value:h})}),t.jsx(Z,{condition:p.includes(s),children:t.jsx(os,{rows:Array.isArray(h)?h.every(m=>m.data)?h.map(m=>m.data):h:[h],pagination:!0,columnMode:"union"})}),t.jsx(Z,{condition:s==="stream",children:t.jsx("div",{className:"flex h-full w-full items-center justify-center align-middle",children:t.jsxs(_n,{variant:"default",className:"w-fit",children:[t.jsx(K,{name:"AlertCircle",className:"h-5 w-5 text-primary"}),t.jsx(Tn,{children:"Streaming is not supported"}),t.jsx(In,{children:"Use the playground to interact with components that stream data"})]})})})]})}function No({open:e,setOpen:u,nodeId:n}){return t.jsxs(fe,{open:e,setOpen:u,size:"medium-tall",children:[t.jsx(fe.Header,{description:"Inspect the output of the component below.",children:t.jsx("div",{className:"flex items-center",children:t.jsx("span",{className:"pr-2",children:"Component Output"})})}),t.jsx(fe.Content,{children:t.jsx(bo,{nodeId:n})}),t.jsx(fe.Footer,{children:t.jsx("div",{className:"flex w-full justify-end  pt-2",children:t.jsx(lt,{className:"flex gap-2 px-3",onClick:()=>u(!1),children:"Close"})})})]})}function _t({left:e,id:u,data:n,tooltipTitle:o,title:i,color:a,type:d,name:s="",required:h=!1,optionalHandle:p=null,info:C="",proxy:c,showNode:m,index:E="",selected:g}){var nt,ie,it,ct,dt,be,pt,ft,Ne,Je,st,ot,Ie,Oe,Xe,$e,Re,ce,Ze,rt,Ce,Be,Ee,r,v,z,de,Qe,Le,D,S,M,J,oe,xe,ge,Ae,ze,Pe,Me,He,Ue,Ve,Ke,Ge,We,qe,l,N,H,X,Ft,mt,ht,De,jt,wt,eu,tu,uu,nu,su,ou,ru,Du,lu,au,iu,cu,du,pu,fu,Fu,mu,hu,Cu;const j=f.useRef(null),x=f.useRef(null),F=f.useRef(null),w=ye(B=>B.currentFlow),b=A(B=>B.nodes),y=A(B=>B.edges),_=A(B=>B.setNode),T=St(B=>B.data),P=ye(B=>B.takeSnapshot),[I,k]=f.useState(!1),ue=Jt(),[Fe,Te]=f.useState(!1),re=((nt=w==null?void 0:w.data)==null?void 0:nt.nodes)??null,me=f.useRef(null),ve=A(B=>B.setFilterEdge),[$,se]=f.useState(!1),Q=A(B=>B.flowPool),ee=!!Q[n.id]&&((ie=Q[n.id][Q[n.id].length-1])==null?void 0:ie.valid),R=!!(Q[n.id]&&((dt=(ct=(it=Q[n.id][Q[n.id].length-1])==null?void 0:it.data)==null?void 0:ct.logs[0])==null?void 0:dt.type)==="unknown"),L=!0;function te(){!ee||R||bt()&&!$||g&&!e&&se(B=>!B)}const he=W(B=>B.output);q(he,te,{preventDefault:L});const{handleOnNewValue:ne}=xo(n,s,P,Ot,Co,_,we,k),{handleNodeClass:gt}=go(n,s,P,_,ue,we),{handleRefreshButtonPress:yt}=yo(k,_,we);let U=y.some(B=>B.targetHandle===ke(c?{...u,proxy:c}:u))??!1;const ut=async(B,le)=>{yt(B,le)};Eo(n,s,Ot,_,we,k);const Y=async(B,le=!1)=>{ne(B,le)},je=(B,le)=>{gt(B,le)};f.useEffect(()=>{F.current=t.jsx("div",{className:"h-full w-full break-words",children:C.split(`
`).map((B,le)=>t.jsx("p",{className:"block",children:B},le))})},[C]);function we(){let B=On(T,o,e,re);me.current=B,B&&B.length>0?x.current=B.map((le,Dt)=>t.jsx(vo,{index:Dt,item:le,left:e})):x.current=t.jsx("span",{"data-testid":"empty-tooltip-filter",children:$n})}return p&&p.length===0&&(p=null),f.useEffect(()=>{we()},[o,re]),m?t.jsx("div",{ref:j,className:"relative mt-1 flex w-full flex-wrap items-center justify-between bg-muted px-5 py-2"+(s==="code"&&d==="code"||s.includes("code")&&c?" hidden ":""),children:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex w-full items-center truncate text-sm"+(e?"":" justify-end"),children:[t.jsx(Z,{condition:!e&&((be=n.node)==null?void 0:be.frozen),children:t.jsx("div",{className:"pr-1",children:t.jsx(K,{className:"h-5 w-5 text-ice",name:"Snowflake"})})}),c?t.jsx(_e,{content:t.jsx("span",{children:c.id}),children:t.jsx("span",{className:!e&&((pt=n.node)!=null&&pt.frozen)?" text-ice":"",children:i})}):t.jsxs("div",{className:"flex gap-2",children:[t.jsx("span",{className:!e&&((ft=n.node)!=null&&ft.frozen)?" text-ice":"",children:i}),!e&&t.jsx(_e,{content:ee?R?"Output can't be displayed":"Inspect Output":"Please build the component first",children:t.jsx(lt,{variant:"none",size:"none",disabled:!ee||R,onClick:()=>se(!0),"data-testid":`output-inspection-${i.toLowerCase()}`,children:t.jsx(K,{className:at("h-5 w-5 rounded-md",ee&&!R?" hover:bg-secondary-foreground/5 hover:text-medium-indigo":" cursor-not-allowed text-muted-foreground"),name:"ScanEye"})})})]}),t.jsx("span",{className:(h?"ml-2 ":"")+"text-status-red",children:h?"*":""}),t.jsx("div",{className:"",children:C!==""&&t.jsx(_e,{content:F.current,children:t.jsx("div",{children:t.jsx(K,{name:"Info",className:"relative bottom-px ml-1.5 h-3 w-4"})})})})]}),e&&Vt.has(d??"")&&!p?t.jsx(t.Fragment,{}):t.jsx(lt,{className:"h-7 truncate bg-muted p-0 text-sm font-normal text-black hover:bg-muted",children:t.jsx("div",{className:"flex",children:t.jsx(_e,{styleClasses:"tooltip-fixed-width custom-scroll nowheel",delayDuration:1e3,content:x.current,side:e?"left":"right",children:t.jsx(ju,{"data-test-id":`handle-${i.toLowerCase()}-${e?"left":"right"}`,type:e?"target":"source",position:e?Ct.Left:Ct.Right,id:ke(c?{...u,proxy:c}:u),isValidConnection:B=>Wt(B,b,y),className:at(e?"-ml-0.5":"-mr-0.5","h-3 w-3 rounded-full border-2 bg-background"),style:{borderColor:a??G.unknown},onClick:()=>ve(me.current)},ke(c?{...u,proxy:c}:u))})})}),t.jsx(Z,{condition:e===!0&&jo.includes(d??"")&&!((Je=(Ne=n.node)==null?void 0:Ne.template[s])!=null&&Je.options),children:t.jsxs("div",{className:"w-full",children:[t.jsx(Z,{condition:(ot=(st=n.node)==null?void 0:st.template[s])==null?void 0:ot.list,children:t.jsx("div",{className:"flex-grow",children:t.jsx(Mu,{componentName:s,disabled:U,value:!((Ie=n.node.template[s])!=null&&Ie.value)||((Oe=n.node.template[s])==null?void 0:Oe.value)===""?[""]:(Xe=n.node.template[s])==null?void 0:Xe.value,onChange:Y})})}),t.jsx(Z,{condition:(Re=($e=n.node)==null?void 0:$e.template[s])==null?void 0:Re.multiline,children:t.jsxs("div",{className:"mt-2 flex w-full flex-col ",children:[t.jsx("div",{className:"flex-grow",children:t.jsx(Hu,{disabled:U,value:((ce=n.node.template[s])==null?void 0:ce.value)??"",onChange:Y,id:"textarea-"+((Ze=n.node.template[s])==null?void 0:Ze.name),"data-testid":"textarea-"+((rt=n.node.template[s])==null?void 0:rt.name)})}),((Be=(Ce=n.node)==null?void 0:Ce.template[s])==null?void 0:Be.refresh_button)&&t.jsx("div",{className:"flex-grow",children:t.jsx(Mt,{isLoading:I,disabled:U,name:s,data:n,button_text:(Ee=n.node)==null?void 0:Ee.template[s].refresh_button_text,className:"extra-side-bar-buttons mt-1",handleUpdateValues:ut,id:"refresh-button-"+s})})]})}),t.jsx(Z,{condition:!((v=(r=n.node)==null?void 0:r.template[s])!=null&&v.multiline)&&!((de=(z=n.node)==null?void 0:z.template[s])!=null&&de.list),children:t.jsxs("div",{className:"mt-2 flex w-full items-center",children:[t.jsx("div",{className:"flex-grow "+((Le=(Qe=n.node)==null?void 0:Qe.template[s])!=null&&Le.refresh_button?"w-5/6":""),children:t.jsx(rn,{disabled:U,onChange:Y,setDb:B=>{_(n.id,le=>{let Dt=V.cloneDeep(le);return Dt.data={...Dt.data},Dt.data.node.template[s].load_from_db=B,Dt})},name:s,data:(D=n.node)==null?void 0:D.template[s]})}),((M=(S=n.node)==null?void 0:S.template[s])==null?void 0:M.refresh_button)&&t.jsx("div",{className:"w-1/6",children:t.jsx(Mt,{isLoading:I,disabled:U,name:s,data:n,button_text:(J=n.node)==null?void 0:J.template[s].refresh_button_text,className:"extra-side-bar-buttons ml-2 mt-1",handleUpdateValues:ut,id:"refresh-button-"+s})})]})})]})}),t.jsx(Z,{condition:e===!0&&d==="bool",children:t.jsx("div",{className:"mt-2 w-full",children:t.jsx(Zt,{id:"toggle-"+s,disabled:U,enabled:((xe=(oe=n.node)==null?void 0:oe.template[s])==null?void 0:xe.value)??!1,setEnabled:Y,size:"large",editNode:!1})})}),t.jsx(Z,{condition:e===!0&&d==="float",children:t.jsx("div",{className:"mt-2 w-full",children:t.jsx(Lu,{disabled:U,value:((Ae=(ge=n.node)==null?void 0:ge.template[s])==null?void 0:Ae.value)??"",rangeSpec:(Pe=(ze=n.node)==null?void 0:ze.template[s])==null?void 0:Pe.rangeSpec,onChange:Y})})}),t.jsx(Z,{condition:e===!0&&d==="str"&&(((He=(Me=n.node)==null?void 0:Me.template[s])==null?void 0:He.options)||((Ve=(Ue=n.node)==null?void 0:Ue.template[s])==null?void 0:Ve.real_time_refresh)),children:t.jsxs("div",{className:"mt-2 flex w-full items-center gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(qu,{disabled:U,isLoading:I,options:(Ke=n.node.template[s])==null?void 0:Ke.options,onSelect:Y,value:(Ge=n.node.template[s])==null?void 0:Ge.value,id:"dropdown-"+s})}),((qe=(We=n.node)==null?void 0:We.template[s])==null?void 0:qe.refresh_button)&&t.jsx("div",{className:"w-1/6",children:t.jsx(Mt,{isLoading:I,disabled:U,name:s,data:n,button_text:(N=(l=n.node)==null?void 0:l.template[s])==null?void 0:N.refresh_button_text,handleUpdateValues:ut,id:"refresh-button-"+s})})]})}),t.jsx(Z,{condition:e===!0&&d==="code",children:t.jsx("div",{className:"mt-2 w-full",children:t.jsx(Xt,{readonly:!!((H=n.node)!=null&&H.flow&&((X=n.node.template[s])!=null&&X.dynamic)),dynamic:((mt=(Ft=n.node)==null?void 0:Ft.template[s])==null?void 0:mt.dynamic)??!1,setNodeClass:je,nodeClass:n.node,disabled:U,value:((De=(ht=n.node)==null?void 0:ht.template[s])==null?void 0:De.value)??"",onChange:Y,id:"code-input-"+s})})}),t.jsx(Z,{condition:e===!0&&d==="file",children:t.jsx("div",{className:"mt-2 w-full",children:t.jsx($u,{disabled:U,value:((wt=(jt=n.node)==null?void 0:jt.template[s])==null?void 0:wt.value)??"",onChange:Y,fileTypes:(tu=(eu=n.node)==null?void 0:eu.template[s])==null?void 0:tu.fileTypes,onFileChange:B=>{n.node.template[s].file_path=B}})})}),t.jsx(Z,{condition:e===!0&&d==="int",children:t.jsx("div",{className:"mt-2 w-full",children:t.jsx(Ru,{rangeSpec:(nu=(uu=n.node)==null?void 0:uu.template[s])==null?void 0:nu.rangeSpec,disabled:U,value:((ou=(su=n.node)==null?void 0:su.template[s])==null?void 0:ou.value)??"",onChange:Y,id:"int-input-"+s})})}),t.jsx(Z,{condition:e===!0&&d==="prompt",children:t.jsx("div",{className:"mt-2 w-full",children:t.jsx(Ou,{readonly:!!((ru=n.node)!=null&&ru.flow),field_name:s,setNodeClass:je,nodeClass:n.node,disabled:U,value:((lu=(Du=n.node)==null?void 0:Du.template[s])==null?void 0:lu.value)??"",onChange:Y,id:"prompt-input-"+s,"data-testid":"prompt-input-"+s})})}),t.jsx(Z,{condition:e===!0&&d==="NestedDict",children:t.jsx("div",{className:"mt-2 w-full",children:t.jsx(Pu,{disabled:U,editNode:!1,value:!((au=n.node.template[s])!=null&&au.value)||((cu=(iu=n.node.template[s])==null?void 0:iu.value)==null?void 0:cu.toString())==="{}"?{}:(du=n.node.template[s])==null?void 0:du.value,onChange:Y,id:"div-dict-input"})})}),t.jsx(Z,{condition:e===!0&&d==="dict",children:t.jsx("div",{className:"mt-2 w-full",children:t.jsx(zu,{disabled:U,editNode:!1,value:((fu=(pu=n.node.template[s])==null?void 0:pu.value)==null?void 0:fu.length)===0||!((Fu=n.node.template[s])!=null&&Fu.value)?[{"":""}]:Su((mu=n.node.template[s])==null?void 0:mu.value,d),duplicateKey:Fe,onChange:B=>{var Dt,Eu;const le=ku(B);Te(_u(le)),(Eu=(Dt=n.node)==null?void 0:Dt.template[s])!=null&&Eu.list?Y(le):Y(le[0])},isList:((Cu=(hu=n.node)==null?void 0:hu.template[s])==null?void 0:Cu.list)??!1})})}),$&&t.jsx(No,{open:$,nodeId:n.id,setOpen:se})]})}):e&&Vt.has(d??"")&&!p?t.jsx(t.Fragment,{}):t.jsx(lt,{className:"h-7 truncate bg-muted p-0 text-sm font-normal text-black hover:bg-muted",children:t.jsx("div",{className:"flex",children:t.jsx(_e,{styleClasses:"tooltip-fixed-width custom-scroll nowheel",delayDuration:1e3,content:x.current,side:e?"left":"right",children:t.jsx(ju,{"data-test-id":`handle-${i.toLowerCase()}-${e?"target":"source"}`,type:e?"target":"source",position:e?Ct.Left:Ct.Right,id:c?ke({...u,proxy:c}):ke(u),isValidConnection:B=>Wt(B,b,y),className:at(e?"my-12 -ml-0.5 ":" my-12 -mr-0.5 ","h-3 w-3 rounded-full border-2 bg-background",m?"":"mt-0"),style:{borderColor:a??G.unknown},onClick:()=>{ve(me.current)}},c?ke({...u,proxy:c}):ke(u))})})})}function Bo({data:e,selected:u}){var Ne,Je,st,ot,Ie,Oe,Xe,$e,Re,ce,Ze,rt,Ce,Be,Ee,r,v,z,de,Qe,Le;const o=St(D=>D.types),i=St(D=>D.templates),a=A(D=>D.deleteNode),d=A(D=>D.flowPool),s=A(D=>D.buildFlow),h=A(D=>D.setNode),p=Jt(),C=tt(D=>D.setErrorData),c=Rt(D=>D.dark),m=A(D=>{var S;return(S=D.flowBuildStatus[e.id])==null?void 0:S.status}),E=A(D=>{var S;return(S=D.flowBuildStatus[e.id])==null?void 0:S.timestamp}),g=ye(D=>D.takeSnapshot),[j,x]=f.useState(!1),[F,w]=f.useState(e.node.display_name),[b,y]=f.useState(!1),[_,T]=f.useState((Ne=e.node)==null?void 0:Ne.description),[P,I]=f.useState(!1),[k,ue]=f.useState(null),[Fe,Te]=f.useState(0),[re,me]=f.useState(""),ve=po(m,k),[$,se]=f.useState(e.showNode??!0),Q=A(D=>D.isBuilding),ee=fo(e==null?void 0:e.id,e.node,h,I,p),R=Gt[e.type]?e.type:o[e.type],L=D=>t.jsx("span",{className:"text-lg",children:D}),te=(D,S,M)=>t.jsx(K,{name:S,className:M,iconColor:D}),he=()=>ve,ne=(D,S,M,J)=>{const oe=ao(M,J,c),xe=gt(D),ge=yt(S);return at(xe,ge,"generic-node-div group/node",oe)},gt=D=>{var J;let S=D?"border border-ring hover:shadow-node":"border hover:shadow-node",M=D?"border-ring-frozen":"border-frozen";return(J=e.node)!=null&&J.frozen?M:S},yt=D=>D?"w-96 rounded-lg":"w-26 h-26 rounded-full",U=!0,ut=Zs().test((Je=e==null?void 0:e.node)==null?void 0:Je.icon);e.node.template||(C({title:`Error in component ${e.node.display_name}`,list:[`The component ${e.node.display_name} has no template.`,"Please contact the developer of the component to fix this issue."]}),g(),a(e.id)),io(e,i,I,o),mo(k,me),Fo(e==null?void 0:e.id,d,ue);const Y=co(e,o,G,R,$,ut,L,te);function je(){const D=lo(e);Te(D)}f.useEffect(()=>{je()},[e,e.node]),f.useEffect(()=>{u||(x(!1),y(!1))},[u]),f.useEffect(()=>{T(e.node.description)},[e.node.description]),f.useEffect(()=>{w(e.node.display_name)},[e.node.display_name]),f.useEffect(()=>{se(e.showNode??!0)},[e.showNode]);const[we,nt]=f.useState(!1),ie=()=>{var M;nt(!0),g();const D=(M=i[e.type])==null?void 0:M.template;if(!(D!=null&&D.code))return;const S=D.code.value;e.node&&Hn(S,e.node).then(J=>{const{data:oe}=J;oe&&ee&&(ee(oe,S,"code"),nt(!1))}).catch(J=>{console.log(J)})};function it(){P&&u&&ie()}function ct(){var D;m===et.BUILDING||Q||!u||(ue(null),console.log((D=e.node)==null?void 0:D.display_name),s({stopNodeId:e.id}))}const dt=W(D=>D.update),be=W(D=>D.play);q(dt,it,{preventDefault:!0}),q(be,ct,{preventDefault:!0});const pt=W(D=>D.shortcuts),ft=f.useMemo(()=>t.jsx(Xu,{children:t.jsx(Do,{data:e,deleteNode:D=>{g(),a(D)},setShowNode:D=>{h(e.id,S=>({...S,data:{...S.data,showNode:D}}))},setShowState:se,numberOfHandles:Fe,showNode:$,openAdvancedModal:!1,onCloseAdvancedModal:()=>{},selected:u,updateNode:ie})}),[e,a,g,h,se,Fe,$,ee,P,u,pt]);return t.jsxs(t.Fragment,{children:[ft,t.jsxs("div",{className:ne(u,$,m,k),children:[((st=e.node)==null?void 0:st.beta)&&$&&t.jsx("div",{className:"beta-badge-wrapper",children:t.jsx("div",{className:"beta-badge-content",children:"BETA"})}),t.jsx("div",{children:t.jsxs("div",{"data-testid":"div-generic-node",className:"generic-node-div-title "+($?" justify-between rounded-t-lg ":" relative h-24 w-24 rounded-full "),children:[t.jsxs("div",{className:"generic-node-title-arrangement rounded-full"+(!$&&" justify-center "),"data-testid":"generic-node-title-arrangement",children:[Y(),$&&t.jsx("div",{className:"generic-node-tooltip-div",children:j?t.jsx("div",{children:t.jsx(Tu,{onBlur:()=>{x(!1),F.trim()!==""?(w(F),h(e.id,D=>({...D,data:{...D.data,node:{...D.data.node,display_name:F}}}))):w(e.node.display_name)},value:F,onChange:w,password:!1,blurOnEnter:!0,id:`input-title-${(ot=e.node)==null?void 0:ot.display_name}`})}):t.jsxs("div",{className:"group flex items-center gap-1",children:[t.jsx(_e,{content:(Ie=e.node)==null?void 0:Ie.display_name,children:t.jsx("div",{onDoubleClick:D=>{x(!0),g(),D.stopPropagation(),D.preventDefault()},"data-testid":"title-"+((Oe=e.node)==null?void 0:Oe.display_name),className:"nodoubleclick generic-node-tooltip-div cursor-text text-primary",children:(Xe=e.node)==null?void 0:Xe.display_name})}),P&&t.jsx(_e,{content:Rn,children:t.jsx(lt,{onClick:ie,variant:"none",size:"none",className:"group p-1",loading:we,children:t.jsx(K,{name:"AlertTriangle",className:"h-5 w-5 fill-status-yellow text-muted"})})})]})})]}),t.jsx("div",{children:!$&&t.jsxs(t.Fragment,{children:[Object.keys(e.node.template).filter(D=>D.charAt(0)!=="_").map((D,S)=>{var M,J,oe,xe,ge,Ae,ze,Pe,Me,He,Ue,Ve,Ke,Ge,We,qe;return e.node.template[D].show&&!e.node.template[D].advanced&&t.jsx(_t,{selected:u,index:S.toString(),data:e,color:(M=e.node)!=null&&M.template[D].input_types&&((J=e.node)==null?void 0:J.template[D].input_types.length)>0?G[(xe=e.node)==null?void 0:xe.template[D].input_types[((oe=e.node)==null?void 0:oe.template[D].input_types.length)-1]]??G[o[(Ae=e.node)==null?void 0:Ae.template[D].input_types[((ge=e.node)==null?void 0:ge.template[D].input_types.length)-1]]]:G[(ze=e.node)==null?void 0:ze.template[D].type]??G[o[(Pe=e.node)==null?void 0:Pe.template[D].type]]??G.unknown,title:wu((Me=e.node)==null?void 0:Me.template,D),info:(He=e.node)==null?void 0:He.template[D].info,name:D,tooltipTitle:((Ve=(Ue=e.node)==null?void 0:Ue.template[D].input_types)==null?void 0:Ve.join(`
`))??((Ke=e.node)==null?void 0:Ke.template[D].type),required:e.node.template[D].required,id:{inputTypes:e.node.template[D].input_types,type:e.node.template[D].type,id:e.id,fieldName:D},left:!0,type:(Ge=e.node)==null?void 0:Ge.template[D].type,optionalHandle:(We=e.node)==null?void 0:We.template[D].input_types,proxy:(qe=e.node)==null?void 0:qe.template[D].proxy,showNode:$},ke({inputTypes:e.node.template[D].input_types,type:e.node.template[D].type,id:e.id,fieldName:D,proxy:e.node.template[D].proxy}))}),t.jsx(_t,{selected:u,data:e,color:G[o[e.type]]??G.unknown,title:($e=e.node)!=null&&$e.output_types&&e.node.output_types.length>0?e.node.output_types.join(" | "):e.type,tooltipTitle:(Re=e.node)==null?void 0:Re.base_classes.join(`
`),id:{baseClasses:e.node.base_classes,id:e.id,dataType:e.type},type:(ce=e.node)==null?void 0:ce.base_classes.join("|"),left:!1,showNode:$},ke({baseClasses:e.node.base_classes,id:e.id,dataType:e.type}))]})}),$&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2",children:[t.jsx(lt,{onClick:()=>{m===et.BUILDING||Q||(ue(null),s({stopNodeId:e.id}))},variant:"none",size:"none",className:"group p-1",children:t.jsx("div",{"data-testid":"button_run_"+((Ze=e==null?void 0:e.node)==null?void 0:Ze.display_name.toLowerCase()),children:t.jsx(K,{name:"Play",className:"h-5 w-5 fill-current stroke-2 text-muted-foreground transition-all group-hover:text-medium-indigo group-hover/node:opacity-100"})})}),t.jsx(_e,{content:m===et.BUILDING?t.jsxs("span",{children:[" ",Ln," "]}):k?t.jsxs("div",{className:"max-h-100 p-2",children:[t.jsx("div",{children:E&&t.jsxs("div",{className:"justify-left flex font-normal text-muted-foreground",children:[t.jsx("div",{children:Pn}),t.jsx("div",{className:"ml-1 text-status-blue",children:E})]})}),t.jsxs("div",{className:"justify-left flex font-normal text-muted-foreground",children:[t.jsx("div",{children:"Duration:"}),t.jsx("div",{className:"ml-1 text-status-blue",children:k==null?void 0:k.data.duration})]})]}):t.jsx("span",{className:"flex",children:zn}),side:"bottom",children:he()})]})})]})}),$&&t.jsxs("div",{className:$?((rt=e.node)==null?void 0:rt.description)===""&&!U?"pb-5":"py-5":"",children:[t.jsx("div",{className:"generic-node-desc",children:$&&U&&b?t.jsx(Iu,{className:"nowheel min-h-40",autoFocus:!0,onBlur:()=>{y(!1),x(!1),T(_),h(e.id,D=>({...D,data:{...D.data,node:{...D.data.node,description:_}}}))},value:_,onChange:D=>T(D.target.value),onKeyDown:D=>{Mn(D,_,""),D.key==="Enter"&&D.shiftKey===!1&&D.ctrlKey===!1&&D.altKey===!1&&(y(!1),T(_),h(e.id,S=>({...S,data:{...S.data,node:{...S.data.node,description:_}}})))}}):t.jsx("div",{className:ae("nodoubleclick generic-node-desc-text cursor-text word-break-break-word",(((Ce=e.node)==null?void 0:Ce.description)===""||!((Be=e.node)!=null&&Be.description))&&U?"font-light italic":""),onDoubleClick:D=>{y(!0),g()},children:(((Ee=e.node)==null?void 0:Ee.description)===""||!((r=e.node)!=null&&r.description))&&U?"Double Click to Edit Description":t.jsx(rs,{className:`markdown prose flex flex-col text-primary word-break-break-word
    dark:prose-invert`,children:String((v=e.node)==null?void 0:v.description)})})}),t.jsxs(t.Fragment,{children:[Object.keys(e.node.template).filter(D=>D.charAt(0)!=="_").sort((D,S)=>{var M;return ho(D,S,((M=e.node)==null?void 0:M.field_order)??[])}).map((D,S)=>{var M,J,oe,xe,ge,Ae,ze,Pe,Me,He,Ue,Ve,Ke,Ge,We,qe;return t.jsx("div",{children:e.node.template[D].show&&!e.node.template[D].advanced?t.jsx(_t,{selected:u,index:S.toString(),data:e,color:(M=e.node)!=null&&M.template[D].input_types&&((J=e.node)==null?void 0:J.template[D].input_types.length)>0?G[(xe=e.node)==null?void 0:xe.template[D].input_types[((oe=e.node)==null?void 0:oe.template[D].input_types.length)-1]]??G[o[(Ae=e.node)==null?void 0:Ae.template[D].input_types[((ge=e.node)==null?void 0:ge.template[D].input_types.length)-1]]]:G[(ze=e.node)==null?void 0:ze.template[D].type]??G[o[(Pe=e.node)==null?void 0:Pe.template[D].type]]??G.unknown,title:wu((Me=e.node)==null?void 0:Me.template,D),info:(He=e.node)==null?void 0:He.template[D].info,name:D,tooltipTitle:((Ve=(Ue=e.node)==null?void 0:Ue.template[D].input_types)==null?void 0:Ve.join(`
`))??((Ke=e.node)==null?void 0:Ke.template[D].type),required:e.node.template[D].required,id:{inputTypes:e.node.template[D].input_types,type:e.node.template[D].type,id:e.id,fieldName:D},left:!0,type:(Ge=e.node)==null?void 0:Ge.template[D].type,optionalHandle:(We=e.node)==null?void 0:We.template[D].input_types,proxy:(qe=e.node)==null?void 0:qe.template[D].proxy,showNode:$},ke({inputTypes:e.node.template[D].input_types,type:e.node.template[D].type,id:e.id,fieldName:D,proxy:e.node.template[D].proxy})):t.jsx(t.Fragment,{})},S)}),t.jsx("div",{className:at(Object.keys(e.node.template).length<1?"hidden":"","flex-max-width justify-center"),children:" "}),e.node.base_classes.length>0&&t.jsx(_t,{selected:u,data:e,color:((z=e.node)!=null&&z.output_types&&e.node.output_types.length>0?G[e.node.output_types[0]]??G[o[e.node.output_types[0]]]:G[o[e.type]])??G.unknown,title:(de=e.node)!=null&&de.output_types&&e.node.output_types.length>0?e.node.output_types.join(" | "):e.type,tooltipTitle:(Qe=e.node)==null?void 0:Qe.base_classes.join(`
`),id:{baseClasses:e.node.base_classes,id:e.id,dataType:e.type},type:(Le=e.node)==null?void 0:Le.base_classes.join("|"),left:!1,showNode:$},ke({baseClasses:e.node.base_classes,id:e.id,dataType:e.type}))]})]})]})]})}const Ao=({fromX:e,fromY:u,toX:n,toY:o,connectionLineStyle:i={}})=>t.jsxs("g",{children:[t.jsx("path",{fill:"none",strokeWidth:1.5,className:"animated stroke-connection ",d:`M${e},${u} C ${e} ${o} ${e} ${o} ${n},${o}`,style:i}),t.jsx("circle",{cx:n,cy:o,fill:"#fff",r:3,stroke:"#222",className:"",strokeWidth:1.5})]}),So=Ao;function ko({onClick:e,nodes:u,isVisible:n,lastSelection:o}){const i=A(E=>E.edges),[a,d]=f.useState(o&&i.length>0?Tt(o,i).length>0:!1),[s,h]=f.useState(!1),[p,C]=f.useState(!1),[c,m]=f.useState(u);return f.useEffect(()=>{if(s)return d(Tt(o,i).length>0);d(!1)},[s,h]),f.useEffect(()=>{m(u)},[s]),f.useEffect(()=>{n?(h(!0),setTimeout(()=>{C(!0)},50)):(C(!1),setTimeout(()=>{h(!1)},500))},[n]),t.jsx(Xu,{isVisible:s,offset:5,nodeId:c&&c.length>0?c.map(E=>E.id):[],children:t.jsx("div",{className:"h-10 w-28 overflow-hidden",children:t.jsx("div",{className:"duration-400 h-10 w-24 rounded-md border border-indigo-300 bg-background px-2.5 text-primary shadow-inner transition-all ease-in-out"+(p?" opacity-100":" opacity-0 "),children:t.jsxs("button",{className:`${a?"flex h-full w-full cursor-not-allowed items-center justify-between text-sm text-muted-foreground":"flex h-full w-full items-center justify-between text-sm"}`,onClick:e,disabled:a,children:[t.jsx(Un,{strokeWidth:1.5,size:22,className:"text-primary",disabled:a}),"Group"]})})})})}function Dn(e=0,u=!1,n=3){const o=Kn,i=Gn,a=bu(o),d=bu(i);if(a==="boring"&&d==="wozniak"){if(e<n)return Dn(e+1,u,n);console.warn("Max retries reached, returning as is")}if(e>0&&u){const h=Math.floor(Math.random()*10);return`${a}_${d}${h}`}let s=u?`${a}_${d}`:`${a} ${d}`;return Vn(s)}const vt=(e,u)=>e.target.closest(`.${u}`),_o={genericNode:Bo};function Go({flow:e,view:u}){const o=ye(r=>r.uploadFlow),i=ye(r=>r.autoSaveCurrentFlow),a=St(r=>r.types),d=St(r=>r.templates),s=A(r=>r.setFilterEdge),h=f.useRef(null),[p,C]=f.useState(Object.keys(d).length>0&&Object.keys(a).length>0),c=A(r=>r.reactFlowInstance),m=A(r=>r.setReactFlowInstance),E=A(r=>r.nodes),g=A(r=>r.edges),j=A(r=>r.onNodesChange),x=A(r=>r.onEdgesChange),F=A(r=>r.setNodes),w=A(r=>r.setEdges),b=A(r=>r.cleanFlow),y=A(r=>r.deleteNode),_=A(r=>r.deleteEdge),T=ye(r=>r.undo),P=ye(r=>r.redo),I=ye(r=>r.takeSnapshot),k=A(r=>r.paste),ue=A(r=>r.resetFlow),Fe=A(r=>r.lastCopiedSelection),Te=A(r=>r.setLastCopiedSelection),re=A(r=>r.onConnect),me=ye(r=>r.currentFlowId),ve=tt(r=>r.setErrorData),[$,se]=f.useState(!1),Q=f.useRef(!0),ee=f.useRef({x:0,y:0}),[R,L]=f.useState(null);function te(){if(I(),Tt(R,g).length===0){const r=V.cloneDeep(E),v=V.cloneDeep(g),z=V.cloneDeep(R);Zn({nodes:r,edges:v},z);const{newFlow:de,removedEdges:Qe}=Qn(z,r,v,Dn()),Le=es(de,Lt),D=ts(Le,Qe);F([...r.filter(S=>!(z!=null&&z.nodes.some(M=>M.id===S.id))),Le]),w([...v.filter(S=>!z.nodes.some(M=>M.id===S.target||M.id===S.source)),...D])}else ve({title:us,list:Tt(R,g)})}A(r=>r.setNode),f.useEffect(()=>{const r=v=>{ee.current={x:v.clientX,y:v.clientY}};return document.addEventListener("mousemove",r),()=>{document.removeEventListener("mousemove",r)}},[Fe,R,I,$]),f.useEffect(()=>{var r,v,z;c&&me&&ue({nodes:((r=e==null?void 0:e.data)==null?void 0:r.nodes)??[],edges:((v=e==null?void 0:e.data)==null?void 0:v.edges)??[],viewport:((z=e==null?void 0:e.data)==null?void 0:z.viewport)??{zoom:1,x:0,y:0}})},[me,c]),f.useEffect(()=>()=>{b()},[]);function he(r){r.preventDefault(),r.stopImmediatePropagation(),vt(r,"noundo")||T()}function ne(r){r.preventDefault(),r.stopImmediatePropagation(),vt(r,"noundo")||P()}function gt(r){r.preventDefault(),r.stopImmediatePropagation(),$&&te()}function yt(r){r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation();const v=E.filter(z=>z.selected);v.length>0&&k({nodes:v,edges:[]},{x:ee.current.x,y:ee.current.y})}function U(r){var v;r.preventDefault(),r.stopImmediatePropagation(),!vt(r,"nocopy")&&((v=window.getSelection())==null?void 0:v.toString().length)===0&&R&&Te(Kt.cloneDeep(R))}function ut(r){var v;r.preventDefault(),r.stopImmediatePropagation(),!vt(r,"nocopy")&&((v=window.getSelection())==null?void 0:v.toString().length)===0&&R&&Te(Kt.cloneDeep(R),!0)}function Y(r){var v;r.preventDefault(),r.stopImmediatePropagation(),!vt(r,"nocopy")&&((v=window.getSelection())==null?void 0:v.toString().length)===0&&Fe&&(I(),k(Fe,{x:ee.current.x,y:ee.current.y}))}function je(r){r.preventDefault(),r.stopImmediatePropagation(),!vt(r,"nodelete")&&R&&(I(),y(R.nodes.map(v=>v.id)),_(R.edges.map(v=>v.id)))}const we=W(r=>r.undo),nt=W(r=>r.redo),ie=W(r=>r.copy),it=W(r=>r.duplicate),ct=W(r=>r.delete),dt=W(r=>r.group),be=W(r=>r.cut),pt=W(r=>r.paste);q(we,he,{preventDefault:!0}),q(nt,ne,{preventDefault:!0}),q(dt,gt,{preventDefault:!0}),q(it,yt,{preventDefault:!0}),q(ie,U,{preventDefault:!0}),q(be,ut,{preventDefault:!0}),q(pt,Y,{preventDefault:!0}),q(ct,je,{preventDefault:!0}),q("delete",je,{preventDefault:!0}),f.useEffect(()=>{C(Object.keys(d).length>0&&Object.keys(a).length>0)},[d,a]);const ft=f.useCallback(r=>{I(),re(r)},[I,re]),Ne=f.useCallback(()=>{I()},[I]),Je=f.useCallback(()=>{i(E,g,c==null?void 0:c.getViewport())},[I,i,E,g,c]),st=f.useCallback(()=>{i(E,g,c==null?void 0:c.getViewport())},[I,i,E,g,c]),ot=f.useCallback(()=>{I()},[I]),Ie=f.useCallback(r=>{r.preventDefault(),r.dataTransfer.types.some(v=>v==="nodedata")?r.dataTransfer.dropEffect="move":r.dataTransfer.dropEffect="copy"},[]),Oe=f.useCallback(r=>{if(r.preventDefault(),r.dataTransfer.types.some(v=>v==="nodedata")){I();const v=JSON.parse(r.dataTransfer.getData("nodedata")),z=Lt(v.type),de={id:z,type:"genericNode",position:{x:0,y:0},data:{...v,id:z}};k({nodes:[de],edges:[]},{x:r.clientX,y:r.clientY})}else if(r.dataTransfer.types.some(v=>v==="Files"))if(I(),r.dataTransfer.files.item(0).type==="application/json"){const v={x:r.clientX,y:r.clientY};o({newProject:!1,isComponent:!1,file:r.dataTransfer.files.item(0),position:v}).catch(z=>{ve({title:Wn,list:[z]})})}else ve({title:qn,list:[Yn]})},[Lt,F,I,k]),Xe=f.useCallback(()=>{Q.current=!1},[]),$e=f.useCallback((r,v)=>{Wt(v,E,g)&&(Q.current=!0,r.data.targetHandle=Nu(v.targetHandle),r.data.sourceHandle=Nu(v.sourceHandle),w(z=>Jn(r,v,z)))},[w]),Re=f.useCallback((r,v)=>{Q.current||w(z=>z.filter(de=>de.id!==v.id)),Q.current=!0},[]),[ce,Ze]=f.useState(!0),rt=f.useCallback(()=>{Ze(!0)},[]),Ce=f.useCallback(r=>{r.preventDefault(),Ze(!1)},[]);f.useEffect(()=>{ce&&R&&R.nodes.length>1?se(!0):se(!1)},[ce,R]);const Be=f.useCallback(r=>{L(r)},[]),Ee=f.useCallback(r=>{s([])},[]);return t.jsx("div",{className:"h-full w-full",ref:h,children:p?t.jsx("div",{id:"react-flow-id",className:"h-full w-full",children:t.jsxs(Xn,{nodes:E,edges:g,onNodesChange:j,onEdgesChange:x,onConnect:ft,disableKeyboardA11y:!0,onInit:m,nodeTypes:_o,onEdgeUpdate:$e,onEdgeUpdateStart:Xe,onEdgeUpdateEnd:Re,onNodeDragStart:Ne,onNodeDragStop:Je,onSelectionDragStart:ot,onSelectionEnd:rt,onSelectionStart:Ce,connectionLineComponent:So,onDragOver:Ie,onMoveEnd:st,onDrop:Oe,onSelectionChange:Be,deleteKeyCode:[],className:"theme-attribution",minZoom:.01,maxZoom:8,zoomOnScroll:!u,zoomOnPinch:!u,panOnDrag:!u,panActivationKeyCode:"",proOptions:{hideAttribution:!0},onPaneClick:Ee,children:[t.jsx(Ss,{className:""}),!u&&t.jsx(js,{className:`fill-foreground stroke-foreground text-primary [&>button]:border-b-border
                   [&>button]:bg-muted hover:[&>button]:bg-border`}),t.jsx(ko,{lastSelection:R,isVisible:$,nodes:R==null?void 0:R.nodes,onClick:()=>{te()}})]})}):t.jsx(t.Fragment,{})})}export{Go as P,Xs as S,Qs as a,sn as b,on as c,pe as d,q as u};
