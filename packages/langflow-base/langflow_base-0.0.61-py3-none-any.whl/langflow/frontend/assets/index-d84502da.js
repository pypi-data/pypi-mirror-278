import{r as x,j as e,J as _,I as D,au as M,u as N,av as C,aw as de,ax as me,ay as pe,h as g,y as z,f as k,t as ue,ah as fe,at as he,az as xe,aA as ge}from"./index-86768d23.js";import{u as q,a as je,F as we}from"./form-9391738a.js";import{C as ve,S as Q,I as Ce}from"./index-f9720a8a.js";import{P as Fe}from"./index-f53f071d.js";import{D as Se}from"./index-99b92aac.js";import{N as ye}from"./index-1f95f576.js";import{C as De,S as P}from"./index-6451e54f.js";import"./textarea-04e722a8.js";import"./index-e833f93c.js";import"./tabs-4a607088.js";import"./index-b796a12f.js";import"./input-13e7a0de.js";import"./table-691b62af.js";import"./index-b7b8f00f.js";import"./index-7b70fec0.js";import"./popover-270ec558.js";import"./index-9a10118c.js";function Ne({onFileDrop:n,children:i,dragMessage:d}){const[u,a]=x.useState(!1);x.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&a(!1)};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}},[]);const o=s=>{s.preventDefault(),s.dataTransfer.types.some(p=>p==="Files")&&n&&a(!0)},c=s=>{s.dataTransfer.types.some(p=>p==="Files")&&n&&a(!0),s.preventDefault()},l=s=>{s.preventDefault(),n&&a(!1)},m=s=>{s.preventDefault(),n&&n(s),a(!1)};return e.jsx("div",{onDragOver:o,onDragEnter:c,onDragLeave:l,onDrop:m,className:_("h-full w-full",u?"mb-36 flex flex-col items-center justify-center gap-4 text-2xl font-light":""),children:u?e.jsxs(e.Fragment,{children:[e.jsx(D,{name:"ArrowUpToLine",className:"h-12 w-12 stroke-1"}),d||"Drop your file here"]}):i})}const be=(n,i)=>{var s;const d=M(),u=N(p=>p.setSuccessData),a=N(p=>p.setErrorData),o=C(p=>p.getFolderById),c=(s=d==null?void 0:d.state)==null?void 0:s.folderId,l=C(p=>p.myCollectionId);return[p=>{if(p.preventDefault(),p.dataTransfer.types.some(v=>v==="Files")){const v=p.dataTransfer.files.item(0);if(v.type==="application/json"){const F=new FileReader;F.onload=f=>{const A=f.target.result,E=JSON.parse(A).is_component;n({newProject:!0,file:v,isComponent:i==="all"?null:i==="component"}).then(()=>{u({title:`${E?"Component":"Flow"} uploaded successfully`}),o(c||l)}).catch(I=>{a({title:de,list:[I]})})},F.readAsText(v)}else a({title:me,list:[pe]})}}]},Ee=n=>{switch(n){case"all":return"Component or Flow";case"component":return"Component";default:return"Flow"}},Ie=(n,i)=>{const d=i==="component",u=(o,c)=>{const l=(o==null?void 0:o.updated_at)||(o==null?void 0:o.date_created),m=(c==null?void 0:c.updated_at)||(c==null?void 0:c.date_created);return l&&m?new Date(m).getTime()-new Date(l).getTime():l?1:m?-1:0},a=i==="all"?n:n==null?void 0:n.filter(o=>((o==null?void 0:o.is_component)??!1)===d);return(a==null?void 0:a.sort(u))??[]},Le=({})=>{g(d=>d.addFlow),z();const[n,i]=x.useState(!1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-2 flex w-full items-center justify-center text-center",children:e.jsx("div",{className:"flex-max-width h-full flex-col",children:e.jsxs("div",{className:"align-center flex w-full justify-center gap-1 ",children:[e.jsx("span",{className:"text-muted-foreground",children:"This folder is empty. New?"}),e.jsxs("span",{className:"transition-colors hover:text-muted-foreground",children:[e.jsx(ye,{open:n,setOpen:i}),e.jsx("button",{onClick:()=>{i(!0)},className:"underline",children:"Start Here"})]}),e.jsx("span",{className:"animate-pulse",children:"ðŸš€"})]})})})})},_e=({handleSelectAll:n,handleDelete:i,handleDuplicate:d,handleExport:u,disableFunctions:a})=>{const[o,c]=x.useState(!0),l=()=>{n(o),c(m=>!m)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center justify-self-start",children:e.jsx("a",{onClick:l,className:"cursor-pointer text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{checked:!o,id:"terms"}),e.jsx("span",{className:"label text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:o?"Select All":"Unselect All"})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(P,{content:a?e.jsx("span",{children:"Select items to export"}):e.jsx("span",{children:"Export selected items"}),children:e.jsx(k,{variant:"none",size:"none",onClick:u,disabled:a,children:e.jsx(D,{name:"FileDown",className:_("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(P,{content:a?e.jsx("span",{children:"Select items to duplicate"}):e.jsx("span",{children:"Duplicate selected items"}),children:e.jsx(k,{variant:"none",size:"none",onClick:d,disabled:a,children:e.jsx(D,{name:"Copy",className:_("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(P,{content:a?e.jsx("span",{children:"Select items to delete"}):e.jsx("span",{children:"Delete selected items"}),children:e.jsx(k,{variant:"none",size:"none",onClick:i,disabled:a,children:e.jsx(D,{name:"Trash2",className:_("h-5 w-5 text-primary transition-all",a?"":"hover:text-destructive")})})})})]})]})})};function ke({type:n="all"}){var K;const i=g(t=>t.uploadFlow),d=g(t=>t.removeFlow),u=g(t=>t.isLoading),a=g(t=>t.setAllFlows),o=g(t=>t.allFlows),c=C(t=>{var r;return(r=t.selectedFolder)==null?void 0:r.flows}),l=N(t=>t.setSuccessData),m=N(t=>t.setErrorData),[s,p]=x.useState(!1),v=g(t=>t.searchFlowsComponents),F=g(t=>t.setSelectedFlowsComponentsCards),f=g(t=>t.selectedFlowsComponentsCards),[A]=be(i,n),[b,E]=x.useState(20),[I,B]=x.useState(1),X=z(),L=M(),T=Ie(o,n),U=(I-1)*b,Y=U+b,j=T==null?void 0:T.slice(U,Y),Z=Ee(n),w=(K=L==null?void 0:L.state)==null?void 0:K.folderId,O=C(t=>t.getFolderById),S=C(t=>t.myCollectionId),V=C(t=>t.getFoldersApi),ee=C(t=>t.setFolderUrl),te=g(t=>t.addFlow);x.useEffect(()=>{ee(w??""),F([]),G(!1),O(w||S)},[L]),x.useEffect(()=>{const t=ue.cloneDeep(c),r=t==null?void 0:t.filter(h=>h.name.toLowerCase().includes(v.toLowerCase())||h.description.toLowerCase().includes(v.toLowerCase()));v===""&&a(c),a(r)},[v]);const J=()=>{B(1),E(20)},{getValues:H,control:W,setValue:$}=q(),y=je({control:W}),se=q(),G=t=>{const r=c==null?void 0:c.map(h=>h.id);if(t){Object.keys(H()).forEach(h=>{r!=null&&r.includes(h)&&$(h,!0)});return}Object.keys(H()).forEach(h=>{$(h,!1)})},R=t=>{if(!((f==null?void 0:f.length)>0)){m({title:"No items selected",list:["Please select items to delete"]});return}t==="delete"?p(!0):t==="duplicate"?ne():t==="export"&&le()},ne=()=>{Promise.all(f.map(t=>te(!0,o.find(r=>r.id===t)))).then(()=>{J(),V(!0),(!w||w===S)&&O(w||S),F([]),l({title:"Flows duplicated successfully"})})},oe=fe(t=>t.version),le=()=>{f.map(t=>{const r=o.find(h=>h.id===t);xe(ge({id:r.id,data:r.data,description:r.description,name:r.name,last_tested_version:oe,is_component:!1}),r.name,r.description)}),l({title:"Flows exported successfully"})},ae=()=>{d(f).then(()=>{J(),V(!0),(!w||w===S)&&O(w||S),l({title:"Selected items deleted successfully"})}).catch(()=>{m({title:"Error deleting items",list:["Please try again"]})})};x.useEffect(()=>{if(!y||Object.keys(y).length===0)return;const t=Object.keys(y).filter(r=>y[r]===!0);F(t)},[y]);const re=x.useMemo(()=>{const t=h=>({all:"item",component:"component",flow:"flow"})[h]||"",r=h=>({all:"items",component:"components",flow:"flows"})[h]||"";return(f==null?void 0:f.length)===1?t(n):r(n)},[f,n]),ce=()=>{var t;return n==="all"?o==null?void 0:o.length:(t=o==null?void 0:o.filter(r=>(r.is_component??!1)===(n==="component")))==null?void 0:t.length};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full gap-4 pb-5",children:(o==null?void 0:o.length)>0&&e.jsx(_e,{handleDelete:()=>R("delete"),handleSelectAll:G,handleDuplicate:()=>R("duplicate"),handleExport:()=>R("export"),disableFunctions:!((f==null?void 0:f.length)>0)})}),e.jsx(Ne,{onFileDrop:A,dragMessage:`Drag your ${Z} here`,children:e.jsxs("div",{className:"flex h-full w-full flex-col justify-between",children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:!u&&(j==null?void 0:j.length)===0?e.jsx(Le,{}):e.jsx("div",{className:"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-2",children:u===!1&&(j==null?void 0:j.length)>0?e.jsx(e.Fragment,{children:j==null?void 0:j.map(t=>x.createElement(we,{...se,key:t.id},e.jsx("form",{children:e.jsx(ve,{is_component:n==="component",data:{is_component:t.is_component??!1,...t},disabled:u,"data-testid":"edit-flow-button-"+t.id,button:t.is_component?e.jsx(e.Fragment,{}):e.jsx(he,{to:"/flow/"+t.id,children:e.jsxs(k,{tabIndex:-1,variant:"outline",size:"sm",className:"whitespace-nowrap","data-testid":"edit-flow-button-"+t.id,children:[e.jsx(D,{name:"ExternalLink",className:"main-page-nav-button select-none"}),"Edit Flow"]})}),onClick:t.is_component?void 0:()=>{X("/flow/"+t.id)},playground:!t.is_component,control:W})})))}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsx(Q,{})]})})}),!u&&(j==null?void 0:j.length)>0&&e.jsx("div",{className:"relative py-6",children:e.jsx(Fe,{storeComponent:!0,pageIndex:I,pageSize:b,rowsCount:[10,20,50,100],totalRowsCount:ce(),paginate:(t,r)=>{B(r),E(t)}})})]})}),s&&e.jsx(Se,{open:s,setOpen:p,onConfirm:ae,description:re,children:e.jsx(e.Fragment,{})})]})}const Ae=({tabsOptions:n,setActiveTab:i,loading:d,tabActive:u})=>{const a=z(),o=C(l=>l.folderUrl),c=l=>{const m=window.location.pathname;let s="";switch(l){case"Flows":s=m.replace(/components|all/,"flows");break;case"Components":s=m.replace(/flows|all/,"components");break;default:s=m.replace(/flows|components/,"all");break}a(s,{state:{folderId:o}})};return x.useEffect(()=>{const l=window.location.pathname;l.includes("components")?i("Components"):l.includes("flows")?i("Flows"):i("All")},[window.location.pathname]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-4 flex w-full gap-2 border-b border-border",children:n.map((l,m)=>e.jsx("button",{"data-testid":`${l}-button-store`,disabled:d,onClick:()=>{c(l)},className:(u===l?"border-b-2 border-primary p-3":" border-b-2 border-transparent p-3 text-muted-foreground hover:text-primary")+(d?" cursor-not-allowed ":""),children:l},m))})})},Te=({})=>{var m;const n=M(),i=C(s=>s.myCollectionId);(m=n==null?void 0:n.state)!=null&&m.folderId;const d=g(s=>s.isLoading),[u,a]=x.useState("Flows");N(s=>s.setErrorData),g(s=>s.allFlows);const[o,c]=x.useState(""),l=g(s=>s.setSearchFlowsComponents);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex items-end gap-4",children:[e.jsx(Ce,{loading:d,value:o,onChange:s=>{l(s.target.value),c(s.target.value)},onKeyDown:s=>{s.key==="Enter"&&l(o)}}),e.jsx(Ae,{tabsOptions:["All","Flows","Components"],setActiveTab:a,loading:d,tabActive:u})]})})},Ye=({type:n})=>e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx("div",{className:"mt-5 flex h-full flex-col",children:e.jsx(ke,{type:n},n)})]});export{Ye as default};
