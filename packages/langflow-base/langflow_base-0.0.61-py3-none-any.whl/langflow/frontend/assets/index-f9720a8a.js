import{j as s,aI as ne,J as m,b4 as te,aL as oe,I as r,h as d,u as X,ae as he,ad as M,r as a,aK as pe,b5 as fe,f as v,bq as Y,aN as Z,aO as z,br as we,bs as ge,bt as je}from"./index-86768d23.js";import{I as be}from"./index-e833f93c.js";import{D as ee}from"./index-99b92aac.js";import{S as u,C as ve}from"./index-6451e54f.js";import{c as Ne,e as ke}from"./form-9391738a.js";import{I as ye}from"./input-13e7a0de.js";function Ce({data:e}){return s.jsx(s.Fragment,{children:s.jsx(ne,{draggable:!0,className:m("group relative flex flex-col justify-between overflow-hidden transition-all hover:bg-muted/50 hover:shadow-md hover:dark:bg-[#ffffff10]"),children:s.jsx("div",{children:s.jsx(te,{children:s.jsx("div",{children:s.jsxs(oe,{className:"flex w-full items-start justify-between gap-3 text-xl",children:[s.jsx(r,{className:m("visible flex-shrink-0",e.is_component?"mx-0.5 h-6 w-6 text-component-icon":"h-7 w-7 flex-shrink-0 text-flow-icon"),name:e.is_component?"ToyBrick":"Group"}),s.jsx("div",{className:"w-full truncate pr-3",children:e.name})]})})})})})})}function se(e){return e.replace(/ /g,"-").toLowerCase()}function Ee({data:e,authorized:l=!0,disabled:L=!1,button:q,onClick:N,onDelete:h,playground:p,control:x,is_component:$}){var U;const D=d(n=>n.addFlow),E=X(n=>n.setSuccessData),i=X(n=>n.setErrorData),le=he(n=>n.updateValidApiKey),re=M(n=>n.CleanFlowPool),[g,k]=a.useState(!1),[ie,T]=a.useState(!1),[y,C]=a.useState((e==null?void 0:e.liked_by_user)??!1),[H,j]=a.useState((e==null?void 0:e.liked_by_count)??0),[K,O]=a.useState((e==null?void 0:e.downloads_count)??0),f=d(n=>n.currentFlow),V=d(n=>n.setCurrentFlow),B=d(n=>n.getFlowById),ce=d(n=>n.currentFlowId),G=M(n=>n.setNodes),J=M(n=>n.setEdges),[_,b]=a.useState(!1),[R,ae]=a.useState(!1),W=d(n=>n.setCurrentFlowId),[S,c]=a.useState(!1),A=d(n=>n.selectedFlowsComponentsCards),F=e.is_component?"Component":"Flow";async function Q(){const n=await Z(e.id);return z(n,n.id,e.is_component,!0)}function I(n){var w;if(!n)return!1;const{inputs:o,outputs:t}=we(((w=n==null?void 0:n.data)==null?void 0:w.nodes)??[]);return o.length>0||t.length>0}a.useEffect(()=>{var n,o;ce&&p&&(_?(G(((n=f==null?void 0:f.data)==null?void 0:n.nodes)??[],!0),J(((o=f==null?void 0:f.data)==null?void 0:o.edges)??[],!0)):(G([],!0),J([],!0)),re())},[_]),a.useEffect(()=>{e&&(C((e==null?void 0:e.liked_by_user)??!1),j((e==null?void 0:e.liked_by_count)??0),O((e==null?void 0:e.downloads_count)??0))},[e,e.liked_by_count,e.liked_by_user,e.downloads_count]);function de(){const n=K;O(o=>Number(o)+1),k(!0),Z(e.id).then(o=>{const t=z(o,o.id,e.is_component);D(!0,t).then(w=>{E({title:`${F} Installed Successfully.`}),k(!1)}).catch(w=>{k(!1),i({title:`Error installing the ${F}`,list:[w.response.data.detail]})})}).catch(o=>{k(!1),i({title:`Error installing the ${F}`,list:[o.response.data.detail]}),O(n)})}function me(){if(T(!0),y!==void 0||y!==null){const n=y,o=H;C(t=>!t),j(n?t=>Number(t)-1:t=>Number(t)+1),ge(e.id).then(t=>{T(!1),j(t.data.likes_count),C(t.data.liked_by_user)}).catch(t=>{T(!1),j(o),C(n),t.response.status===403?le(!1):(console.error(t),i({title:`Error liking ${F}.`,list:[t.response.data.detail]}))})}}const ue=(A==null?void 0:A.includes(e==null?void 0:e.id))??!1;function xe(n){let o=s.jsx(Ce,{data:e});var t=document.createElement("div");t.style.transform="translate(-10000px, -10000px)",t.style.position="absolute",document.body.appendChild(t),n.dataTransfer.setDragImage(t,0,0),je(t).render(o),B(e.id)&&n.dataTransfer.setData("flow",JSON.stringify(e))}return s.jsxs(s.Fragment,{children:[s.jsxs(ne,{onDragStart:xe,draggable:!0,"data-testid":`card-${se(e.name)}`,className:m("group relative flex min-h-[11rem] flex-col justify-between overflow-hidden transition-all hover:bg-muted/50 hover:shadow-md hover:dark:bg-[#ffffff10]",L?"pointer-events-none opacity-50":"",N?"cursor-pointer":"",ue?"border border-selected":""),onClick:N,children:[s.jsx("div",{children:s.jsxs(te,{children:[s.jsx("div",{children:s.jsxs(oe,{className:"flex w-full items-start justify-between gap-3 text-xl",children:[s.jsx(r,{className:m("visible flex-shrink-0",e.is_component?"mx-0.5 h-6 w-6 text-component-icon":"h-7 w-7 flex-shrink-0 text-flow-icon"),name:e.is_component?"ToyBrick":"Group"}),s.jsx(u,{content:e.name,children:s.jsx("div",{className:"w-full truncate pr-3",children:e.name})}),(e==null?void 0:e.metadata)!==void 0&&s.jsxs("div",{className:"flex items-center gap-3",children:[e.private&&s.jsx(u,{content:"Private",children:s.jsx("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:s.jsx(r,{name:"Lock",className:"h-4 w-4"})})}),!e.is_component&&s.jsx(u,{content:"Components",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(r,{name:"ToyBrick",className:"h-4 w-4"}),s.jsx("span",{"data-testid":`total-${e.name}`,children:((U=e==null?void 0:e.metadata)==null?void 0:U.total)??0})]})}),s.jsx(u,{content:"Likes",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(r,{name:"Heart",className:m("h-4 w-4 ")}),s.jsx("span",{"data-testid":`likes-${e.name}`,children:H??0})]})}),s.jsx(u,{content:"Downloads",children:s.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.jsx(r,{name:"DownloadCloud",className:"h-4 w-4"}),s.jsx("span",{"data-testid":`downloads-${e.name}`,children:K??0})]})})]}),x&&s.jsx("div",{className:"flex",onClick:n=>{n.stopPropagation()},children:s.jsx(Ne,{control:x,name:`${e.id}`,defaultValue:!1,render:({field:n})=>s.jsx(ke,{children:s.jsx(ve,{"aria-label":"checkbox-component",checked:n.value,onCheckedChange:n.onChange,className:"h-5 w-5 border border-ring data-[state=checked]:border-selected data-[state=checked]:bg-selected"})})})})]})}),s.jsxs("div",{className:"flex gap-2",children:[e.user_created&&e.user_created.username&&s.jsxs("span",{className:"text-sm text-primary",children:["by ",s.jsx("b",{children:e.user_created.username}),e.last_tested_version&&s.jsxs(s.Fragment,{children:[" ","|"," ",s.jsxs("span",{className:"text-xs",children:[" ","⛓︎ v",e.last_tested_version]})]})]}),s.jsx("div",{className:"flex w-full flex-1 flex-wrap gap-2"})]}),s.jsx(pe,{className:"pb-2 pt-2",children:s.jsx("div",{className:"truncate-doubleline",children:e.description})})]})}),s.jsx(fe,{children:s.jsx("div",{className:"z-50 flex w-full items-center justify-between gap-2",children:s.jsxs("div",{className:"flex w-full flex-wrap items-end justify-end gap-2",children:[p&&(e==null?void 0:e.metadata)!==void 0?s.jsxs(v,{disabled:S||!l,tabIndex:-1,variant:"outline",size:"sm",className:"z-50 gap-2 whitespace-nowrap","data-testid":"playground-flow-button-"+e.id,onClick:n=>{n.preventDefault(),n.stopPropagation(),c(!0);const o=B(e.id);if(o){if(!I(o)){i({title:"Error",list:["This flow doesn't have a playground."]}),c(!1);return}W(e.id),b(!0),c(!1)}else Q().then(t=>{if(!I(t)){i({title:"Error",list:["This flow doesn't have a playground."]}),c(!1);return}V(t),b(!0),c(!1)})},children:[S?s.jsx(Y,{className:"h-4 w-4 text-medium-indigo"}):s.jsx(r,{name:"BotMessageSquareIcon",className:"h-4 w-4 select-none"}),"Playground"]},e.id):void 0,e.liked_by_count!=null&&s.jsxs("div",{className:"flex gap-0.5",children:[h&&(e==null?void 0:e.metadata)!==void 0?s.jsx(u,{content:l?"Delete":"Please review your API key.",children:s.jsx(ee,{onConfirm:h,children:s.jsx(v,{variant:"ghost",size:"icon",className:"whitespace-nowrap"+(l?"":" cursor-not-allowed"),children:s.jsx(r,{"data-testid":`delete-${se(e.name)}`,name:"Trash2",className:m("h-5 w-5",l?"":" text-ring")})})})}):s.jsx(u,{content:l?"Like":"Please review your API key.",children:s.jsx(v,{disabled:ie,variant:"ghost",size:"icon",className:"whitespace-nowrap"+(l?"":" cursor-not-allowed"),onClick:()=>{l&&me()},"data-testid":`like-${e.name}`,children:s.jsx(r,{name:"Heart",className:m("h-5 w-5",y?"fill-destructive stroke-destructive":"",l?"":" text-ring")})})}),s.jsx(u,{content:l?"Install Locally":"Please review your API key.",children:s.jsx(v,{disabled:g,variant:"ghost",size:"icon",className:"whitespace-nowrap"+(l?"":" cursor-not-allowed")+(g?"":" p-0.5"),onClick:()=>{g||!l||de()},"data-testid":`install-${e.name}`,children:s.jsx(r,{name:g?"Loader2":"Plus",className:m(g?"h-5 w-5 animate-spin":"h-5 w-5",l?"":" text-ring")})})})]}),p&&(e==null?void 0:e.metadata)===void 0&&s.jsxs(v,{disabled:S||!l,tabIndex:-1,variant:"primary",size:"sm",className:"gap-2 whitespace-nowrap bg-muted","data-testid":"playground-flow-button-"+e.id,onClick:n=>{n.preventDefault(),n.stopPropagation(),c(!0);const o=B(e.id);if(o){if(!I(o)){i({title:"Error",list:["This flow doesn't have a playground."]}),c(!1);return}W(e.id),b(!0),c(!1)}else Q().then(t=>{if(!I(t)){i({title:"Error",list:["This flow doesn't have a playground."]}),c(!1);return}V(t),b(!0),c(!1)})},children:[S?s.jsx(Y,{className:"h-4 w-4 text-medium-indigo"}):s.jsx(r,{name:"BotMessageSquareIcon",className:"h-4 w-4 select-none"}),"Playground"]},e.id)]})})})]}),_&&s.jsx(be,{cleanOnClose:!0,open:_,setOpen:b,children:s.jsx(s.Fragment,{})}),R&&s.jsx(ee,{open:R,setOpen:ae,onConfirm:()=>{h&&h()},description:` ${$?"component":"flow"}`,children:s.jsx(s.Fragment,{})})]})}function P({className:e,...l}){return s.jsx("div",{className:m("animate-pulse rounded-md bg-border",e),...l})}const Te=()=>s.jsxs("div",{className:"skeleton-card",children:[s.jsxs("div",{className:"skeleton-card-wrapper",children:[s.jsx(P,{className:"h-8 w-8 rounded-full"}),s.jsx(P,{className:"h-4 w-[40%]"})]}),s.jsxs("div",{className:"skeleton-card-text",children:[s.jsx(P,{className:"h-3 w-[90%]"}),s.jsx(P,{className:"h-3 w-[80%]"})]})]}),_e=({loading:e,divClasses:l,onChange:L,onClick:q,value:N,onKeyDown:h})=>{const p=window.location.pathname,x=d(i=>i.allFlows),$=d(i=>i.searchFlowsComponents),D=e||!x||(x==null?void 0:x.length)===0&&$==="",E=()=>p.includes("flows")?"Search Flows":p.includes("components")?"Search Components":"Search Flows and Components";return s.jsx(s.Fragment,{children:s.jsxs("div",{className:`${l||"relative h-12 w-[60%]"}`,children:[s.jsx(ye,{"data-testid":"search-store-input",disabled:D,placeholder:E(),className:"absolute h-12 pl-5 pr-12",onChange:L,onKeyDown:h,value:N}),s.jsx("button",{onClick:q,disabled:e,className:"absolute bottom-0 right-4 top-0 my-auto h-6 cursor-pointer stroke-1 text-muted-foreground","data-testid":"search-store-button",children:s.jsx(r,{name:e?"Loader2":"Search",className:e?" animate-spin cursor-not-allowed":""})})]})})},Oe=_e;export{Ee as C,Oe as I,Te as S};
