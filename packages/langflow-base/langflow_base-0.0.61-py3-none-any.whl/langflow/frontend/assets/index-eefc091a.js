import{r as n,u as C,j as e,B as f,I as x,f as N,a as R,c as D,F as v,G as P,H as I,J as T,T as p,K as k,M as L,N as F,O as $,P as U,Q as O,A as H,R as M}from"./index-86768d23.js";import{I as S}from"./input-13e7a0de.js";function Y({children:i,data:l,onCloseModal:c}){const[r,m]=n.useState(!1),[s,t]=n.useState((l==null?void 0:l.apikeyname)??""),[d,y]=n.useState(""),[u,h]=n.useState(!1),[A,j]=n.useState(!0),K=C(o=>o.setSuccessData),a=n.useRef(null);n.useEffect(()=>{r?(h(!1),g()):c()},[r]);function g(){t(""),y("")}const _=async()=>{var o,w;d&&(await navigator.clipboard.writeText(d),(o=a==null?void 0:a.current)==null||o.focus(),(w=a==null?void 0:a.current)==null||w.select(),K({title:v}),j(!1),setTimeout(()=>{j(!0)},3e3))};function b(){P(s).then(o=>{y(o.api_key)}).catch(o=>{})}function E(){u?m(!1):(h(!0),b())}return e.jsxs(f,{onSubmit:E,size:"small-h-full",open:r,setOpen:m,children:[e.jsx(f.Trigger,{children:i}),e.jsxs(f.Header,{description:u?e.jsxs(e.Fragment,{children:[" ","Please save this secret key somewhere safe and accessible. For security reasons,"," ",e.jsx("strong",{children:"you won't be able to view it again"})," through your account. If you lose this secret key, you'll need to generate a new one."]}):e.jsx(e.Fragment,{children:"Create a secret API Key to use Langflow API."}),children:[e.jsx("span",{className:"pr-2",children:"Create API Key"}),e.jsx(x,{name:"Key",className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(f.Content,{children:u?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-full",children:e.jsx(S,{ref:a,readOnly:!0,value:d})}),e.jsx(N,{onClick:()=>{_()},variant:"none",size:"none",children:A?e.jsx(x,{name:"Copy",className:"h-4 w-4"}):e.jsx(x,{name:"Check",className:"h-4 w-4"})})]})}):e.jsx(R,{name:"apikey",children:e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsx(D,{asChild:!0,children:e.jsx(S,{id:"primary-input",value:s,ref:a,onChange:({target:{value:o}})=>{t(o)},placeholder:"Insert a name for your API Key"})})})})}),e.jsx(f.Footer,{submit:{label:u?"Done":"Create Secret Key"}})]})}const z=({selectedRows:i,handleDeleteKey:l,fetchApiKeys:c,userId:r})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["API Keys",e.jsx(x,{name:"Key",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:I})]}),e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2",children:[e.jsx(N,{"data-testid":"api-key-button-store",variant:"primary",className:"group px-2",disabled:i.length===0,onClick:l,children:e.jsx(x,{name:"Trash2",className:T("h-5 w-5 text-destructive group-disabled:text-primary")})}),e.jsx(Y,{data:r,onCloseModal:c,children:e.jsxs(N,{"data-testid":"api-key-button-store",variant:"primary",children:[e.jsx(x,{name:"Plus",className:"mr-2 w-4"}),"Add New"]})})]})]})}),B=z,G=()=>[{headerCheckboxSelection:!0,checkboxSelection:!0,showDisabledCheckboxes:!0,headerName:"Name",field:"name",cellRenderer:p,flex:2},{headerName:"Key",field:"api_key",cellRenderer:p,flex:1},{headerName:"Created",field:"created_at",cellRenderer:p,flex:1},{headerName:"Last Used",field:"last_used_at",cellRenderer:p,flex:1},{headerName:"Total Uses",field:"total_uses",cellRenderer:p,flex:1,resizable:!1}],V=(i,l,c,r)=>({fetchApiKeys:()=>{l(!0),k().then(s=>{c.current=s.api_keys.map(t=>({...t,name:t.name&&t.name!==""?t.name:"Untitled",last_used_at:t.last_used_at??"Never"})),r(s.user_id),l(!1)}).catch(s=>{l(!1)})}}),J=V,Q=(i,l,c,r)=>({handleDeleteKey:()=>{Promise.all(i.map(s=>L(s))).then(()=>{l(),c({title:i.length===1?F:$})}).catch(s=>{var t,d;r({title:i.length===1?U:O,list:[(d=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:d.detail]})})}}),q=Q;function Z(){const[i,l]=n.useState(!0),[c,r]=n.useState([]),m=C(a=>a.setSuccessData),s=C(a=>a.setErrorData),{userData:t}=n.useContext(H),[d,y]=n.useState(""),u=n.useRef([]);n.useEffect(()=>{h()},[t]);const{fetchApiKeys:h}=J(t,l,u,y);function A(){h()}const{handleDeleteKey:j}=q(c,A,m,s),K=G();return e.jsxs("div",{className:"flex h-full w-full flex-col justify-between gap-6",children:[e.jsx(B,{selectedRows:c,handleDeleteKey:j,fetchApiKeys:h,userId:d}),e.jsx("div",{className:"flex h-full w-full flex-col justify-between",children:e.jsx(M,{overlayNoRowsTemplate:"No data available",onSelectionChanged:a=>{r(a.api.getSelectedRows().map(g=>g.id))},rowSelection:"multiple",suppressRowClickSelection:!0,pagination:!0,columnDefs:K,rowData:u.current})})]})}export{Z as default};
