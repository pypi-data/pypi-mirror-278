import{aP as ee,av as i,j as o,at as ae,J as L,aQ as O,u as $,h as U,aR as ne,aS as oe,ax as re,ay as te,aT as se,r as S,au as V,f as C,aU as A,I as P,aV as le,aB as de,aC as ce}from"./index-86768d23.js";import{H as ie}from"./index-f1496333.js";import{I as fe}from"./input-13e7a0de.js";function pe(u){ee(u).then(l=>{const s=i.getState().folders.find(c=>c.id===u);l.folder_name=(s==null?void 0:s.name)||"folder",l.folder_description=(s==null?void 0:s.description)||"";const D=`data:text/json;chatset=utf-8,${encodeURIComponent(JSON.stringify(l))}`,h=document.createElement("a");h.href=D,h.download=`${l.folder_name}.json`,h.click()})}const ue=({items:u,pathname:l})=>o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:u.map(t=>o.jsx(ae,{to:t.href,children:o.jsxs("div",{"data-testid":`sidebar-nav-${t.title}`,className:L(O({variant:"ghost"}),l===t.href?"border border-border bg-muted hover:bg-muted":"border border-transparent hover:border-border hover:bg-transparent","flex w-full shrink-0 justify-start gap-4"),children:[t.icon,o.jsx("span",{className:"block max-w-full truncate opacity-100",children:t.title})]},t.title)}))}),me=ue,ge=(u,l)=>{const t=i(a=>a.setFolderDragging),s=i(a=>a.setFolderIdDragging),D=$(a=>a.setErrorData),h=i(a=>a.getFoldersApi),c=U(a=>a.flows),f=a=>{l&&l(a)},m=async a=>{if(a.dataTransfer.types.some(r=>r==="Files")&&a.dataTransfer.files&&a.dataTransfer.files.length>0){const r=a.dataTransfer.files[0];r.type==="application/json"?T(r):D({title:re,list:[te]})}},v=(a,r)=>{a.preventDefault(),a.dataTransfer.types.some(g=>g==="Files")&&t(!0),s(r)},F=(a,r)=>{a.dataTransfer.types.some(g=>g==="Files")&&t(!0),s(r),a.preventDefault()},w=a=>{a.preventDefault(),a.target===a.currentTarget&&(t(!1),s(""))},x=(a,r)=>{var g,b;if((g=a==null?void 0:a.dataTransfer)!=null&&g.getData("flow")){const j=JSON.parse((b=a==null?void 0:a.dataTransfer)==null?void 0:b.getData("flow"));if(j){I(j.id,r);return}}a.preventDefault(),m(a)},I=(a,r)=>{const g=c.find(y=>y.id===a);if(!g)throw new Error("Flow not found");const b={...g,folder_id:r},j=ne(b,c);b.name=j,t(!1),s(""),oe(b).then(()=>{h(!0),f(r)})},T=a=>{const r=new FormData;r.append("file",a),t(!1),s(""),se(r).then(()=>{h(!0),f(u)})};return{dragOver:v,dragEnter:F,dragLeave:w,onDrop:x}},he=({pathname:u,handleChangeFolder:l,handleEditFolder:t,handleDeleteFolder:s})=>{var _;const D=S.useRef(null),h=i(e=>e.setFolders),c=i(e=>e.folders),[f,m]=S.useState({}),v=U(e=>e.takeSnapshot),[F,w]=S.useState(c.map(e=>({name:e.name,edit:!1}))),x=i(e=>e.uploadFolder),I=u.split("/"),T=u.split("/").length<4,a=i(e=>e.myCollectionId),r=i(e=>e.getFoldersApi),g=i(e=>e.folderIdDragging),b=e=>T&&e===a?!0:I.includes(e),j=V(),y=((_=j==null?void 0:j.state)==null?void 0:_.folderId)??a,R=i(e=>e.getFolderById),z=$(e=>e.setErrorData),J=e=>{R(e)},{dragOver:H,dragEnter:K,dragLeave:M,onDrop:W}=ge(y,J),G=()=>{x(y).then(()=>{R(y)}).catch(e=>{console.log(e),z({title:"Error on upload",list:[e.response.data]})})},Q=e=>{pe(e)};function q(){ce({name:"New Folder",parent_id:null,description:""}).then(e=>{r(!0)})}function X(e,B){const{target:{value:k}}=e;m(n=>({...n,[B]:k}))}return S.useEffect(()=>{c.map(e=>({name:e.name,edit:!1}))},[c]),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex shrink-0 items-center justify-between gap-2",children:[o.jsx("div",{className:"flex-1 self-start text-lg font-semibold",children:"Folders"}),o.jsx(C,{variant:"primary",size:"icon",className:"px-2",onClick:q,"data-testid":"add-folder-button",children:o.jsx(A,{name:"FolderPlus",className:"w-4"})}),o.jsx(C,{variant:"primary",size:"icon",className:"px-2",onClick:G,"data-testid":"upload-folder-button",children:o.jsx(A,{name:"Upload",className:"w-4"})})]}),o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:o.jsx(o.Fragment,{children:c.map((e,B)=>{const k=F==null?void 0:F.filter(n=>n.name===e.name)[0];return o.jsx("div",{onDragOver:n=>H(n,e.id),onDragEnter:n=>K(n,e.id),onDragLeave:M,onDrop:n=>W(n,e.id),"data-testid":`sidebar-nav-${e.name}`,className:L(O({variant:"ghost"}),b(e.id)?"border border-border bg-muted hover:bg-muted":"border hover:bg-transparent lg:border-transparent lg:hover:border-border","group flex w-full shrink-0 cursor-pointer gap-2 opacity-100 lg:min-w-full",g===e.id?"bg-border":""),onClick:()=>l(e.id),children:o.jsxs("div",{onDoubleClick:n=>{var N;if(e.name!=="My Projects"){if(f[e.name]||m({[e.name]:e.name}),(N=F.find(p=>p.name===e.name))!=null&&N.name){const p=F.map(d=>d.name===e.name?{name:e.name,edit:!0}:{name:d.name,edit:!1});w(p),v(),n.stopPropagation(),n.preventDefault();return}w(p=>[...p,{name:e.name,edit:!0}]),m(p=>({...p,[e.name]:e.name})),v(),n.stopPropagation(),n.preventDefault()}},className:"flex w-full items-center gap-4",children:[o.jsx(P,{name:"folder",className:"w-4 flex-shrink-0 justify-start stroke-[1.5] opacity-100"}),k!=null&&k.edit?o.jsx("div",{children:o.jsx(fe,{className:"w-36",onChange:n=>{X(n,e.name)},ref:D,onKeyDown:n=>{var N;if(n.key==="Escape"){const p=F.map(d=>d.name===e.name?{name:e.name,edit:!1}:{name:d.name,edit:!1});w(p),m({}),w(c.map(d=>({name:d.name,edit:!1})))}n.key==="Enter"&&((N=D.current)==null||N.blur()),le(n,n.key,"")},autoFocus:!0,onBlur:async()=>{var N,p;const n=F.map(d=>d.name===e.name?{name:e.name,edit:!1}:{name:d.name,edit:!1});if(w(n),f[e.name].trim()!==""){m(E=>({...E,[e.name]:f[e.name]}));const d={...e,name:f[e.name],flows:((N=e.flows)==null?void 0:N.length)>0?e.flows:[],components:((p=e.components)==null?void 0:p.length)>0?e.components:[]},Y=await de(d,e.id),Z=c.filter(E=>E.name!==e.name);h([...Z,Y]),m({}),w(c.map(E=>({name:E.name,edit:!1})))}else m(d=>({...d,[e.name]:e.name}))},value:f[e.name],id:`input-folder-${e.name}`,"data-testid":"input-folder"})}):o.jsx("span",{className:"block w-full truncate opacity-100",children:e.name}),B>0&&o.jsx(C,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{s(e),n.stopPropagation(),n.preventDefault()},variant:"ghost",children:o.jsx(P,{name:"trash",className:" w-4 stroke-[1.5]"})}),o.jsx(C,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{Q(e.id),n.stopPropagation(),n.preventDefault()},size:"none",variant:"none",children:o.jsx(P,{name:"Download",className:"  w-4 stroke-[1.5] text-white  "})})]})},e.id)})})})]})},Fe=he;function De({className:u,items:l,handleChangeFolder:t,handleEditFolder:s,handleDeleteFolder:D,...h}){const f=V().pathname,m=i(x=>x.loading),v=i(x=>x.folders),w=["folder","components","flows","all"].some(x=>f.includes(x));return o.jsx("nav",{className:L(u),...h,children:o.jsx(ie,{children:l.length>0?o.jsx(me,{items:l,pathname:f}):!m&&(v==null?void 0:v.length)>0&&w&&o.jsx(Fe,{folders:v,pathname:f,handleChangeFolder:t,handleEditFolder:s,handleDeleteFolder:D})})})}export{De as S};
